<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Candidate prioritization | Malaria vaccine antigen identification for Plasmodium falciparum</title>
  <meta name="description" content="Section 3 Candidate prioritization | Malaria vaccine antigen identification for Plasmodium falciparum" />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Candidate prioritization | Malaria vaccine antigen identification for Plasmodium falciparum" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Candidate prioritization | Malaria vaccine antigen identification for Plasmodium falciparum" />
  
  
  

<meta name="author" content="" />


<meta name="date" content="2023-04-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="id_02_model_training.html"/>
<link rel="next" href="id_04_candidate_antigen_clustering.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.24/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/dt-ext-fixedcolumns-1.11.3/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-fixedcolumns-1.11.3/js/dataTables.fixedColumns.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<!-- https://stackoverflow.com/questions/45360998/code-folding-in-bookdown -->
<script type="text/javascript" src="js/transition.js"></script>
<script type="text/javascript" src="js/dropdown.js"></script>
<script>
var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
document.write(str);
</script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><i>Positive-unlabeled learning for Pf RV</i></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html"><i class="fa fa-check"></i><b>1</b> Data engineering</a>
<ul>
<li class="chapter" data-level="1.1" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#purf-package-installization"><i class="fa fa-check"></i><b>1.1</b> <code>purf</code> package installization</a></li>
<li class="chapter" data-level="1.2" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#retrieving-p.-falciparum-protein-variables"><i class="fa fa-check"></i><b>1.2</b> Retrieving <em>P. falciparum</em> protein variables</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#immunological-data-sets"><i class="fa fa-check"></i><b>1.2.1</b> Immunological data sets</a></li>
<li class="chapter" data-level="1.2.2" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#proteomic-data-sets"><i class="fa fa-check"></i><b>1.2.2</b> Proteomic data sets</a></li>
<li class="chapter" data-level="1.2.3" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#structural-data-sets"><i class="fa fa-check"></i><b>1.2.3</b> Structural data sets</a></li>
<li class="chapter" data-level="1.2.4" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#genomic-data-sets"><i class="fa fa-check"></i><b>1.2.4</b> Genomic data sets</a></li>
<li class="chapter" data-level="1.2.5" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#final-assembly"><i class="fa fa-check"></i><b>1.2.5</b> Final assembly</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="id_01_data_engineering.html"><a href="id_01_data_engineering.html#generating-ml-input"><i class="fa fa-check"></i><b>1.3</b> Generating ML input</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="id_02_model_training.html"><a href="id_02_model_training.html"><i class="fa fa-check"></i><b>2</b> Model training</a>
<ul>
<li class="chapter" data-level="2.1" data-path="id_02_model_training.html"><a href="id_02_model_training.html#simulation-experiment-with-99-unlabeled-data-set."><i class="fa fa-check"></i><b>2.1</b> Simulation experiment with 99% unlabeled data set.</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="id_02_model_training.html"><a href="id_02_model_training.html#analysis"><i class="fa fa-check"></i><b>2.1.1</b> Analysis</a></li>
<li class="chapter" data-level="2.1.2" data-path="id_02_model_training.html"><a href="id_02_model_training.html#plotting"><i class="fa fa-check"></i><b>2.1.2</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="id_02_model_training.html"><a href="id_02_model_training.html#hyper-parameter-tuning-for-purf"><i class="fa fa-check"></i><b>2.2</b> Hyper-parameter tuning for PURF</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="id_02_model_training.html"><a href="id_02_model_training.html#analysis-1"><i class="fa fa-check"></i><b>2.2.1</b> Analysis</a></li>
<li class="chapter" data-level="2.2.2" data-path="id_02_model_training.html"><a href="id_02_model_training.html#plotting-1"><i class="fa fa-check"></i><b>2.2.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="2.2.2.1" data-path="id_02_model_training.html"><a href="id_02_model_training.html#bimodal-distribution-plot"><i class="fa fa-check"></i><b>2.2.2.1</b> Bimodal distribution plot</a></li>
<li class="chapter" data-level="2.2.2.2" data-path="id_02_model_training.html"><a href="id_02_model_training.html#known-antigen-ranking"><i class="fa fa-check"></i><b>2.2.2.2</b> Known antigen ranking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="id_02_model_training.html"><a href="id_02_model_training.html#variable-space-weighting"><i class="fa fa-check"></i><b>2.3</b> Variable space weighting</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="id_02_model_training.html"><a href="id_02_model_training.html#analysis-2"><i class="fa fa-check"></i><b>2.3.1</b> Analysis</a></li>
<li class="chapter" data-level="2.3.2" data-path="id_02_model_training.html"><a href="id_02_model_training.html#plotting-2"><i class="fa fa-check"></i><b>2.3.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="2.3.2.1" data-path="id_02_model_training.html"><a href="id_02_model_training.html#bimodal-distribution-plot-1"><i class="fa fa-check"></i><b>2.3.2.1</b> Bimodal distribution plot</a></li>
<li class="chapter" data-level="2.3.2.2" data-path="id_02_model_training.html"><a href="id_02_model_training.html#known-antigen-ranking-1"><i class="fa fa-check"></i><b>2.3.2.2</b> Known antigen ranking</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html"><i class="fa fa-check"></i><b>3</b> Candidate prioritization</a>
<ul>
<li class="chapter" data-level="3.1" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#jackknife-based-validation-of-purf-models"><i class="fa fa-check"></i><b>3.1</b> Jackknife-based validation of PURF models</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#analysis-3"><i class="fa fa-check"></i><b>3.1.1</b> Analysis</a>
<ul>
<li class="chapter" data-level="3.1.1.1" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#training-on-whole-data-set"><i class="fa fa-check"></i><b>3.1.1.1</b> Training on whole data set</a></li>
<li class="chapter" data-level="3.1.1.2" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#validation-for-purf-without-tree-filtering"><i class="fa fa-check"></i><b>3.1.1.2</b> Validation for PURF without tree filtering</a></li>
<li class="chapter" data-level="3.1.1.3" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#validation-for-purf-with-tree-filtering"><i class="fa fa-check"></i><b>3.1.1.3</b> Validation for PURF with tree filtering</a></li>
</ul></li>
<li class="chapter" data-level="3.1.2" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#plotting-3"><i class="fa fa-check"></i><b>3.1.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="3.1.2.1" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#plot-score-distribution"><i class="fa fa-check"></i><b>3.1.2.1</b> Plot score distribution</a></li>
<li class="chapter" data-level="3.1.2.2" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#percent-rank-for-labeled-positives"><i class="fa fa-check"></i><b>3.1.2.2</b> Percent rank for labeled positives</a></li>
<li class="chapter" data-level="3.1.2.3" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#comparison-of-known-antigens"><i class="fa fa-check"></i><b>3.1.2.3</b> Comparison of known antigens</a></li>
<li class="chapter" data-level="3.1.2.4" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#comparison-of-top-200-candidates"><i class="fa fa-check"></i><b>3.1.2.4</b> Comparison of top 200 candidates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#model-interpretation"><i class="fa fa-check"></i><b>3.2</b> Model interpretation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#analysis-4"><i class="fa fa-check"></i><b>3.2.1</b> Analysis</a>
<ul>
<li class="chapter" data-level="3.2.1.1" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#variable-importance"><i class="fa fa-check"></i><b>3.2.1.1</b> Variable importance</a></li>
<li class="chapter" data-level="3.2.1.2" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#wilcoxon-test"><i class="fa fa-check"></i><b>3.2.1.2</b> Wilcoxon test</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#plotting-4"><i class="fa fa-check"></i><b>3.2.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="3.2.2.1" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#variable-importance-1"><i class="fa fa-check"></i><b>3.2.2.1</b> Variable importance</a></li>
<li class="chapter" data-level="3.2.2.2" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#group-variable-importance"><i class="fa fa-check"></i><b>3.2.2.2</b> Group variable importance</a></li>
<li class="chapter" data-level="3.2.2.3" data-path="id_03_candidate_prioritization.html"><a href="id_03_candidate_prioritization.html#wilcoxon-test-1"><i class="fa fa-check"></i><b>3.2.2.3</b> Wilcoxon test</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html"><i class="fa fa-check"></i><b>4</b> Candidate antigen clustering</a>
<ul>
<li class="chapter" data-level="4.1" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#clustering-analysis-of-the-proximity-matrix-from-the-tree-filtered-purf-model"><i class="fa fa-check"></i><b>4.1</b> Clustering analysis of the proximity matrix from the tree-filtered PURF model</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#analysis-5"><i class="fa fa-check"></i><b>4.1.1</b> Analysis</a>
<ul>
<li class="chapter" data-level="4.1.1.1" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#multi-dimensional-scaling"><i class="fa fa-check"></i><b>4.1.1.1</b> Multi-dimensional scaling</a></li>
</ul></li>
<li class="chapter" data-level="4.1.2" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#plotting-5"><i class="fa fa-check"></i><b>4.1.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="4.1.2.1" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#clustering-on-candidate-antigens"><i class="fa fa-check"></i><b>4.1.2.1</b> Clustering on candidate antigens</a></li>
<li class="chapter" data-level="4.1.2.2" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#difference-in-scores"><i class="fa fa-check"></i><b>4.1.2.2</b> Difference in scores</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#comparison-of-the-candidate-clustering-groups"><i class="fa fa-check"></i><b>4.2</b> Comparison of the candidate clustering groups</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#plotting-6"><i class="fa fa-check"></i><b>4.2.1</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#important-variables-for-candidate-clustering-groups"><i class="fa fa-check"></i><b>4.3</b> Important variables for candidate clustering groups</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#analysis-6"><i class="fa fa-check"></i><b>4.3.1</b> Analysis</a>
<ul>
<li class="chapter" data-level="4.3.1.1" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#variable-importance-2"><i class="fa fa-check"></i><b>4.3.1.1</b> Variable importance</a></li>
<li class="chapter" data-level="4.3.1.2" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#wilcoxon-test-2"><i class="fa fa-check"></i><b>4.3.1.2</b> Wilcoxon test</a></li>
</ul></li>
<li class="chapter" data-level="4.3.2" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#plotting-7"><i class="fa fa-check"></i><b>4.3.2</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="id_04_candidate_antigen_clustering.html"><a href="id_04_candidate_antigen_clustering.html#comparison-of-important-variables"><i class="fa fa-check"></i><b>4.4</b> Comparison of important variables</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html"><i class="fa fa-check"></i><b>5</b> Further characterization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#gene-ontology-analysis"><i class="fa fa-check"></i><b>5.1</b> Gene ontology analysis</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#analysis-7"><i class="fa fa-check"></i><b>5.1.1</b> Analysis</a></li>
<li class="chapter" data-level="5.1.2" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#plotting-8"><i class="fa fa-check"></i><b>5.1.2</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#candidate-antigen-characterization"><i class="fa fa-check"></i><b>5.2</b> Candidate antigen characterization</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#analysis-8"><i class="fa fa-check"></i><b>5.2.1</b> Analysis</a>
<ul>
<li class="chapter" data-level="5.2.1.1" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#down-selection-with-essential-genes"><i class="fa fa-check"></i><b>5.2.1.1</b> Down-selection with essential genes</a></li>
<li class="chapter" data-level="5.2.1.2" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#characterization-using-scrna-seq"><i class="fa fa-check"></i><b>5.2.1.2</b> Characterization using scRNA-seq</a></li>
</ul></li>
<li class="chapter" data-level="5.2.2" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#processing-table"><i class="fa fa-check"></i><b>5.2.2</b> Processing table</a></li>
<li class="chapter" data-level="5.2.3" data-path="id_05_further_characterization.html"><a href="id_05_further_characterization.html#plotting-9"><i class="fa fa-check"></i><b>5.2.3</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="id_06_summary_of_candidates.html"><a href="id_06_summary_of_candidates.html"><i class="fa fa-check"></i><b>6</b> Summary of candidates</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Malaria vaccine antigen identification for <em>Plasmodium falciparum</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="id_03_candidate_prioritization" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> Candidate prioritization<a href="id_03_candidate_prioritization.html#id_03_candidate_prioritization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="jackknife-based-validation-of-purf-models" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Jackknife-based validation of PURF models<a href="id_03_candidate_prioritization.html#jackknife-based-validation-of-purf-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="analysis-3" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Analysis<a href="id_03_candidate_prioritization.html#analysis-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>In Python: </strong></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb47-1"><a href="id_03_candidate_prioritization.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb47-2"><a href="id_03_candidate_prioritization.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-3"><a href="id_03_candidate_prioritization.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb47-4"><a href="id_03_candidate_prioritization.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb47-5"><a href="id_03_candidate_prioritization.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> purf.pu_ensemble <span class="im">import</span> PURandomForestClassifier</span>
<span id="cb47-6"><a href="id_03_candidate_prioritization.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb47-7"><a href="id_03_candidate_prioritization.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial <span class="im">import</span> distance</span>
<span id="cb47-8"><a href="id_03_candidate_prioritization.html#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> Parallel, delayed</span>
<span id="cb47-9"><a href="id_03_candidate_prioritization.html#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble._forest <span class="im">import</span> _generate_unsampled_indices</span>
<span id="cb47-10"><a href="id_03_candidate_prioritization.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb47-11"><a href="id_03_candidate_prioritization.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb47-12"><a href="id_03_candidate_prioritization.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> session_info</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb48-1"><a href="id_03_candidate_prioritization.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># input set (5393, 1 + 272)</span></span>
<span id="cb48-2"><a href="id_03_candidate_prioritization.html#cb48-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">&#39;./data/supplementary_data_3_pf_ml_input.csv&#39;</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb48-3"><a href="id_03_candidate_prioritization.html#cb48-3" aria-hidden="true" tabindex="-1"></a>pf3d7_features <span class="op">=</span> data.iloc[:,<span class="dv">1</span>:]</span>
<span id="cb48-4"><a href="id_03_candidate_prioritization.html#cb48-4" aria-hidden="true" tabindex="-1"></a>pf3d7_outcome <span class="op">=</span> np.array(data.antigen_label)</span>
<span id="cb48-5"><a href="id_03_candidate_prioritization.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="id_03_candidate_prioritization.html#cb48-6" aria-hidden="true" tabindex="-1"></a>REF_ANTIGENS <span class="op">=</span> {<span class="st">&#39;CSP&#39;</span>: <span class="st">&#39;PF3D7_0304600.1-p1&#39;</span>, <span class="st">&#39;RH5&#39;</span>: <span class="st">&#39;PF3D7_0424100.1-p1&#39;</span>, <span class="st">&#39;MSP5&#39;</span>: <span class="st">&#39;PF3D7_0206900.1-p1&#39;</span>, <span class="st">&#39;P230&#39;</span>: <span class="st">&#39;PF3D7_0209000.1-p1&#39;</span>}</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb49-1"><a href="id_03_candidate_prioritization.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># private function for train_purf()</span></span>
<span id="cb49-2"><a href="id_03_candidate_prioritization.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _get_ref_antigen_stats(idx, tree, X, y, ref_indices, max_samples<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb49-3"><a href="id_03_candidate_prioritization.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_samples <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb49-4"><a href="id_03_candidate_prioritization.html#cb49-4" aria-hidden="true" tabindex="-1"></a>        max_samples <span class="op">=</span> y.shape[<span class="dv">0</span>]</span>
<span id="cb49-5"><a href="id_03_candidate_prioritization.html#cb49-5" aria-hidden="true" tabindex="-1"></a>    oob_indices <span class="op">=</span> _generate_unsampled_indices(tree.random_state, y.shape[<span class="dv">0</span>], max_samples)</span>
<span id="cb49-6"><a href="id_03_candidate_prioritization.html#cb49-6" aria-hidden="true" tabindex="-1"></a>    ref_oob <span class="op">=</span> [i <span class="kw">in</span> oob_indices <span class="cf">for</span> i <span class="kw">in</span> ref_indices]</span>
<span id="cb49-7"><a href="id_03_candidate_prioritization.html#cb49-7" aria-hidden="true" tabindex="-1"></a>    ref_pred <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb49-8"><a href="id_03_candidate_prioritization.html#cb49-8" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> tree.predict_proba(X[ref_indices,:], check_input<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-9"><a href="id_03_candidate_prioritization.html#cb49-9" aria-hidden="true" tabindex="-1"></a>    ref_pred <span class="op">=</span> pred[:,<span class="dv">1</span>]</span>
<span id="cb49-10"><a href="id_03_candidate_prioritization.html#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ref_oob, ref_pred</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb50-1"><a href="id_03_candidate_prioritization.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_purf(features, outcome, res_path, pickle_path, tree_filtering<span class="op">=</span><span class="va">None</span>, model_path<span class="op">=</span><span class="va">None</span>, n_jobs<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb50-2"><a href="id_03_candidate_prioritization.html#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Imputation</span></span>
<span id="cb50-3"><a href="id_03_candidate_prioritization.html#cb50-3" aria-hidden="true" tabindex="-1"></a>    imputer <span class="op">=</span> SimpleImputer(strategy<span class="op">=</span><span class="st">&#39;median&#39;</span>)</span>
<span id="cb50-4"><a href="id_03_candidate_prioritization.html#cb50-4" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> imputer.fit_transform(features)</span>
<span id="cb50-5"><a href="id_03_candidate_prioritization.html#cb50-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> pd.DataFrame(X, index<span class="op">=</span>features.index, columns<span class="op">=</span>features.columns)</span>
<span id="cb50-6"><a href="id_03_candidate_prioritization.html#cb50-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> outcome</span>
<span id="cb50-7"><a href="id_03_candidate_prioritization.html#cb50-7" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> X</span>
<span id="cb50-8"><a href="id_03_candidate_prioritization.html#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;There are </span><span class="sc">%d</span><span class="st"> positives out of </span><span class="sc">%d</span><span class="st"> samples before feature space weighting.&#39;</span> <span class="op">%</span> (<span class="bu">sum</span>(y), <span class="bu">len</span>(y)))</span>
<span id="cb50-9"><a href="id_03_candidate_prioritization.html#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature space weighting</span></span>
<span id="cb50-10"><a href="id_03_candidate_prioritization.html#cb50-10" aria-hidden="true" tabindex="-1"></a>    lab_pos <span class="op">=</span> X.loc[y<span class="op">==</span><span class="dv">1</span>,:]</span>
<span id="cb50-11"><a href="id_03_candidate_prioritization.html#cb50-11" aria-hidden="true" tabindex="-1"></a>    median <span class="op">=</span> np.median(lab_pos, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb50-12"><a href="id_03_candidate_prioritization.html#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Feature space weighting</span></span>
<span id="cb50-13"><a href="id_03_candidate_prioritization.html#cb50-13" aria-hidden="true" tabindex="-1"></a>    lab_pos <span class="op">=</span> X.loc[y<span class="op">==</span><span class="dv">1</span>,:]</span>
<span id="cb50-14"><a href="id_03_candidate_prioritization.html#cb50-14" aria-hidden="true" tabindex="-1"></a>    median <span class="op">=</span> np.median(lab_pos, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb50-15"><a href="id_03_candidate_prioritization.html#cb50-15" aria-hidden="true" tabindex="-1"></a>    scaler <span class="op">=</span> MinMaxScaler(feature_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">10</span>))</span>
<span id="cb50-16"><a href="id_03_candidate_prioritization.html#cb50-16" aria-hidden="true" tabindex="-1"></a>    dist <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb50-17"><a href="id_03_candidate_prioritization.html#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(lab_pos.shape[<span class="dv">0</span>]):</span>
<span id="cb50-18"><a href="id_03_candidate_prioritization.html#cb50-18" aria-hidden="true" tabindex="-1"></a>        dist.append(distance.euclidean(lab_pos.iloc[i, :], median))</span>
<span id="cb50-19"><a href="id_03_candidate_prioritization.html#cb50-19" aria-hidden="true" tabindex="-1"></a>    dist <span class="op">=</span> np.asarray(dist).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb50-20"><a href="id_03_candidate_prioritization.html#cb50-20" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> np.<span class="bu">round</span>(scaler.fit_transform(dist))</span>
<span id="cb50-21"><a href="id_03_candidate_prioritization.html#cb50-21" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> np.array(counts, dtype<span class="op">=</span>np.int64)[:, <span class="dv">0</span>]</span>
<span id="cb50-22"><a href="id_03_candidate_prioritization.html#cb50-22" aria-hidden="true" tabindex="-1"></a>    X_temp <span class="op">=</span> X.iloc[y<span class="op">==</span><span class="dv">1</span>, :]</span>
<span id="cb50-23"><a href="id_03_candidate_prioritization.html#cb50-23" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> X.iloc[y<span class="op">==</span><span class="dv">0</span>, :]</span>
<span id="cb50-24"><a href="id_03_candidate_prioritization.html#cb50-24" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.asarray([<span class="dv">0</span>] <span class="op">*</span> X.shape[<span class="dv">0</span>] <span class="op">+</span> [<span class="dv">1</span>] <span class="op">*</span> (<span class="bu">sum</span>(counts)))</span>
<span id="cb50-25"><a href="id_03_candidate_prioritization.html#cb50-25" aria-hidden="true" tabindex="-1"></a>    appended_data <span class="op">=</span> [X]</span>
<span id="cb50-26"><a href="id_03_candidate_prioritization.html#cb50-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(counts)):</span>
<span id="cb50-27"><a href="id_03_candidate_prioritization.html#cb50-27" aria-hidden="true" tabindex="-1"></a>        appended_data.append(pd.concat([X_temp.iloc[[i]]] <span class="op">*</span> counts[i]))</span>
<span id="cb50-28"><a href="id_03_candidate_prioritization.html#cb50-28" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> pd.concat(appended_data)</span>
<span id="cb50-29"><a href="id_03_candidate_prioritization.html#cb50-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;There are </span><span class="sc">%d</span><span class="st"> positives out of </span><span class="sc">%d</span><span class="st"> samples after feature space weighting.&#39;</span> <span class="op">%</span> (<span class="bu">sum</span>(y), <span class="bu">len</span>(y)))</span>
<span id="cb50-30"><a href="id_03_candidate_prioritization.html#cb50-30" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> pd.DataFrame({<span class="st">&#39;protein_id&#39;</span>: X.index, <span class="st">&#39;antigen_label&#39;</span> : y})</span>
<span id="cb50-31"><a href="id_03_candidate_prioritization.html#cb50-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tree_filtering <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb50-32"><a href="id_03_candidate_prioritization.html#cb50-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get ref antigen indices</span></span>
<span id="cb50-33"><a href="id_03_candidate_prioritization.html#cb50-33" aria-hidden="true" tabindex="-1"></a>        ref_index_dict <span class="op">=</span> {ref:<span class="bu">list</span>() <span class="cf">for</span> ref <span class="kw">in</span> <span class="bu">list</span>(REF_ANTIGENS.values())}</span>
<span id="cb50-34"><a href="id_03_candidate_prioritization.html#cb50-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(res.shape[<span class="dv">0</span>]):</span>
<span id="cb50-35"><a href="id_03_candidate_prioritization.html#cb50-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> res[<span class="st">&#39;protein_id&#39;</span>][i] <span class="kw">in</span> <span class="bu">list</span>(REF_ANTIGENS.values()):</span>
<span id="cb50-36"><a href="id_03_candidate_prioritization.html#cb50-36" aria-hidden="true" tabindex="-1"></a>                ref_index_dict[res[<span class="st">&#39;protein_id&#39;</span>][i]].append(res.index[i])</span>
<span id="cb50-37"><a href="id_03_candidate_prioritization.html#cb50-37" aria-hidden="true" tabindex="-1"></a>        ref_indices <span class="op">=</span> <span class="bu">sum</span>(ref_index_dict.values(), [])</span>
<span id="cb50-38"><a href="id_03_candidate_prioritization.html#cb50-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get OOB stats and predictions</span></span>
<span id="cb50-39"><a href="id_03_candidate_prioritization.html#cb50-39" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> X.astype(<span class="st">&#39;float32&#39;</span>)</span>
<span id="cb50-40"><a href="id_03_candidate_prioritization.html#cb50-40" aria-hidden="true" tabindex="-1"></a>        purf <span class="op">=</span> pickle.load(<span class="bu">open</span>(model_path, <span class="st">&#39;rb&#39;</span>))</span>
<span id="cb50-41"><a href="id_03_candidate_prioritization.html#cb50-41" aria-hidden="true" tabindex="-1"></a>        trees <span class="op">=</span> purf.estimators_</span>
<span id="cb50-42"><a href="id_03_candidate_prioritization.html#cb50-42" aria-hidden="true" tabindex="-1"></a>        idx_list <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trees))]</span>
<span id="cb50-43"><a href="id_03_candidate_prioritization.html#cb50-43" aria-hidden="true" tabindex="-1"></a>        stats_res <span class="op">=</span> Parallel(n_jobs<span class="op">=</span>n_jobs)(</span>
<span id="cb50-44"><a href="id_03_candidate_prioritization.html#cb50-44" aria-hidden="true" tabindex="-1"></a>                    delayed(_get_ref_antigen_stats)(idx, trees[idx], np.array(X), y, ref_indices) <span class="cf">for</span> idx <span class="kw">in</span> idx_list)</span>
<span id="cb50-45"><a href="id_03_candidate_prioritization.html#cb50-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ref_oob data structure:</span></span>
<span id="cb50-46"><a href="id_03_candidate_prioritization.html#cb50-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># rows represent individual trees</span></span>
<span id="cb50-47"><a href="id_03_candidate_prioritization.html#cb50-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># column represent reference antigens</span></span>
<span id="cb50-48"><a href="id_03_candidate_prioritization.html#cb50-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cells indicate whether the reference antigen is in the OOB samples of the tree</span></span>
<span id="cb50-49"><a href="id_03_candidate_prioritization.html#cb50-49" aria-hidden="true" tabindex="-1"></a>        ref_oob <span class="op">=</span> np.array([ref_oob <span class="cf">for</span> ref_oob, ref_pred <span class="kw">in</span> stats_res])</span>
<span id="cb50-50"><a href="id_03_candidate_prioritization.html#cb50-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ref_pred data structure:</span></span>
<span id="cb50-51"><a href="id_03_candidate_prioritization.html#cb50-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># rows represent individual trees</span></span>
<span id="cb50-52"><a href="id_03_candidate_prioritization.html#cb50-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># column represent reference antigens</span></span>
<span id="cb50-53"><a href="id_03_candidate_prioritization.html#cb50-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cells indicate the prediction of the reference antigen by the tree</span></span>
<span id="cb50-54"><a href="id_03_candidate_prioritization.html#cb50-54" aria-hidden="true" tabindex="-1"></a>        ref_pred <span class="op">=</span> np.array([ref_pred <span class="cf">for</span> ref_oob, ref_pred <span class="kw">in</span> stats_res])</span>
<span id="cb50-55"><a href="id_03_candidate_prioritization.html#cb50-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># analyze duplicated reference antigens as a group</span></span>
<span id="cb50-56"><a href="id_03_candidate_prioritization.html#cb50-56" aria-hidden="true" tabindex="-1"></a>        cumsum_num_ref <span class="op">=</span> np.cumsum(np.array([<span class="bu">len</span>(v) <span class="cf">for</span> k,v <span class="kw">in</span> ref_index_dict.items()]))</span>
<span id="cb50-57"><a href="id_03_candidate_prioritization.html#cb50-57" aria-hidden="true" tabindex="-1"></a>        ref_oob_all <span class="op">=</span> np.array([ref_oob[:, <span class="dv">0</span>:cumsum_num_ref[i]].<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">\</span></span>
<span id="cb50-58"><a href="id_03_candidate_prioritization.html#cb50-58" aria-hidden="true" tabindex="-1"></a>                                ref_oob[:, cumsum_num_ref[i <span class="op">-</span> <span class="dv">1</span>]:cumsum_num_ref[i]].<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">\</span></span>
<span id="cb50-59"><a href="id_03_candidate_prioritization.html#cb50-59" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(REF_ANTIGENS))]).T</span>
<span id="cb50-60"><a href="id_03_candidate_prioritization.html#cb50-60" aria-hidden="true" tabindex="-1"></a>        ref_pred_all <span class="op">=</span> np.array([ref_pred[:, <span class="dv">0</span>:cumsum_num_ref[i]].<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="op">\</span></span>
<span id="cb50-61"><a href="id_03_candidate_prioritization.html#cb50-61" aria-hidden="true" tabindex="-1"></a>                                 ref_pred[:, cumsum_num_ref[i <span class="op">-</span> <span class="dv">1</span>]:cumsum_num_ref[i]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) <span class="op">\</span></span>
<span id="cb50-62"><a href="id_03_candidate_prioritization.html#cb50-62" aria-hidden="true" tabindex="-1"></a>                                 <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(REF_ANTIGENS))]).T</span>
<span id="cb50-63"><a href="id_03_candidate_prioritization.html#cb50-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate number of reference antigens as OOB samples for each tree</span></span>
<span id="cb50-64"><a href="id_03_candidate_prioritization.html#cb50-64" aria-hidden="true" tabindex="-1"></a>        oob_total <span class="op">=</span> ref_oob_all.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb50-65"><a href="id_03_candidate_prioritization.html#cb50-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># assign score of 1 to trees that correctly predict all OOB reference antigens; otherwise, assign 0 score </span></span>
<span id="cb50-66"><a href="id_03_candidate_prioritization.html#cb50-66" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">=</span> np.zeros(<span class="bu">len</span>(trees))</span>
<span id="cb50-67"><a href="id_03_candidate_prioritization.html#cb50-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># iterate through the trees and calculate the stats</span></span>
<span id="cb50-68"><a href="id_03_candidate_prioritization.html#cb50-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trees)):</span>
<span id="cb50-69"><a href="id_03_candidate_prioritization.html#cb50-69" aria-hidden="true" tabindex="-1"></a>            oob_list <span class="op">=</span> <span class="bu">list</span>(ref_oob_all[i,:])</span>
<span id="cb50-70"><a href="id_03_candidate_prioritization.html#cb50-70" aria-hidden="true" tabindex="-1"></a>            pred_list <span class="op">=</span> <span class="bu">list</span>(ref_pred_all[i,:])</span>
<span id="cb50-71"><a href="id_03_candidate_prioritization.html#cb50-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> oob_total[i] <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb50-72"><a href="id_03_candidate_prioritization.html#cb50-72" aria-hidden="true" tabindex="-1"></a>                weights[i] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb50-73"><a href="id_03_candidate_prioritization.html#cb50-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb50-74"><a href="id_03_candidate_prioritization.html#cb50-74" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">sum</span>(np.array(pred_list)[oob_list] <span class="op">!=</span> <span class="dv">0</span>) <span class="op">==</span> oob_total[i]:</span>
<span id="cb50-75"><a href="id_03_candidate_prioritization.html#cb50-75" aria-hidden="true" tabindex="-1"></a>                    weights[i] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb50-76"><a href="id_03_candidate_prioritization.html#cb50-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tree_filtering <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb50-77"><a href="id_03_candidate_prioritization.html#cb50-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Training PURF</span></span>
<span id="cb50-78"><a href="id_03_candidate_prioritization.html#cb50-78" aria-hidden="true" tabindex="-1"></a>        purf <span class="op">=</span> PURandomForestClassifier(</span>
<span id="cb50-79"><a href="id_03_candidate_prioritization.html#cb50-79" aria-hidden="true" tabindex="-1"></a>            n_estimators <span class="op">=</span> <span class="dv">100000</span>,</span>
<span id="cb50-80"><a href="id_03_candidate_prioritization.html#cb50-80" aria-hidden="true" tabindex="-1"></a>            oob_score <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb50-81"><a href="id_03_candidate_prioritization.html#cb50-81" aria-hidden="true" tabindex="-1"></a>            n_jobs <span class="op">=</span> <span class="dv">64</span>,</span>
<span id="cb50-82"><a href="id_03_candidate_prioritization.html#cb50-82" aria-hidden="true" tabindex="-1"></a>            random_state <span class="op">=</span> <span class="dv">42</span>,</span>
<span id="cb50-83"><a href="id_03_candidate_prioritization.html#cb50-83" aria-hidden="true" tabindex="-1"></a>            pos_level <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb50-84"><a href="id_03_candidate_prioritization.html#cb50-84" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb50-85"><a href="id_03_candidate_prioritization.html#cb50-85" aria-hidden="true" tabindex="-1"></a>        purf.fit(X, y)</span>
<span id="cb50-86"><a href="id_03_candidate_prioritization.html#cb50-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb50-87"><a href="id_03_candidate_prioritization.html#cb50-87" aria-hidden="true" tabindex="-1"></a>        purf._set_oob_score_with_weights(np.array(X), y.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>), weights<span class="op">=</span>weights)</span>
<span id="cb50-88"><a href="id_03_candidate_prioritization.html#cb50-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Storing results</span></span>
<span id="cb50-89"><a href="id_03_candidate_prioritization.html#cb50-89" aria-hidden="true" tabindex="-1"></a>    res[<span class="st">&#39;OOB score&#39;</span>] <span class="op">=</span> purf.oob_decision_function_[:,<span class="dv">1</span>]</span>
<span id="cb50-90"><a href="id_03_candidate_prioritization.html#cb50-90" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> features.merge(res.groupby(<span class="st">&#39;protein_id&#39;</span>).mean(), left_index<span class="op">=</span><span class="va">True</span>, right_on<span class="op">=</span><span class="st">&#39;protein_id&#39;</span>)</span>
<span id="cb50-91"><a href="id_03_candidate_prioritization.html#cb50-91" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> features[[<span class="st">&#39;antigen_label&#39;</span>, <span class="st">&#39;OOB score&#39;</span>]]</span>
<span id="cb50-92"><a href="id_03_candidate_prioritization.html#cb50-92" aria-hidden="true" tabindex="-1"></a>    features.to_csv(res_path)</span>
<span id="cb50-93"><a href="id_03_candidate_prioritization.html#cb50-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> tree_filtering <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb50-94"><a href="id_03_candidate_prioritization.html#cb50-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(pickle_path, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> out:</span>
<span id="cb50-95"><a href="id_03_candidate_prioritization.html#cb50-95" aria-hidden="true" tabindex="-1"></a>            pickle.dump(purf, out, pickle.HIGHEST_PROTOCOL)</span>
<span id="cb50-96"><a href="id_03_candidate_prioritization.html#cb50-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb50-97"><a href="id_03_candidate_prioritization.html#cb50-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(pickle_path, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> out:</span>
<span id="cb50-98"><a href="id_03_candidate_prioritization.html#cb50-98" aria-hidden="true" tabindex="-1"></a>            pickle.dump({<span class="st">&#39;model&#39;</span>: purf, <span class="st">&#39;weights&#39;</span>: weights}, out, pickle.HIGHEST_PROTOCOL)</span></code></pre></div>
<div id="training-on-whole-data-set" class="section level4 hasAnchor" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> Training on whole data set<a href="id_03_candidate_prioritization.html#training-on-whole-data-set" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>In Python: </strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb51-1"><a href="id_03_candidate_prioritization.html#cb51-1" aria-hidden="true" tabindex="-1"></a>train_purf(pf3d7_features, pf3d7_outcome,</span>
<span id="cb51-2"><a href="id_03_candidate_prioritization.html#cb51-2" aria-hidden="true" tabindex="-1"></a>           res_path<span class="op">=</span><span class="st">&#39;~/Downloads/pos_level/0.5_res_tree_filtering.csv&#39;</span>,</span>
<span id="cb51-3"><a href="id_03_candidate_prioritization.html#cb51-3" aria-hidden="true" tabindex="-1"></a>           pickle_path<span class="op">=</span><span class="st">&#39;~/Downloads/pos_level/0.5_purf_tree_filtering.pkl&#39;</span>,</span>
<span id="cb51-4"><a href="id_03_candidate_prioritization.html#cb51-4" aria-hidden="true" tabindex="-1"></a>           model_path<span class="op">=</span><span class="st">&#39;~/Downloads/pos_lebel/0.5_purf.pkl&#39;</span>,</span>
<span id="cb51-5"><a href="id_03_candidate_prioritization.html#cb51-5" aria-hidden="true" tabindex="-1"></a>           n_jobs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-6"><a href="id_03_candidate_prioritization.html#cb51-6" aria-hidden="true" tabindex="-1"></a>wo_tree_filtering <span class="op">=</span> pd.read_csv(<span class="st">&#39;~/Downloads/pos_level/0.5_res.csv&#39;</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-7"><a href="id_03_candidate_prioritization.html#cb51-7" aria-hidden="true" tabindex="-1"></a>w_tree_filtering <span class="op">=</span> pd.read_csv(<span class="st">&#39;~/Downloads/pos_level/0.5_res_tree_filtering.csv&#39;</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-8"><a href="id_03_candidate_prioritization.html#cb51-8" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat([wo_tree_filtering, w_tree_filtering[<span class="st">&#39;OOB score&#39;</span>]], join<span class="op">=</span><span class="st">&#39;outer&#39;</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-9"><a href="id_03_candidate_prioritization.html#cb51-9" aria-hidden="true" tabindex="-1"></a>merged_df.columns <span class="op">=</span> [<span class="st">&#39;antigen_label&#39;</span>, <span class="st">&#39;oob_score_without_tree_filtering&#39;</span>, <span class="st">&#39;oob_score_with_tree_filtering&#39;</span>]</span>
<span id="cb51-10"><a href="id_03_candidate_prioritization.html#cb51-10" aria-hidden="true" tabindex="-1"></a>merged_df.to_csv(<span class="st">&#39;./data/supplementary_data_4_purf_oob_predictions.csv&#39;</span>)</span></code></pre></div>
</div>
<div id="validation-for-purf-without-tree-filtering" class="section level4 hasAnchor" number="3.1.1.2">
<h4><span class="header-section-number">3.1.1.2</span> Validation for PURF without tree filtering<a href="id_03_candidate_prioritization.html#validation-for-purf-without-tree-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>In Python: </strong></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb52-1"><a href="id_03_candidate_prioritization.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (idx, (antigen, out)) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(pf3d7_features.index, pf3d7_outcome)):</span>
<span id="cb52-2"><a href="id_03_candidate_prioritization.html#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> out <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb52-3"><a href="id_03_candidate_prioritization.html#cb52-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> antigen <span class="kw">in</span> REF_ANTIGENS.values():</span>
<span id="cb52-4"><a href="id_03_candidate_prioritization.html#cb52-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb52-5"><a href="id_03_candidate_prioritization.html#cb52-5" aria-hidden="true" tabindex="-1"></a>        pf3d7_outcome_ <span class="op">=</span> pf3d7_outcome.copy()</span>
<span id="cb52-6"><a href="id_03_candidate_prioritization.html#cb52-6" aria-hidden="true" tabindex="-1"></a>        pf3d7_outcome_[idx] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-7"><a href="id_03_candidate_prioritization.html#cb52-7" aria-hidden="true" tabindex="-1"></a>        train_purf(pf3d7_features, pf3d7_outcome_,</span>
<span id="cb52-8"><a href="id_03_candidate_prioritization.html#cb52-8" aria-hidden="true" tabindex="-1"></a>                   res_path<span class="op">=</span><span class="st">&#39;~/Downloads/jackknife/&#39;</span> <span class="op">+</span> antigen <span class="op">+</span> <span class="st">&#39;_res.csv&#39;</span>,</span>
<span id="cb52-9"><a href="id_03_candidate_prioritization.html#cb52-9" aria-hidden="true" tabindex="-1"></a>                   pickle_path<span class="op">=</span><span class="st">&#39;~/Downloads/jackknife/&#39;</span> <span class="op">+</span> antigen <span class="op">+</span> <span class="st">&#39;_purf.pkl&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb53-1"><a href="id_03_candidate_prioritization.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">dir</span> <span class="op">=</span> <span class="st">&#39;~/Downloads/jackknife/&#39;</span></span>
<span id="cb53-2"><a href="id_03_candidate_prioritization.html#cb53-2" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> os.listdir(<span class="bu">dir</span>)</span>
<span id="cb53-3"><a href="id_03_candidate_prioritization.html#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="id_03_candidate_prioritization.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb53-5"><a href="id_03_candidate_prioritization.html#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;csv&#39;</span>):</span>
<span id="cb53-6"><a href="id_03_candidate_prioritization.html#cb53-6" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">=</span> pd.read_csv(<span class="bu">dir</span> <span class="op">+</span> <span class="bu">file</span>, index_col<span class="op">=</span><span class="dv">0</span>)[<span class="st">&#39;antigen_label&#39;</span>]</span>
<span id="cb53-7"><a href="id_03_candidate_prioritization.html#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb53-8"><a href="id_03_candidate_prioritization.html#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="id_03_candidate_prioritization.html#cb53-9" aria-hidden="true" tabindex="-1"></a>data_frames <span class="op">=</span> [pd.read_csv(<span class="bu">dir</span> <span class="op">+</span> <span class="bu">file</span>, index_col<span class="op">=</span><span class="dv">0</span>)[<span class="st">&#39;OOB score&#39;</span>] <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;csv&#39;</span>)]</span>
<span id="cb53-10"><a href="id_03_candidate_prioritization.html#cb53-10" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat([tmp] <span class="op">+</span> data_frames, join<span class="op">=</span><span class="st">&#39;outer&#39;</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb53-11"><a href="id_03_candidate_prioritization.html#cb53-11" aria-hidden="true" tabindex="-1"></a>colnames <span class="op">=</span> [<span class="st">&#39;antigen_label&#39;</span>] <span class="op">+</span> [re.match(<span class="st">&#39;PF3D7_[0-9]+\.[0-9]-p1&#39;</span>, <span class="bu">file</span>)[<span class="dv">0</span>] <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;csv&#39;</span>)]</span>
<span id="cb53-12"><a href="id_03_candidate_prioritization.html#cb53-12" aria-hidden="true" tabindex="-1"></a>merged_df.columns <span class="op">=</span> colnames</span>
<span id="cb53-13"><a href="id_03_candidate_prioritization.html#cb53-13" aria-hidden="true" tabindex="-1"></a>merged_df.to_csv(<span class="st">&#39;./data/supplementary_data_5_validation.csv&#39;</span>)</span></code></pre></div>
</div>
<div id="validation-for-purf-with-tree-filtering" class="section level4 hasAnchor" number="3.1.1.3">
<h4><span class="header-section-number">3.1.1.3</span> Validation for PURF with tree filtering<a href="id_03_candidate_prioritization.html#validation-for-purf-with-tree-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>In Python: </strong></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb54-1"><a href="id_03_candidate_prioritization.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (idx, (antigen, out)) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(pf3d7_features.index, pf3d7_outcome)):</span>
<span id="cb54-2"><a href="id_03_candidate_prioritization.html#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> out <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb54-3"><a href="id_03_candidate_prioritization.html#cb54-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> antigen <span class="kw">in</span> REF_ANTIGENS.values():</span>
<span id="cb54-4"><a href="id_03_candidate_prioritization.html#cb54-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb54-5"><a href="id_03_candidate_prioritization.html#cb54-5" aria-hidden="true" tabindex="-1"></a>        pf3d7_outcome_ <span class="op">=</span> pf3d7_outcome.copy()</span>
<span id="cb54-6"><a href="id_03_candidate_prioritization.html#cb54-6" aria-hidden="true" tabindex="-1"></a>        pf3d7_outcome_[idx] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-7"><a href="id_03_candidate_prioritization.html#cb54-7" aria-hidden="true" tabindex="-1"></a>        train_purf(pf3d7_features, pf3d7_outcome_,</span>
<span id="cb54-8"><a href="id_03_candidate_prioritization.html#cb54-8" aria-hidden="true" tabindex="-1"></a>                   res_path<span class="op">=</span><span class="st">&#39;~/Downloads/tree_filtering_jackknife/&#39;</span> <span class="op">+</span> antigen <span class="op">+</span> <span class="st">&#39;_res.csv&#39;</span>,</span>
<span id="cb54-9"><a href="id_03_candidate_prioritization.html#cb54-9" aria-hidden="true" tabindex="-1"></a>                   pickle_path<span class="op">=</span><span class="st">&#39;~/Downloads/tree_filtering_jackknife/&#39;</span> <span class="op">+</span> antigen <span class="op">+</span> <span class="st">&#39;_purf.pkl&#39;</span>,</span>
<span id="cb54-10"><a href="id_03_candidate_prioritization.html#cb54-10" aria-hidden="true" tabindex="-1"></a>                   model_path<span class="op">=</span><span class="st">&#39;~/Downloads/jackknife/&#39;</span> <span class="op">+</span> antigen <span class="op">+</span> <span class="st">&#39;_purf.pkl&#39;</span>,</span>
<span id="cb54-11"><a href="id_03_candidate_prioritization.html#cb54-11" aria-hidden="true" tabindex="-1"></a>                   n_jobs<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb55-1"><a href="id_03_candidate_prioritization.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="bu">dir</span> <span class="op">=</span> <span class="st">&#39;~/Downloads/tree_filtering_jackknife/&#39;</span></span>
<span id="cb55-2"><a href="id_03_candidate_prioritization.html#cb55-2" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> os.listdir(<span class="bu">dir</span>)</span>
<span id="cb55-3"><a href="id_03_candidate_prioritization.html#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="id_03_candidate_prioritization.html#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb55-5"><a href="id_03_candidate_prioritization.html#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;csv&#39;</span>):</span>
<span id="cb55-6"><a href="id_03_candidate_prioritization.html#cb55-6" aria-hidden="true" tabindex="-1"></a>        tmp <span class="op">=</span> pd.read_csv(<span class="bu">dir</span> <span class="op">+</span> <span class="bu">file</span>, index_col<span class="op">=</span><span class="dv">0</span>)[<span class="st">&#39;antigen_label&#39;</span>]</span>
<span id="cb55-7"><a href="id_03_candidate_prioritization.html#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb55-8"><a href="id_03_candidate_prioritization.html#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="id_03_candidate_prioritization.html#cb55-9" aria-hidden="true" tabindex="-1"></a>data_frames <span class="op">=</span> [pd.read_csv(<span class="bu">dir</span> <span class="op">+</span> <span class="bu">file</span>, index_col<span class="op">=</span><span class="dv">0</span>)[<span class="st">&#39;OOB score&#39;</span>] <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;csv&#39;</span>)]</span>
<span id="cb55-10"><a href="id_03_candidate_prioritization.html#cb55-10" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat([tmp] <span class="op">+</span> data_frames, join<span class="op">=</span><span class="st">&#39;outer&#39;</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb55-11"><a href="id_03_candidate_prioritization.html#cb55-11" aria-hidden="true" tabindex="-1"></a>colnames <span class="op">=</span> [<span class="st">&#39;antigen_label&#39;</span>] <span class="op">+</span> [re.match(<span class="st">&#39;PF3D7_[0-9]+\.[0-9]-p1&#39;</span>, <span class="bu">file</span>)[<span class="dv">0</span>] <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;csv&#39;</span>)]</span>
<span id="cb55-12"><a href="id_03_candidate_prioritization.html#cb55-12" aria-hidden="true" tabindex="-1"></a>merged_df.columns <span class="op">=</span> colnames</span>
<span id="cb55-13"><a href="id_03_candidate_prioritization.html#cb55-13" aria-hidden="true" tabindex="-1"></a>merged_df.to_csv(<span class="st">&#39;./data/supplementary_data_6_tree_filtering_validation.csv&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="plotting-3" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Plotting<a href="id_03_candidate_prioritization.html#plotting-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>In R: </strong></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb56-1"><a href="id_03_candidate_prioritization.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mixR)</span>
<span id="cb56-2"><a href="id_03_candidate_prioritization.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span>
<span id="cb56-3"><a href="id_03_candidate_prioritization.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlist)</span>
<span id="cb56-4"><a href="id_03_candidate_prioritization.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb56-5"><a href="id_03_candidate_prioritization.html#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb56-6"><a href="id_03_candidate_prioritization.html#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb56-7"><a href="id_03_candidate_prioritization.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggbeeswarm)</span>
<span id="cb56-8"><a href="id_03_candidate_prioritization.html#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb57-1"><a href="id_03_candidate_prioritization.html#cb57-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/supplementary_data_4_purf_oob_predictions.csv&quot;</span>, <span class="at">row.names =</span> <span class="dv">1</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-2"><a href="id_03_candidate_prioritization.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract data with only unlabeled proteins</span></span>
<span id="cb57-3"><a href="id_03_candidate_prioritization.html#cb57-3" aria-hidden="true" tabindex="-1"></a>data_unl <span class="ot">&lt;-</span> data[data<span class="sc">$</span>antigen_label <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb57-4"><a href="id_03_candidate_prioritization.html#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="id_03_candidate_prioritization.html#cb57-5" aria-hidden="true" tabindex="-1"></a>validation_wo_tree_filtering <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/supplementary_data_5_validation.csv&quot;</span>, <span class="at">row.names =</span> <span class="dv">1</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-6"><a href="id_03_candidate_prioritization.html#cb57-6" aria-hidden="true" tabindex="-1"></a>validation_w_tree_filtering <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/supplementary_data_6_tree_filtering_validation.csv&quot;</span>, <span class="at">row.names =</span> <span class="dv">1</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="plot-score-distribution" class="section level4 hasAnchor" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Plot score distribution<a href="id_03_candidate_prioritization.html#plot-score-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb58"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb58-1"><a href="id_03_candidate_prioritization.html#cb58-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">mixfit</span>(data_unl[, <span class="st">&quot;oob_score_with_tree_filtering&quot;</span>], <span class="at">ncomp =</span> <span class="dv">2</span>)</span>
<span id="cb58-2"><a href="id_03_candidate_prioritization.html#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="id_03_candidate_prioritization.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate receiver operating characteristic (ROC) curve</span></span>
<span id="cb58-4"><a href="id_03_candidate_prioritization.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for putative positive and negative samples</span></span>
<span id="cb58-5"><a href="id_03_candidate_prioritization.html#cb58-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb58-6"><a href="id_03_candidate_prioritization.html#cb58-6" aria-hidden="true" tabindex="-1"></a>neg_cum <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(x, <span class="at">mean =</span> fit<span class="sc">$</span>mu[<span class="dv">1</span>], <span class="at">sd =</span> fit<span class="sc">$</span>sd[<span class="dv">1</span>])</span>
<span id="cb58-7"><a href="id_03_candidate_prioritization.html#cb58-7" aria-hidden="true" tabindex="-1"></a>pos_cum <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(x, <span class="at">mean =</span> fit<span class="sc">$</span>mu[<span class="dv">2</span>], <span class="at">sd =</span> fit<span class="sc">$</span>sd[<span class="dv">2</span>])</span>
<span id="cb58-8"><a href="id_03_candidate_prioritization.html#cb58-8" aria-hidden="true" tabindex="-1"></a>fpr <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> neg_cum) <span class="sc">/</span> ((<span class="dv">1</span> <span class="sc">-</span> neg_cum) <span class="sc">+</span> neg_cum) <span class="co"># false positive / (false positive + true negative)</span></span>
<span id="cb58-9"><a href="id_03_candidate_prioritization.html#cb58-9" aria-hidden="true" tabindex="-1"></a>tpr <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> pos_cum) <span class="sc">/</span> ((<span class="dv">1</span> <span class="sc">-</span> pos_cum) <span class="sc">+</span> pos_cum) <span class="co"># true positive / (true positive + false negative)</span></span>
<span id="cb58-10"><a href="id_03_candidate_prioritization.html#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="id_03_candidate_prioritization.html#cb58-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(fit, <span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">&quot;PURF with tree filtering&quot;</span>, <span class="st">&quot; (AUROC = &quot;</span>, <span class="fu">round</span>(<span class="fu">trapz</span>(<span class="sc">-</span>fpr, tpr), <span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb58-12"><a href="id_03_candidate_prioritization.html#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Putative negative&quot;</span>, <span class="st">&quot;Putative positive&quot;</span>)) <span class="sc">+</span></span>
<span id="cb58-13"><a href="id_03_candidate_prioritization.html#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb58-14"><a href="id_03_candidate_prioritization.html#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb58-15"><a href="id_03_candidate_prioritization.html#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb58-16"><a href="id_03_candidate_prioritization.html#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb58-17"><a href="id_03_candidate_prioritization.html#cb58-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb58-18"><a href="id_03_candidate_prioritization.html#cb58-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb58-19"><a href="id_03_candidate_prioritization.html#cb58-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb58-20"><a href="id_03_candidate_prioritization.html#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb58-21"><a href="id_03_candidate_prioritization.html#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb58-22"><a href="id_03_candidate_prioritization.html#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb58-23"><a href="id_03_candidate_prioritization.html#cb58-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.9</span>),</span>
<span id="cb58-24"><a href="id_03_candidate_prioritization.html#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_blank</span>()</span>
<span id="cb58-25"><a href="id_03_candidate_prioritization.html#cb58-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-26"><a href="id_03_candidate_prioritization.html#cb58-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb58-27"><a href="id_03_candidate_prioritization.html#cb58-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Score (proportion of votes)&quot;</span>) <span class="sc">+</span></span>
<span id="cb58-28"><a href="id_03_candidate_prioritization.html#cb58-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Density&quot;</span>)</span></code></pre></div>
</div>
<div id="percent-rank-for-labeled-positives" class="section level4 hasAnchor" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Percent rank for labeled positives<a href="id_03_candidate_prioritization.html#percent-rank-for-labeled-positives" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb59"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb59-1"><a href="id_03_candidate_prioritization.html#cb59-1" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> data[<span class="fu">c</span>(<span class="st">&quot;antigen_label&quot;</span>, <span class="st">&quot;oob_score_with_tree_filtering&quot;</span>)]</span>
<span id="cb59-2"><a href="id_03_candidate_prioritization.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;antigen_label&quot;</span>, <span class="st">&quot;OOB score&quot;</span>)</span>
<span id="cb59-3"><a href="id_03_candidate_prioritization.html#cb59-3" aria-hidden="true" tabindex="-1"></a>data_<span class="sc">$</span>percent_rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(data_[[<span class="st">&quot;OOB score&quot;</span>]]) <span class="sc">/</span> <span class="fu">nrow</span>(data)</span>
<span id="cb59-4"><a href="id_03_candidate_prioritization.html#cb59-4" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> data_[data<span class="sc">$</span>antigen_label <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb59-5"><a href="id_03_candidate_prioritization.html#cb59-5" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> data_[<span class="fu">order</span>(<span class="sc">-</span>data_<span class="sc">$</span>percent_rank), ]</span>
<span id="cb59-6"><a href="id_03_candidate_prioritization.html#cb59-6" aria-hidden="true" tabindex="-1"></a>data_<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_) <span class="sc">/</span> <span class="fu">nrow</span>(data_)</span>
<span id="cb59-7"><a href="id_03_candidate_prioritization.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&quot;EPR: &quot;</span>, <span class="fu">sum</span>(data_<span class="sc">$</span><span class="st">`</span><span class="at">OOB score</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="fu">nrow</span>(data_), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb59-8"><a href="id_03_candidate_prioritization.html#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="id_03_candidate_prioritization.html#cb59-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="st">`</span><span class="at">percent_rank</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb59-10"><a href="id_03_candidate_prioritization.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-11"><a href="id_03_candidate_prioritization.html#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb59-12"><a href="id_03_candidate_prioritization.html#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">`</span><span class="at">OOB score</span><span class="st">`</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb59-13"><a href="id_03_candidate_prioritization.html#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>, <span class="at">midpoint =</span> <span class="fl">0.5</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb59-14"><a href="id_03_candidate_prioritization.html#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb59-15"><a href="id_03_candidate_prioritization.html#cb59-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb59-16"><a href="id_03_candidate_prioritization.html#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-17"><a href="id_03_candidate_prioritization.html#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-18"><a href="id_03_candidate_prioritization.html#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb59-19"><a href="id_03_candidate_prioritization.html#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb59-20"><a href="id_03_candidate_prioritization.html#cb59-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb59-21"><a href="id_03_candidate_prioritization.html#cb59-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb59-22"><a href="id_03_candidate_prioritization.html#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb59-23"><a href="id_03_candidate_prioritization.html#cb59-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb59-24"><a href="id_03_candidate_prioritization.html#cb59-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.35</span>, <span class="fl">0.15</span>),</span>
<span id="cb59-25"><a href="id_03_candidate_prioritization.html#cb59-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_blank</span>()</span>
<span id="cb59-26"><a href="id_03_candidate_prioritization.html#cb59-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-27"><a href="id_03_candidate_prioritization.html#cb59-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_colourbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">direction =</span> <span class="st">&quot;horizontal&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-28"><a href="id_03_candidate_prioritization.html#cb59-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">&quot;PURF with tree filtering&quot;</span>, <span class="st">&quot; (AUC = &quot;</span>, <span class="fu">round</span>(<span class="fu">trapz</span>(<span class="fu">c</span>(<span class="dv">0</span>, data_<span class="sc">$</span>x, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">1</span>, data_<span class="sc">$</span>percent_rank, <span class="dv">0</span>)), <span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-29"><a href="id_03_candidate_prioritization.html#cb59-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb59-30"><a href="id_03_candidate_prioritization.html#cb59-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Ranked known antigens (scaled)&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-31"><a href="id_03_candidate_prioritization.html#cb59-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Percent rank&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-32"><a href="id_03_candidate_prioritization.html#cb59-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">&quot;Score (proportion of votes)&quot;</span>)</span></code></pre></div>
</div>
<div id="comparison-of-known-antigens" class="section level4 hasAnchor" number="3.1.2.3">
<h4><span class="header-section-number">3.1.2.3</span> Comparison of known antigens<a href="id_03_candidate_prioritization.html#comparison-of-known-antigens" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb60"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb60-1"><a href="id_03_candidate_prioritization.html#cb60-1" aria-hidden="true" tabindex="-1"></a>calculate_known_antigen_scores <span class="ot">&lt;-</span> <span class="cf">function</span>(validation_data, baseline_scores) {</span>
<span id="cb60-2"><a href="id_03_candidate_prioritization.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  scores <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb60-3"><a href="id_03_candidate_prioritization.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(validation_data)) {</span>
<span id="cb60-4"><a href="id_03_candidate_prioritization.html#cb60-4" aria-hidden="true" tabindex="-1"></a>    known_antigen <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">colnames</span>(validation_data))[i]</span>
<span id="cb60-5"><a href="id_03_candidate_prioritization.html#cb60-5" aria-hidden="true" tabindex="-1"></a>    other_antigens <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">colnames</span>(validation_data))[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, i)]</span>
<span id="cb60-6"><a href="id_03_candidate_prioritization.html#cb60-6" aria-hidden="true" tabindex="-1"></a>    scores <span class="ot">&lt;-</span> <span class="fu">c</span>(scores, <span class="fu">mean</span>(validation_data[other_antigens, known_antigen] <span class="sc">-</span> baseline_scores[other_antigens, ]))</span>
<span id="cb60-7"><a href="id_03_candidate_prioritization.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-8"><a href="id_03_candidate_prioritization.html#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(scores)</span>
<span id="cb60-9"><a href="id_03_candidate_prioritization.html#cb60-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-10"><a href="id_03_candidate_prioritization.html#cb60-10" aria-hidden="true" tabindex="-1"></a>scores_wo_tree_filtering <span class="ot">&lt;-</span> <span class="fu">calculate_known_antigen_scores</span>(</span>
<span id="cb60-11"><a href="id_03_candidate_prioritization.html#cb60-11" aria-hidden="true" tabindex="-1"></a>  validation_wo_tree_filtering,</span>
<span id="cb60-12"><a href="id_03_candidate_prioritization.html#cb60-12" aria-hidden="true" tabindex="-1"></a>  data[<span class="st">&quot;oob_score_without_tree_filtering&quot;</span>]</span>
<span id="cb60-13"><a href="id_03_candidate_prioritization.html#cb60-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-14"><a href="id_03_candidate_prioritization.html#cb60-14" aria-hidden="true" tabindex="-1"></a>scores_w_tree_filtering <span class="ot">&lt;-</span> <span class="fu">calculate_known_antigen_scores</span>(</span>
<span id="cb60-15"><a href="id_03_candidate_prioritization.html#cb60-15" aria-hidden="true" tabindex="-1"></a>  validation_w_tree_filtering,</span>
<span id="cb60-16"><a href="id_03_candidate_prioritization.html#cb60-16" aria-hidden="true" tabindex="-1"></a>  data[<span class="st">&quot;oob_score_with_tree_filtering&quot;</span>]</span>
<span id="cb60-17"><a href="id_03_candidate_prioritization.html#cb60-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-18"><a href="id_03_candidate_prioritization.html#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="id_03_candidate_prioritization.html#cb60-19" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-20"><a href="id_03_candidate_prioritization.html#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">factor</span>(<span class="fu">c</span>(</span>
<span id="cb60-21"><a href="id_03_candidate_prioritization.html#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(scores_wo_tree_filtering)),</span>
<span id="cb60-22"><a href="id_03_candidate_prioritization.html#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(scores_w_tree_filtering))</span>
<span id="cb60-23"><a href="id_03_candidate_prioritization.html#cb60-23" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb60-24"><a href="id_03_candidate_prioritization.html#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">score =</span> <span class="fu">c</span>(scores_wo_tree_filtering, scores_w_tree_filtering),</span>
<span id="cb60-25"><a href="id_03_candidate_prioritization.html#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">paired =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>, <span class="dv">2</span>)</span>
<span id="cb60-26"><a href="id_03_candidate_prioritization.html#cb60-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-27"><a href="id_03_candidate_prioritization.html#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="id_03_candidate_prioritization.html#cb60-28" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">compare_means</span>(score <span class="sc">~</span> group, <span class="at">data =</span> data_, <span class="at">method =</span> <span class="st">&quot;wilcox.test&quot;</span>, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-29"><a href="id_03_candidate_prioritization.html#cb60-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-30"><a href="id_03_candidate_prioritization.html#cb60-30" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">y =</span> score)) <span class="sc">+</span></span>
<span id="cb60-31"><a href="id_03_candidate_prioritization.html#cb60-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-32"><a href="id_03_candidate_prioritization.html#cb60-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> group), <span class="at">outlier.color =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb60-33"><a href="id_03_candidate_prioritization.html#cb60-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> paired), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-34"><a href="id_03_candidate_prioritization.html#cb60-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_beeswarm</span>(<span class="fu">aes</span>(<span class="at">fill =</span> group),</span>
<span id="cb60-35"><a href="id_03_candidate_prioritization.html#cb60-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">priority =</span> <span class="st">&quot;random&quot;</span>,</span>
<span id="cb60-36"><a href="id_03_candidate_prioritization.html#cb60-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span></span>
<span id="cb60-37"><a href="id_03_candidate_prioritization.html#cb60-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-38"><a href="id_03_candidate_prioritization.html#cb60-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#f7d59e&quot;</span>, <span class="st">&quot;#fcd7d7&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-39"><a href="id_03_candidate_prioritization.html#cb60-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#fc9d03&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Without tree filtering&quot;</span>, <span class="st">&quot;With tree filtering&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-40"><a href="id_03_candidate_prioritization.html#cb60-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Without tree filtering&quot;</span>, <span class="st">&quot;With tree filtering&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-41"><a href="id_03_candidate_prioritization.html#cb60-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb60-42"><a href="id_03_candidate_prioritization.html#cb60-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb60-43"><a href="id_03_candidate_prioritization.html#cb60-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb60-44"><a href="id_03_candidate_prioritization.html#cb60-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb60-45"><a href="id_03_candidate_prioritization.html#cb60-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb60-46"><a href="id_03_candidate_prioritization.html#cb60-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb60-47"><a href="id_03_candidate_prioritization.html#cb60-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb60-48"><a href="id_03_candidate_prioritization.html#cb60-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb60-49"><a href="id_03_candidate_prioritization.html#cb60-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">18</span>, <span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb60-50"><a href="id_03_candidate_prioritization.html#cb60-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb60-51"><a href="id_03_candidate_prioritization.html#cb60-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb60-52"><a href="id_03_candidate_prioritization.html#cb60-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb60-53"><a href="id_03_candidate_prioritization.html#cb60-53" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-54"><a href="id_03_candidate_prioritization.html#cb60-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean difference in scores (proportion of votes)&quot;</span>)</span></code></pre></div>
</div>
<div id="comparison-of-top-200-candidates" class="section level4 hasAnchor" number="3.1.2.4">
<h4><span class="header-section-number">3.1.2.4</span> Comparison of top 200 candidates<a href="id_03_candidate_prioritization.html#comparison-of-top-200-candidates" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb61"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb61-1"><a href="id_03_candidate_prioritization.html#cb61-1" aria-hidden="true" tabindex="-1"></a>calculate_overlapping_candidates <span class="ot">&lt;-</span> <span class="cf">function</span>(data, validation_data) {</span>
<span id="cb61-2"><a href="id_03_candidate_prioritization.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  top_200 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb61-3"><a href="id_03_candidate_prioritization.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>) {</span>
<span id="cb61-4"><a href="id_03_candidate_prioritization.html#cb61-4" aria-hidden="true" tabindex="-1"></a>    data_ <span class="ot">&lt;-</span> validation_data[data<span class="sc">$</span>antigen_label <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb61-5"><a href="id_03_candidate_prioritization.html#cb61-5" aria-hidden="true" tabindex="-1"></a>    data_ <span class="ot">&lt;-</span> data_[<span class="fu">order</span>(<span class="sc">-</span>data_[, <span class="dv">1</span> <span class="sc">+</span> i]), ][<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>, ]</span>
<span id="cb61-6"><a href="id_03_candidate_prioritization.html#cb61-6" aria-hidden="true" tabindex="-1"></a>    top_200 <span class="ot">&lt;-</span> <span class="fu">list.append</span>(top_200, <span class="fu">rownames</span>(data_))</span>
<span id="cb61-7"><a href="id_03_candidate_prioritization.html#cb61-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-8"><a href="id_03_candidate_prioritization.html#cb61-8" aria-hidden="true" tabindex="-1"></a>  union_top_200 <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">unlist</span>(top_200))</span>
<span id="cb61-9"><a href="id_03_candidate_prioritization.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="fu">length</span>(union_top_200), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb61-10"><a href="id_03_candidate_prioritization.html#cb61-10" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(union_top_200), <span class="at">ncol =</span> <span class="dv">48</span>))</span>
<span id="cb61-11"><a href="id_03_candidate_prioritization.html#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(mat) <span class="ot">&lt;-</span> union_top_200</span>
<span id="cb61-12"><a href="id_03_candidate_prioritization.html#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(mat) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">48</span></span>
<span id="cb61-13"><a href="id_03_candidate_prioritization.html#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>) mat[top_200[[i]], i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb61-14"><a href="id_03_candidate_prioritization.html#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">apply</span>(mat, <span class="dv">1</span>, sum))</span>
<span id="cb61-15"><a href="id_03_candidate_prioritization.html#cb61-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-16"><a href="id_03_candidate_prioritization.html#cb61-16" aria-hidden="true" tabindex="-1"></a>agreement_wo_tree_filtering <span class="ot">&lt;-</span> <span class="fu">calculate_overlapping_candidates</span>(data, validation_wo_tree_filtering)</span>
<span id="cb61-17"><a href="id_03_candidate_prioritization.html#cb61-17" aria-hidden="true" tabindex="-1"></a>agreement_w_tree_filtering <span class="ot">&lt;-</span> <span class="fu">calculate_overlapping_candidates</span>(data, validation_w_tree_filtering)</span>
<span id="cb61-18"><a href="id_03_candidate_prioritization.html#cb61-18" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(agreement_wo_tree_filtering <span class="sc">&gt;=</span> x))</span>
<span id="cb61-19"><a href="id_03_candidate_prioritization.html#cb61-19" aria-hidden="true" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(agreement_w_tree_filtering <span class="sc">&gt;=</span> x))</span>
<span id="cb61-20"><a href="id_03_candidate_prioritization.html#cb61-20" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-21"><a href="id_03_candidate_prioritization.html#cb61-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">48</span>, <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(y1, y2),</span>
<span id="cb61-22"><a href="id_03_candidate_prioritization.html#cb61-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(y1)), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(y2))))</span>
<span id="cb61-23"><a href="id_03_candidate_prioritization.html#cb61-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-24"><a href="id_03_candidate_prioritization.html#cb61-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-25"><a href="id_03_candidate_prioritization.html#cb61-25" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> group)) <span class="sc">+</span></span>
<span id="cb61-26"><a href="id_03_candidate_prioritization.html#cb61-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb61-27"><a href="id_03_candidate_prioritization.html#cb61-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#fc9d03&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Without tree filtering&quot;</span>, <span class="st">&quot;With tree filtering&quot;</span>)) <span class="sc">+</span></span>
<span id="cb61-28"><a href="id_03_candidate_prioritization.html#cb61-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">48</span>, <span class="dv">40</span>, <span class="dv">30</span>, <span class="dv">20</span>, <span class="dv">10</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb61-29"><a href="id_03_candidate_prioritization.html#cb61-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">114</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>)) <span class="sc">+</span></span>
<span id="cb61-30"><a href="id_03_candidate_prioritization.html#cb61-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb61-31"><a href="id_03_candidate_prioritization.html#cb61-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-32"><a href="id_03_candidate_prioritization.html#cb61-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb61-33"><a href="id_03_candidate_prioritization.html#cb61-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb61-34"><a href="id_03_candidate_prioritization.html#cb61-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb61-35"><a href="id_03_candidate_prioritization.html#cb61-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb61-36"><a href="id_03_candidate_prioritization.html#cb61-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb61-37"><a href="id_03_candidate_prioritization.html#cb61-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb61-38"><a href="id_03_candidate_prioritization.html#cb61-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb61-39"><a href="id_03_candidate_prioritization.html#cb61-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb61-40"><a href="id_03_candidate_prioritization.html#cb61-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.72</span>, <span class="fl">0.15</span>),</span>
<span id="cb61-41"><a href="id_03_candidate_prioritization.html#cb61-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb61-42"><a href="id_03_candidate_prioritization.html#cb61-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_blank</span>()</span>
<span id="cb61-43"><a href="id_03_candidate_prioritization.html#cb61-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-44"><a href="id_03_candidate_prioritization.html#cb61-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of models&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-45"><a href="id_03_candidate_prioritization.html#cb61-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Number of candidate antigens&quot;</span>)</span></code></pre></div>
<p><strong>Final plot</strong></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb62-1"><a href="id_03_candidate_prioritization.html#cb62-1" aria-hidden="true" tabindex="-1"></a>p_combined <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(p1, p2, p3, p4, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>))</span>
<span id="cb62-2"><a href="id_03_candidate_prioritization.html#cb62-2" aria-hidden="true" tabindex="-1"></a>p_combined</span></code></pre></div>
<p><img src="figures/Fig%202.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="model-interpretation" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Model interpretation<a href="id_03_candidate_prioritization.html#model-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>PURF model interpretation with permutation-based variable importance and Wilcox test.</p>
<div id="analysis-4" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Analysis<a href="id_03_candidate_prioritization.html#analysis-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="variable-importance" class="section level4 hasAnchor" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Variable importance<a href="id_03_candidate_prioritization.html#variable-importance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Permutation-based variable importance and group variable importance.</p>
<p><strong>In Python: </strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb63-1"><a href="id_03_candidate_prioritization.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb63-2"><a href="id_03_candidate_prioritization.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-3"><a href="id_03_candidate_prioritization.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-4"><a href="id_03_candidate_prioritization.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb63-5"><a href="id_03_candidate_prioritization.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb63-6"><a href="id_03_candidate_prioritization.html#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb63-7"><a href="id_03_candidate_prioritization.html#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial <span class="im">import</span> distance</span>
<span id="cb63-8"><a href="id_03_candidate_prioritization.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> multiprocessing</span>
<span id="cb63-9"><a href="id_03_candidate_prioritization.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> Parallel, delayed</span>
<span id="cb63-10"><a href="id_03_candidate_prioritization.html#cb63-10" aria-hidden="true" tabindex="-1"></a>num_cores <span class="op">=</span> multiprocessing.cpu_count()</span>
<span id="cb63-11"><a href="id_03_candidate_prioritization.html#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble._forest <span class="im">import</span> _generate_unsampled_indices</span>
<span id="cb63-12"><a href="id_03_candidate_prioritization.html#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> session_info</span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb64-1"><a href="id_03_candidate_prioritization.html#cb64-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">&#39;./other_data/pf_ml_input_processed_weighted.csv&#39;</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb64-2"><a href="id_03_candidate_prioritization.html#cb64-2" aria-hidden="true" tabindex="-1"></a>pf3d7_features_processed <span class="op">=</span> data.iloc[:,<span class="dv">1</span>:]</span>
<span id="cb64-3"><a href="id_03_candidate_prioritization.html#cb64-3" aria-hidden="true" tabindex="-1"></a>pf3d7_outcome <span class="op">=</span> np.array(data.antigen_label)</span>
<span id="cb64-4"><a href="id_03_candidate_prioritization.html#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="id_03_candidate_prioritization.html#cb64-5" aria-hidden="true" tabindex="-1"></a>purf_model <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">&#39;./pickle_data/0.5_purf_tree_filtering.pkl&#39;</span>, <span class="st">&#39;rb&#39;</span>))</span>
<span id="cb64-6"><a href="id_03_candidate_prioritization.html#cb64-6" aria-hidden="true" tabindex="-1"></a>purf <span class="op">=</span> purf_model[<span class="st">&#39;model&#39;</span>]</span>
<span id="cb64-7"><a href="id_03_candidate_prioritization.html#cb64-7" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> purf_model[<span class="st">&#39;weights&#39;</span>]</span>
<span id="cb64-8"><a href="id_03_candidate_prioritization.html#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="id_03_candidate_prioritization.html#cb64-9" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> pd.read_csv(<span class="st">&#39;./data/supplementary_data_2_pf_protein_variable_metadata.csv&#39;</span>)</span>
<span id="cb64-10"><a href="id_03_candidate_prioritization.html#cb64-10" aria-hidden="true" tabindex="-1"></a>groups <span class="op">=</span> metadata.loc[np.isin(metadata[<span class="st">&#39;column name&#39;</span>], pf3d7_features_processed.columns), <span class="st">&#39;category&#39;</span>].array</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb65-1"><a href="id_03_candidate_prioritization.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_raw_var_imp_(idx, tree, X, y, weight, groups<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb65-2"><a href="id_03_candidate_prioritization.html#cb65-2" aria-hidden="true" tabindex="-1"></a>    rng <span class="op">=</span> np.random.RandomState(idx)</span>
<span id="cb65-3"><a href="id_03_candidate_prioritization.html#cb65-3" aria-hidden="true" tabindex="-1"></a>    oob_indices <span class="op">=</span> _generate_unsampled_indices(tree.random_state, y.shape[<span class="dv">0</span>], y.shape[<span class="dv">0</span>])</span>
<span id="cb65-4"><a href="id_03_candidate_prioritization.html#cb65-4" aria-hidden="true" tabindex="-1"></a>    oob_pos <span class="op">=</span> np.intersect1d(oob_indices, np.where(y <span class="op">==</span> <span class="dv">1</span>)[<span class="dv">0</span>])</span>
<span id="cb65-5"><a href="id_03_candidate_prioritization.html#cb65-5" aria-hidden="true" tabindex="-1"></a>    noutall <span class="op">=</span> <span class="bu">len</span>(oob_pos)</span>
<span id="cb65-6"><a href="id_03_candidate_prioritization.html#cb65-6" aria-hidden="true" tabindex="-1"></a>    pred <span class="op">=</span> tree.predict_proba(X.iloc[oob_pos,:])[:, <span class="dv">1</span>]</span>
<span id="cb65-7"><a href="id_03_candidate_prioritization.html#cb65-7" aria-hidden="true" tabindex="-1"></a>    nrightall <span class="op">=</span> <span class="bu">sum</span>(pred <span class="op">==</span> y[oob_pos])</span>
<span id="cb65-8"><a href="id_03_candidate_prioritization.html#cb65-8" aria-hidden="true" tabindex="-1"></a>    imprt, impsd <span class="op">=</span> [], []</span>
<span id="cb65-9"><a href="id_03_candidate_prioritization.html#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groups <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb65-10"><a href="id_03_candidate_prioritization.html#cb65-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> var <span class="kw">in</span> <span class="bu">range</span>(X.shape[<span class="dv">1</span>]):</span>
<span id="cb65-11"><a href="id_03_candidate_prioritization.html#cb65-11" aria-hidden="true" tabindex="-1"></a>            X_temp <span class="op">=</span> X.copy()</span>
<span id="cb65-12"><a href="id_03_candidate_prioritization.html#cb65-12" aria-hidden="true" tabindex="-1"></a>            X_temp.iloc[:, var] <span class="op">=</span> rng.permutation(X_temp.iloc[:, var])</span>
<span id="cb65-13"><a href="id_03_candidate_prioritization.html#cb65-13" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> tree.predict_proba(X_temp.iloc[oob_pos,:])[:, <span class="dv">1</span>]</span>
<span id="cb65-14"><a href="id_03_candidate_prioritization.html#cb65-14" aria-hidden="true" tabindex="-1"></a>            nrightimpall <span class="op">=</span> <span class="bu">sum</span>(pred <span class="op">==</span> y[oob_pos])</span>
<span id="cb65-15"><a href="id_03_candidate_prioritization.html#cb65-15" aria-hidden="true" tabindex="-1"></a>            delta <span class="op">=</span> (nrightall <span class="op">-</span> nrightimpall) <span class="op">/</span> noutall <span class="op">*</span> weight</span>
<span id="cb65-16"><a href="id_03_candidate_prioritization.html#cb65-16" aria-hidden="true" tabindex="-1"></a>            imprt.append(delta)</span>
<span id="cb65-17"><a href="id_03_candidate_prioritization.html#cb65-17" aria-hidden="true" tabindex="-1"></a>            impsd.append(delta <span class="op">*</span> delta)</span>
<span id="cb65-18"><a href="id_03_candidate_prioritization.html#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb65-19"><a href="id_03_candidate_prioritization.html#cb65-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> grp <span class="kw">in</span> np.unique(groups):</span>
<span id="cb65-20"><a href="id_03_candidate_prioritization.html#cb65-20" aria-hidden="true" tabindex="-1"></a>            X_temp <span class="op">=</span> X.copy()</span>
<span id="cb65-21"><a href="id_03_candidate_prioritization.html#cb65-21" aria-hidden="true" tabindex="-1"></a>            X_temp.iloc[:, groups <span class="op">==</span> grp] <span class="op">=</span> rng.permutation(X_temp.iloc[:, groups <span class="op">==</span> grp])</span>
<span id="cb65-22"><a href="id_03_candidate_prioritization.html#cb65-22" aria-hidden="true" tabindex="-1"></a>            pred <span class="op">=</span> tree.predict_proba(X_temp.iloc[oob_pos,:])[:, <span class="dv">1</span>]</span>
<span id="cb65-23"><a href="id_03_candidate_prioritization.html#cb65-23" aria-hidden="true" tabindex="-1"></a>            nrightimpall <span class="op">=</span> <span class="bu">sum</span>(pred <span class="op">==</span> y[oob_pos])</span>
<span id="cb65-24"><a href="id_03_candidate_prioritization.html#cb65-24" aria-hidden="true" tabindex="-1"></a>            delta <span class="op">=</span> (nrightall <span class="op">-</span> nrightimpall) <span class="op">/</span> noutall <span class="op">*</span> weight</span>
<span id="cb65-25"><a href="id_03_candidate_prioritization.html#cb65-25" aria-hidden="true" tabindex="-1"></a>            imprt.append(delta)</span>
<span id="cb65-26"><a href="id_03_candidate_prioritization.html#cb65-26" aria-hidden="true" tabindex="-1"></a>            impsd.append(delta <span class="op">*</span> delta)</span>
<span id="cb65-27"><a href="id_03_candidate_prioritization.html#cb65-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (imprt, impsd)</span>
<span id="cb65-28"><a href="id_03_candidate_prioritization.html#cb65-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-29"><a href="id_03_candidate_prioritization.html#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_var_imp(model, features, outcome, num_cores, weights<span class="op">=</span><span class="va">None</span>, groups<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb65-30"><a href="id_03_candidate_prioritization.html#cb65-30" aria-hidden="true" tabindex="-1"></a>    trees <span class="op">=</span> model.estimators_</span>
<span id="cb65-31"><a href="id_03_candidate_prioritization.html#cb65-31" aria-hidden="true" tabindex="-1"></a>    idx_list <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(trees))]</span>
<span id="cb65-32"><a href="id_03_candidate_prioritization.html#cb65-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> weights <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb65-33"><a href="id_03_candidate_prioritization.html#cb65-33" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">=</span> np.ones(<span class="bu">len</span>(trees))</span>
<span id="cb65-34"><a href="id_03_candidate_prioritization.html#cb65-34" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> Parallel(n_jobs<span class="op">=</span>num_cores)(</span>
<span id="cb65-35"><a href="id_03_candidate_prioritization.html#cb65-35" aria-hidden="true" tabindex="-1"></a>      delayed(calculate_raw_var_imp_)(idx, trees[idx], features, outcome, weights[idx], groups) <span class="cf">for</span> idx <span class="kw">in</span> idx_list)</span>
<span id="cb65-36"><a href="id_03_candidate_prioritization.html#cb65-36" aria-hidden="true" tabindex="-1"></a>    imprt, impsd <span class="op">=</span> [], []</span>
<span id="cb65-37"><a href="id_03_candidate_prioritization.html#cb65-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(idx_list)):</span>
<span id="cb65-38"><a href="id_03_candidate_prioritization.html#cb65-38" aria-hidden="true" tabindex="-1"></a>        imprt.append(res[i][<span class="dv">0</span>])</span>
<span id="cb65-39"><a href="id_03_candidate_prioritization.html#cb65-39" aria-hidden="true" tabindex="-1"></a>        impsd.append(res[i][<span class="dv">1</span>])</span>
<span id="cb65-40"><a href="id_03_candidate_prioritization.html#cb65-40" aria-hidden="true" tabindex="-1"></a>    imprt <span class="op">=</span> np.array(imprt).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb65-41"><a href="id_03_candidate_prioritization.html#cb65-41" aria-hidden="true" tabindex="-1"></a>    impsd <span class="op">=</span> np.array(impsd).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb65-42"><a href="id_03_candidate_prioritization.html#cb65-42" aria-hidden="true" tabindex="-1"></a>    imprt <span class="op">/=</span> <span class="bu">sum</span>(weights)</span>
<span id="cb65-43"><a href="id_03_candidate_prioritization.html#cb65-43" aria-hidden="true" tabindex="-1"></a>    impsd <span class="op">=</span> np.sqrt(((impsd <span class="op">/</span> <span class="bu">sum</span>(weights)) <span class="op">-</span> imprt <span class="op">*</span> imprt) <span class="op">/</span> <span class="bu">sum</span>(weights))</span>
<span id="cb65-44"><a href="id_03_candidate_prioritization.html#cb65-44" aria-hidden="true" tabindex="-1"></a>    mda <span class="op">=</span> []</span>
<span id="cb65-45"><a href="id_03_candidate_prioritization.html#cb65-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(imprt)):</span>
<span id="cb65-46"><a href="id_03_candidate_prioritization.html#cb65-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> impsd[i] <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb65-47"><a href="id_03_candidate_prioritization.html#cb65-47" aria-hidden="true" tabindex="-1"></a>            mda.append(imprt[i] <span class="op">/</span> impsd[i])</span>
<span id="cb65-48"><a href="id_03_candidate_prioritization.html#cb65-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb65-49"><a href="id_03_candidate_prioritization.html#cb65-49" aria-hidden="true" tabindex="-1"></a>            mda.append(imprt[i])</span>
<span id="cb65-50"><a href="id_03_candidate_prioritization.html#cb65-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groups <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb65-51"><a href="id_03_candidate_prioritization.html#cb65-51" aria-hidden="true" tabindex="-1"></a>        var_imp <span class="op">=</span> pd.DataFrame({<span class="st">&#39;variable&#39;</span>: features.columns, <span class="st">&#39;meanDecreaseAccuracy&#39;</span>: mda})</span>
<span id="cb65-52"><a href="id_03_candidate_prioritization.html#cb65-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb65-53"><a href="id_03_candidate_prioritization.html#cb65-53" aria-hidden="true" tabindex="-1"></a>        var_imp <span class="op">=</span> pd.DataFrame({<span class="st">&#39;variable&#39;</span>: np.unique(groups), <span class="st">&#39;meanDecreaseAccuracy&#39;</span>: mda})</span>
<span id="cb65-54"><a href="id_03_candidate_prioritization.html#cb65-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> var_imp</span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode python fold-hide"><code class="sourceCode python"><span id="cb66-1"><a href="id_03_candidate_prioritization.html#cb66-1" aria-hidden="true" tabindex="-1"></a>var_imp <span class="op">=</span> calculate_var_imp(purf, pf3d7_features_processed, pf3d7_outcome, num_cores, weights)</span>
<span id="cb66-2"><a href="id_03_candidate_prioritization.html#cb66-2" aria-hidden="true" tabindex="-1"></a>grp_var_imp <span class="op">=</span> calculate_var_imp(purf, pf3d7_features_processed, pf3d7_outcome, num_cores, weights, groups)</span>
<span id="cb66-3"><a href="id_03_candidate_prioritization.html#cb66-3" aria-hidden="true" tabindex="-1"></a>var_imp.to_csv(<span class="st">&#39;./other_data/known_antigen_variable_importance.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb66-4"><a href="id_03_candidate_prioritization.html#cb66-4" aria-hidden="true" tabindex="-1"></a>grp_var_imp.to_csv(<span class="st">&#39;./other_data/known_antigen_group_variable_importance.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div id="wilcoxon-test" class="section level4 hasAnchor" number="3.2.1.2">
<h4><span class="header-section-number">3.2.1.2</span> Wilcoxon test<a href="id_03_candidate_prioritization.html#wilcoxon-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Variable value comparison between known antigens and other 52 random proteins predicted as negative.</p>
<p><strong>In R: </strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb67-1"><a href="id_03_candidate_prioritization.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb67-2"><a href="id_03_candidate_prioritization.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb68-1"><a href="id_03_candidate_prioritization.html#cb68-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/supplementary_data_4_purf_oob_predictions.csv&quot;</span>)</span>
<span id="cb68-2"><a href="id_03_candidate_prioritization.html#cb68-2" aria-hidden="true" tabindex="-1"></a>known_antigens <span class="ot">&lt;-</span> prediction[prediction<span class="sc">$</span>antigen_label <span class="sc">==</span> <span class="dv">1</span>, ]<span class="sc">$</span>protein_id</span>
<span id="cb68-3"><a href="id_03_candidate_prioritization.html#cb68-3" aria-hidden="true" tabindex="-1"></a>other_proteins <span class="ot">&lt;-</span> prediction[prediction<span class="sc">$</span>antigen_label <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> prediction<span class="sc">$</span>oob_score_with_tree_filtering <span class="sc">&lt;</span> <span class="fl">0.5</span>, ]<span class="sc">$</span>protein_id</span>
<span id="cb68-4"><a href="id_03_candidate_prioritization.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>)</span>
<span id="cb68-5"><a href="id_03_candidate_prioritization.html#cb68-5" aria-hidden="true" tabindex="-1"></a>random_proteins <span class="ot">&lt;-</span> <span class="fu">sample</span>(other_proteins, <span class="at">size =</span> <span class="dv">52</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-6"><a href="id_03_candidate_prioritization.html#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="id_03_candidate_prioritization.html#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load imputed data</span></span>
<span id="cb68-8"><a href="id_03_candidate_prioritization.html#cb68-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./other_data/pf_ml_input_processed_weighted.csv&quot;</span>)</span>
<span id="cb68-9"><a href="id_03_candidate_prioritization.html#cb68-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[<span class="sc">!</span><span class="fu">duplicated</span>(data), ]</span>
<span id="cb68-10"><a href="id_03_candidate_prioritization.html#cb68-10" aria-hidden="true" tabindex="-1"></a>compared_group <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data<span class="sc">$</span>X, <span class="cf">function</span>(x) <span class="cf">if</span> (x <span class="sc">%in%</span> known_antigens) <span class="dv">1</span> <span class="cf">else</span> <span class="cf">if</span> (x <span class="sc">%in%</span> random_proteins) <span class="dv">0</span> <span class="cf">else</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb68-11"><a href="id_03_candidate_prioritization.html#cb68-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[, <span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(data)]</span>
<span id="cb68-12"><a href="id_03_candidate_prioritization.html#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="id_03_candidate_prioritization.html#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Min-max normalization</span></span>
<span id="cb68-14"><a href="id_03_candidate_prioritization.html#cb68-14" aria-hidden="true" tabindex="-1"></a>min_max <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb68-15"><a href="id_03_candidate_prioritization.html#cb68-15" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">min</span>(x)) <span class="sc">/</span> (<span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x))</span>
<span id="cb68-16"><a href="id_03_candidate_prioritization.html#cb68-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-17"><a href="id_03_candidate_prioritization.html#cb68-17" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(data, min_max))</span>
<span id="cb68-18"><a href="id_03_candidate_prioritization.html#cb68-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-19"><a href="id_03_candidate_prioritization.html#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(compared_group, data, <span class="at">file =</span> <span class="st">&quot;./rdata/known_antigen_wilcox_data.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb69-1"><a href="id_03_candidate_prioritization.html#cb69-1" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb69-2"><a href="id_03_candidate_prioritization.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(data)) {</span>
<span id="cb69-3"><a href="id_03_candidate_prioritization.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">c</span>(pval, <span class="fu">wilcox.test</span>(data[compared_group <span class="sc">==</span> <span class="dv">1</span>, i], data[compared_group <span class="sc">==</span> <span class="dv">0</span>, i])<span class="sc">$</span>p.value)</span>
<span id="cb69-4"><a href="id_03_candidate_prioritization.html#cb69-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-5"><a href="id_03_candidate_prioritization.html#cb69-5" aria-hidden="true" tabindex="-1"></a>adj_pval <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(pval, <span class="at">method =</span> <span class="st">&quot;BH&quot;</span>, <span class="at">n =</span> <span class="fu">length</span>(pval))</span>
<span id="cb69-6"><a href="id_03_candidate_prioritization.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"># adj_pval = -log10(adj_pval)</span></span>
<span id="cb69-7"><a href="id_03_candidate_prioritization.html#cb69-7" aria-hidden="true" tabindex="-1"></a>wilcox_res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">variable =</span> <span class="fu">colnames</span>(data), <span class="at">adj_pval =</span> adj_pval)</span>
<span id="cb69-8"><a href="id_03_candidate_prioritization.html#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(wilcox_res, <span class="st">&quot;./other_data/known_antigen_wilcox_res.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="plotting-4" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Plotting<a href="id_03_candidate_prioritization.html#plotting-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>In R: </strong></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb70-1"><a href="id_03_candidate_prioritization.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb70-2"><a href="id_03_candidate_prioritization.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb70-3"><a href="id_03_candidate_prioritization.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb70-4"><a href="id_03_candidate_prioritization.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb70-5"><a href="id_03_candidate_prioritization.html#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="id_03_candidate_prioritization.html#cb70-6" aria-hidden="true" tabindex="-1"></a>colorset <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;genomic&quot;</span> <span class="ot">=</span> <span class="st">&quot;#0C1C63&quot;</span>, <span class="st">&quot;immunological&quot;</span> <span class="ot">=</span> <span class="st">&quot;#408002&quot;</span>, <span class="st">&quot;proteomic&quot;</span> <span class="ot">=</span> <span class="st">&quot;#0F80FF&quot;</span>, <span class="st">&quot;structural&quot;</span> <span class="ot">=</span> <span class="st">&quot;#FEAE34&quot;</span>)</span></code></pre></div>
<div id="variable-importance-1" class="section level4 hasAnchor" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Variable importance<a href="id_03_candidate_prioritization.html#variable-importance-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb71"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb71-1"><a href="id_03_candidate_prioritization.html#cb71-1" aria-hidden="true" tabindex="-1"></a>var_imp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./other_data/known_antigen_variable_importance.csv&quot;</span>)</span>
<span id="cb71-2"><a href="id_03_candidate_prioritization.html#cb71-2" aria-hidden="true" tabindex="-1"></a>var_imp <span class="ot">&lt;-</span> var_imp[<span class="fu">order</span>(<span class="sc">-</span>var_imp<span class="sc">$</span>meanDecreaseAccuracy), ]</span>
<span id="cb71-3"><a href="id_03_candidate_prioritization.html#cb71-3" aria-hidden="true" tabindex="-1"></a>var_imp <span class="ot">&lt;-</span> var_imp[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span>
<span id="cb71-4"><a href="id_03_candidate_prioritization.html#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="id_03_candidate_prioritization.html#cb71-5" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/supplementary_data_2_pf_protein_variable_metadata.csv&quot;</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-6"><a href="id_03_candidate_prioritization.html#cb71-6" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> metadata[<span class="fu">c</span>(<span class="st">&quot;category&quot;</span>, <span class="st">&quot;column name&quot;</span>)]</span>
<span id="cb71-7"><a href="id_03_candidate_prioritization.html#cb71-7" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> metadata[metadata<span class="sc">$</span><span class="st">`</span><span class="at">column name</span><span class="st">`</span> <span class="sc">%in%</span> var_imp<span class="sc">$</span>variable, ]</span>
<span id="cb71-8"><a href="id_03_candidate_prioritization.html#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="id_03_candidate_prioritization.html#cb71-9" aria-hidden="true" tabindex="-1"></a>var_imp <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> var_imp, <span class="at">y =</span> metadata, <span class="at">by.x =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">by.y =</span> <span class="st">&quot;column name&quot;</span>)</span>
<span id="cb71-10"><a href="id_03_candidate_prioritization.html#cb71-10" aria-hidden="true" tabindex="-1"></a>var_imp<span class="sc">$</span>category <span class="ot">&lt;-</span> <span class="fu">factor</span>(var_imp<span class="sc">$</span>category, <span class="at">levels =</span> <span class="fu">names</span>(colorset))</span>
<span id="cb71-11"><a href="id_03_candidate_prioritization.html#cb71-11" aria-hidden="true" tabindex="-1"></a>var_imp<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="fu">sapply</span>(var_imp<span class="sc">$</span>category, <span class="cf">function</span>(x) colorset[x])</span>
<span id="cb71-12"><a href="id_03_candidate_prioritization.html#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="id_03_candidate_prioritization.html#cb71-13" aria-hidden="true" tabindex="-1"></a>var_imp_ <span class="ot">&lt;-</span> var_imp</span>
<span id="cb71-14"><a href="id_03_candidate_prioritization.html#cb71-14" aria-hidden="true" tabindex="-1"></a>firstup <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb71-15"><a href="id_03_candidate_prioritization.html#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">substr</span>(x, <span class="dv">1</span>, <span class="dv">1</span>) <span class="ot">&lt;-</span> <span class="fu">toupper</span>(<span class="fu">substr</span>(x, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb71-16"><a href="id_03_candidate_prioritization.html#cb71-16" aria-hidden="true" tabindex="-1"></a>  x</span>
<span id="cb71-17"><a href="id_03_candidate_prioritization.html#cb71-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-18"><a href="id_03_candidate_prioritization.html#cb71-18" aria-hidden="true" tabindex="-1"></a>var_imp_<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">sapply</span>(var_imp_<span class="sc">$</span>variable, <span class="cf">function</span>(x) {</span>
<span id="cb71-19"><a href="id_03_candidate_prioritization.html#cb71-19" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(x, <span class="st">&quot;[_</span><span class="sc">\\</span><span class="st">.]&quot;</span>, <span class="st">&quot; &quot;</span>)</span>
<span id="cb71-20"><a href="id_03_candidate_prioritization.html#cb71-20" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">firstup</span>(x)</span>
<span id="cb71-21"><a href="id_03_candidate_prioritization.html#cb71-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb71-22"><a href="id_03_candidate_prioritization.html#cb71-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb71-23"><a href="id_03_candidate_prioritization.html#cb71-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-24"><a href="id_03_candidate_prioritization.html#cb71-24" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(var_imp_, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, meanDecreaseAccuracy), <span class="at">y =</span> meanDecreaseAccuracy, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb71-25"><a href="id_03_candidate_prioritization.html#cb71-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb71-26"><a href="id_03_candidate_prioritization.html#cb71-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colorset, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Genomic&quot;</span>, <span class="st">&quot;Immunological&quot;</span>, <span class="st">&quot;Proteomic&quot;</span>, <span class="st">&quot;Structural&quot;</span>)) <span class="sc">+</span></span>
<span id="cb71-27"><a href="id_03_candidate_prioritization.html#cb71-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb71-28"><a href="id_03_candidate_prioritization.html#cb71-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(var_imp<span class="sc">$</span>meanDecreaseAccuracy), <span class="fu">max</span>(var_imp<span class="sc">$</span>meanDecreaseAccuracy) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb71-29"><a href="id_03_candidate_prioritization.html#cb71-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb71-30"><a href="id_03_candidate_prioritization.html#cb71-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb71-31"><a href="id_03_candidate_prioritization.html#cb71-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb71-32"><a href="id_03_candidate_prioritization.html#cb71-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb71-33"><a href="id_03_candidate_prioritization.html#cb71-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">size =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>),</span>
<span id="cb71-34"><a href="id_03_candidate_prioritization.html#cb71-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb71-35"><a href="id_03_candidate_prioritization.html#cb71-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb71-36"><a href="id_03_candidate_prioritization.html#cb71-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb71-37"><a href="id_03_candidate_prioritization.html#cb71-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb71-38"><a href="id_03_candidate_prioritization.html#cb71-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb71-39"><a href="id_03_candidate_prioritization.html#cb71-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb71-40"><a href="id_03_candidate_prioritization.html#cb71-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb71-41"><a href="id_03_candidate_prioritization.html#cb71-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb71-42"><a href="id_03_candidate_prioritization.html#cb71-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb71-43"><a href="id_03_candidate_prioritization.html#cb71-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb71-44"><a href="id_03_candidate_prioritization.html#cb71-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>),</span>
<span id="cb71-45"><a href="id_03_candidate_prioritization.html#cb71-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">0.2</span>)</span>
<span id="cb71-46"><a href="id_03_candidate_prioritization.html#cb71-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-47"><a href="id_03_candidate_prioritization.html#cb71-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-48"><a href="id_03_candidate_prioritization.html#cb71-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean decrease in accuracy&quot;</span>)</span></code></pre></div>
</div>
<div id="group-variable-importance" class="section level4 hasAnchor" number="3.2.2.2">
<h4><span class="header-section-number">3.2.2.2</span> Group variable importance<a href="id_03_candidate_prioritization.html#group-variable-importance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb72"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb72-1"><a href="id_03_candidate_prioritization.html#cb72-1" aria-hidden="true" tabindex="-1"></a>grp_var_imp <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./other_data/known_antigen_group_variable_importance.csv&quot;</span>)</span>
<span id="cb72-2"><a href="id_03_candidate_prioritization.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="id_03_candidate_prioritization.html#cb72-3" aria-hidden="true" tabindex="-1"></a>grp_var_imp_ <span class="ot">&lt;-</span> grp_var_imp</span>
<span id="cb72-4"><a href="id_03_candidate_prioritization.html#cb72-4" aria-hidden="true" tabindex="-1"></a>grp_var_imp_<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">sapply</span>(grp_var_imp_<span class="sc">$</span>variable, <span class="cf">function</span>(x) {</span>
<span id="cb72-5"><a href="id_03_candidate_prioritization.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(x, <span class="st">&quot;[_</span><span class="sc">\\</span><span class="st">.]&quot;</span>, <span class="st">&quot; &quot;</span>)</span>
<span id="cb72-6"><a href="id_03_candidate_prioritization.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">firstup</span>(x)</span>
<span id="cb72-7"><a href="id_03_candidate_prioritization.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb72-8"><a href="id_03_candidate_prioritization.html#cb72-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb72-9"><a href="id_03_candidate_prioritization.html#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="id_03_candidate_prioritization.html#cb72-10" aria-hidden="true" tabindex="-1"></a>grp_var_imp_<span class="sc">$</span>category <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">tolower</span>(grp_var_imp_<span class="sc">$</span>variable))</span>
<span id="cb72-11"><a href="id_03_candidate_prioritization.html#cb72-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-12"><a href="id_03_candidate_prioritization.html#cb72-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grp_var_imp_, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, meanDecreaseAccuracy), <span class="at">y =</span> meanDecreaseAccuracy, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb72-13"><a href="id_03_candidate_prioritization.html#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb72-14"><a href="id_03_candidate_prioritization.html#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colorset, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Genomic&quot;</span>, <span class="st">&quot;Immunological&quot;</span>, <span class="st">&quot;Proteomic&quot;</span>, <span class="st">&quot;Structural&quot;</span>)) <span class="sc">+</span></span>
<span id="cb72-15"><a href="id_03_candidate_prioritization.html#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb72-16"><a href="id_03_candidate_prioritization.html#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">min</span>(grp_var_imp<span class="sc">$</span>meanDecreaseAccuracy), <span class="fu">max</span>(grp_var_imp<span class="sc">$</span>meanDecreaseAccuracy) <span class="sc">+</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb72-17"><a href="id_03_candidate_prioritization.html#cb72-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb72-18"><a href="id_03_candidate_prioritization.html#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb72-19"><a href="id_03_candidate_prioritization.html#cb72-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb72-20"><a href="id_03_candidate_prioritization.html#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb72-21"><a href="id_03_candidate_prioritization.html#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">size =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>),</span>
<span id="cb72-22"><a href="id_03_candidate_prioritization.html#cb72-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb72-23"><a href="id_03_candidate_prioritization.html#cb72-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb72-24"><a href="id_03_candidate_prioritization.html#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb72-25"><a href="id_03_candidate_prioritization.html#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb72-26"><a href="id_03_candidate_prioritization.html#cb72-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">57</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb72-27"><a href="id_03_candidate_prioritization.html#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb72-28"><a href="id_03_candidate_prioritization.html#cb72-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb72-29"><a href="id_03_candidate_prioritization.html#cb72-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb72-30"><a href="id_03_candidate_prioritization.html#cb72-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb72-31"><a href="id_03_candidate_prioritization.html#cb72-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb72-32"><a href="id_03_candidate_prioritization.html#cb72-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb72-33"><a href="id_03_candidate_prioritization.html#cb72-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb72-34"><a href="id_03_candidate_prioritization.html#cb72-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean decrease in accuracy&quot;</span>)</span></code></pre></div>
</div>
<div id="wilcoxon-test-1" class="section level4 hasAnchor" number="3.2.2.3">
<h4><span class="header-section-number">3.2.2.3</span> Wilcoxon test<a href="id_03_candidate_prioritization.html#wilcoxon-test-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb73"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb73-1"><a href="id_03_candidate_prioritization.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;./rdata/known_antigen_wilcox_data.RData&quot;</span>)</span>
<span id="cb73-2"><a href="id_03_candidate_prioritization.html#cb73-2" aria-hidden="true" tabindex="-1"></a>wilcox_res <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./other_data/known_antigen_wilcox_res.csv&quot;</span>)</span>
<span id="cb73-3"><a href="id_03_candidate_prioritization.html#cb73-3" aria-hidden="true" tabindex="-1"></a>wilcox_data <span class="ot">&lt;-</span> data</span>
<span id="cb73-4"><a href="id_03_candidate_prioritization.html#cb73-4" aria-hidden="true" tabindex="-1"></a>wilcox_data<span class="sc">$</span>compared_group <span class="ot">&lt;-</span> compared_group</span>
<span id="cb73-5"><a href="id_03_candidate_prioritization.html#cb73-5" aria-hidden="true" tabindex="-1"></a>wilcox_data <span class="ot">&lt;-</span> wilcox_data[wilcox_data<span class="sc">$</span>compared_group <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span>, ]</span>
<span id="cb73-6"><a href="id_03_candidate_prioritization.html#cb73-6" aria-hidden="true" tabindex="-1"></a>wilcox_data <span class="ot">&lt;-</span> <span class="fu">melt</span>(wilcox_data, <span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;compared_group&quot;</span>))</span>
<span id="cb73-7"><a href="id_03_candidate_prioritization.html#cb73-7" aria-hidden="true" tabindex="-1"></a>wilcox_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> wilcox_data, <span class="at">y =</span> <span class="fu">merge</span>(<span class="at">x =</span> var_imp, <span class="at">y =</span> wilcox_res), <span class="at">by =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">all.y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-8"><a href="id_03_candidate_prioritization.html#cb73-8" aria-hidden="true" tabindex="-1"></a>wilcox_data<span class="sc">$</span>tile_pos <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(wilcox_data))</span>
<span id="cb73-9"><a href="id_03_candidate_prioritization.html#cb73-9" aria-hidden="true" tabindex="-1"></a>wilcox_data<span class="sc">$</span>compared_group <span class="ot">&lt;-</span> <span class="fu">factor</span>(wilcox_data<span class="sc">$</span>compared_group)</span>
<span id="cb73-10"><a href="id_03_candidate_prioritization.html#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="id_03_candidate_prioritization.html#cb73-11" aria-hidden="true" tabindex="-1"></a>wilcox_data<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">sapply</span>(wilcox_data<span class="sc">$</span>variable, <span class="cf">function</span>(x) {</span>
<span id="cb73-12"><a href="id_03_candidate_prioritization.html#cb73-12" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(x, <span class="st">&quot;[_</span><span class="sc">\\</span><span class="st">.]&quot;</span>, <span class="st">&quot; &quot;</span>)</span>
<span id="cb73-13"><a href="id_03_candidate_prioritization.html#cb73-13" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">firstup</span>(x)</span>
<span id="cb73-14"><a href="id_03_candidate_prioritization.html#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb73-15"><a href="id_03_candidate_prioritization.html#cb73-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb73-16"><a href="id_03_candidate_prioritization.html#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="id_03_candidate_prioritization.html#cb73-17" aria-hidden="true" tabindex="-1"></a>adj_pval_tmp <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb73-18"><a href="id_03_candidate_prioritization.html#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(wilcox_data)) {</span>
<span id="cb73-19"><a href="id_03_candidate_prioritization.html#cb73-19" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> wilcox_data<span class="sc">$</span>adj_pval[i]</span>
<span id="cb73-20"><a href="id_03_candidate_prioritization.html#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">&gt;=</span> <span class="fl">1e-3</span>) {</span>
<span id="cb73-21"><a href="id_03_candidate_prioritization.html#cb73-21" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;italic(p) == &quot;</span>, <span class="fu">round</span>(x, <span class="dv">3</span>))</span>
<span id="cb73-22"><a href="id_03_candidate_prioritization.html#cb73-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb73-23"><a href="id_03_candidate_prioritization.html#cb73-23" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(<span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">TRUE</span>, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">&quot;e&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb73-24"><a href="id_03_candidate_prioritization.html#cb73-24" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;italic(p) == &quot;</span>, <span class="fu">as.numeric</span>(a[<span class="dv">1</span>]), <span class="st">&quot; %*% 10^&quot;</span>, <span class="fu">as.integer</span>(a[<span class="dv">2</span>]))</span>
<span id="cb73-25"><a href="id_03_candidate_prioritization.html#cb73-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-26"><a href="id_03_candidate_prioritization.html#cb73-26" aria-hidden="true" tabindex="-1"></a>  adj_pval_tmp <span class="ot">&lt;-</span> <span class="fu">c</span>(adj_pval_tmp, res)</span>
<span id="cb73-27"><a href="id_03_candidate_prioritization.html#cb73-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-28"><a href="id_03_candidate_prioritization.html#cb73-28" aria-hidden="true" tabindex="-1"></a>wilcox_data<span class="sc">$</span>adj_pval <span class="ot">&lt;-</span> adj_pval_tmp</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb74-1"><a href="id_03_candidate_prioritization.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p3_1 = ggplot(wilcox_data, aes(x=reorder(variable, meanDecreaseAccuracy), y=tile_pos)) +</span></span>
<span id="cb74-2"><a href="id_03_candidate_prioritization.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_text(aes(label=adj_pval), size=3, fontface=&#39;plain&#39;, family=&#39;sans&#39;, hjust=0, parse=TRUE) +</span></span>
<span id="cb74-3"><a href="id_03_candidate_prioritization.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_gradient(low=&#39;blue&#39;, high=&#39;red&#39;) +</span></span>
<span id="cb74-4"><a href="id_03_candidate_prioritization.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_flip() +</span></span>
<span id="cb74-5"><a href="id_03_candidate_prioritization.html#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw() +</span></span>
<span id="cb74-6"><a href="id_03_candidate_prioritization.html#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab(&#39;&#39;) +</span></span>
<span id="cb74-7"><a href="id_03_candidate_prioritization.html#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(&#39;&#39;) +</span></span>
<span id="cb74-8"><a href="id_03_candidate_prioritization.html#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylim(0, 0.5)</span></span>
<span id="cb74-9"><a href="id_03_candidate_prioritization.html#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb74-10"><a href="id_03_candidate_prioritization.html#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="co"># legend_1 = get_legend(p3_1 +</span></span>
<span id="cb74-11"><a href="id_03_candidate_prioritization.html#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                         theme(legend.title=element_text(vjust=0.7, color=&#39;black&#39;),</span></span>
<span id="cb74-12"><a href="id_03_candidate_prioritization.html#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                               legend.background=element_blank()) +</span></span>
<span id="cb74-13"><a href="id_03_candidate_prioritization.html#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                         guides(fill=guide_colorbar(title=expression(&quot;-Log&quot;[10]*&quot;FDR&quot;),</span></span>
<span id="cb74-14"><a href="id_03_candidate_prioritization.html#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                    direction = &quot;horizontal&quot;)))</span></span>
<span id="cb74-15"><a href="id_03_candidate_prioritization.html#cb74-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-16"><a href="id_03_candidate_prioritization.html#cb74-16" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(wilcox_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(variable, meanDecreaseAccuracy), <span class="at">y =</span> value, <span class="at">fill =</span> compared_group)) <span class="sc">+</span></span>
<span id="cb74-17"><a href="id_03_candidate_prioritization.html#cb74-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.color =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb74-18"><a href="id_03_candidate_prioritization.html#cb74-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb74-19"><a href="id_03_candidate_prioritization.html#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.5</span>,</span>
<span id="cb74-20"><a href="id_03_candidate_prioritization.html#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_jitterdodge</span>()</span>
<span id="cb74-21"><a href="id_03_candidate_prioritization.html#cb74-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-22"><a href="id_03_candidate_prioritization.html#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> adj_pval), <span class="at">y =</span> <span class="fl">1.1</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">family =</span> <span class="st">&quot;sans&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">parse =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb74-23"><a href="id_03_candidate_prioritization.html#cb74-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb74-24"><a href="id_03_candidate_prioritization.html#cb74-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-25"><a href="id_03_candidate_prioritization.html#cb74-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb74-26"><a href="id_03_candidate_prioritization.html#cb74-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb74-27"><a href="id_03_candidate_prioritization.html#cb74-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Known antigens&quot;</span>, <span class="st">&quot;Random predicted non-antigens&quot;</span>)</span>
<span id="cb74-28"><a href="id_03_candidate_prioritization.html#cb74-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-29"><a href="id_03_candidate_prioritization.html#cb74-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb74-30"><a href="id_03_candidate_prioritization.html#cb74-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-31"><a href="id_03_candidate_prioritization.html#cb74-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Normalized variable value&quot;</span>)</span>
<span id="cb74-32"><a href="id_03_candidate_prioritization.html#cb74-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-33"><a href="id_03_candidate_prioritization.html#cb74-33" aria-hidden="true" tabindex="-1"></a>legend_2 <span class="ot">&lt;-</span> <span class="fu">get_legend</span>(p3 <span class="sc">+</span></span>
<span id="cb74-34"><a href="id_03_candidate_prioritization.html#cb74-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb74-35"><a href="id_03_candidate_prioritization.html#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-36"><a href="id_03_candidate_prioritization.html#cb74-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-37"><a href="id_03_candidate_prioritization.html#cb74-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-38"><a href="id_03_candidate_prioritization.html#cb74-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb74-39"><a href="id_03_candidate_prioritization.html#cb74-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.35</span>, <span class="fl">0.9</span>)</span>
<span id="cb74-40"><a href="id_03_candidate_prioritization.html#cb74-40" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb74-41"><a href="id_03_candidate_prioritization.html#cb74-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-42"><a href="id_03_candidate_prioritization.html#cb74-42" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> p3 <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb74-43"><a href="id_03_candidate_prioritization.html#cb74-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-44"><a href="id_03_candidate_prioritization.html#cb74-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-45"><a href="id_03_candidate_prioritization.html#cb74-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-46"><a href="id_03_candidate_prioritization.html#cb74-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> <span class="fl">0.2</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb74-47"><a href="id_03_candidate_prioritization.html#cb74-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb74-48"><a href="id_03_candidate_prioritization.html#cb74-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.margin =</span> ggplot2<span class="sc">::</span><span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">90</span>, <span class="dv">10</span>, <span class="dv">0</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb74-49"><a href="id_03_candidate_prioritization.html#cb74-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb74-50"><a href="id_03_candidate_prioritization.html#cb74-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb74-51"><a href="id_03_candidate_prioritization.html#cb74-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb74-52"><a href="id_03_candidate_prioritization.html#cb74-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb74-53"><a href="id_03_candidate_prioritization.html#cb74-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb74-54"><a href="id_03_candidate_prioritization.html#cb74-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb74-55"><a href="id_03_candidate_prioritization.html#cb74-55" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Final plot</strong></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb75-1"><a href="id_03_candidate_prioritization.html#cb75-1" aria-hidden="true" tabindex="-1"></a>p_combined <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(</span>
<span id="cb75-2"><a href="id_03_candidate_prioritization.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(p1, p3,</span>
<span id="cb75-3"><a href="id_03_candidate_prioritization.html#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>),</span>
<span id="cb75-4"><a href="id_03_candidate_prioritization.html#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.47</span>, <span class="fl">0.53</span>)</span>
<span id="cb75-5"><a href="id_03_candidate_prioritization.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb75-6"><a href="id_03_candidate_prioritization.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(p2, <span class="cn">NULL</span>, legend_2,</span>
<span id="cb75-7"><a href="id_03_candidate_prioritization.html#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>), <span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb75-8"><a href="id_03_candidate_prioritization.html#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.47</span>, <span class="fl">0.13</span>, <span class="fl">0.4</span>)</span>
<span id="cb75-9"><a href="id_03_candidate_prioritization.html#cb75-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb75-10"><a href="id_03_candidate_prioritization.html#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.65</span>, <span class="fl">0.35</span>)</span>
<span id="cb75-11"><a href="id_03_candidate_prioritization.html#cb75-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-12"><a href="id_03_candidate_prioritization.html#cb75-12" aria-hidden="true" tabindex="-1"></a>p_combined</span></code></pre></div>
<p><img src="figures/Fig%203.png" width="100%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb76-1"><a href="id_03_candidate_prioritization.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] stringr_1.4.1    ggpubr_0.4.0     ggbeeswarm_0.6.0 cowplot_1.1.1   
## [5] ggplot2_3.4.2    rlist_0.4.6.2    pracma_2.3.8     mixR_0.2.0      
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.9        lattice_0.20-45   tidyr_1.2.0       png_0.1-7        
##  [5] assertthat_0.2.1  digest_0.6.29     utf8_1.2.2        R6_2.5.1         
##  [9] backports_1.4.1   evaluate_0.16     highr_0.9         pillar_1.8.1     
## [13] rlang_1.1.0       rstudioapi_0.14   data.table_1.14.2 car_3.1-0        
## [17] jquerylib_0.1.4   R.utils_2.12.0    R.oo_1.25.0       Matrix_1.5-3     
## [21] reticulate_1.25   rmarkdown_2.16    styler_1.8.0      munsell_0.5.0    
## [25] broom_1.0.0       compiler_4.2.3    vipor_0.4.5       xfun_0.32        
## [29] pkgconfig_2.0.3   htmltools_0.5.3   tidyselect_1.1.2  tibble_3.1.8     
## [33] bookdown_0.28     codetools_0.2-19  fansi_1.0.3       dplyr_1.0.9      
## [37] withr_2.5.0       R.methodsS3_1.8.2 jsonlite_1.8.0    gtable_0.3.0     
## [41] lifecycle_1.0.3   DBI_1.1.3         magrittr_2.0.3    scales_1.2.1     
## [45] carData_3.0-5     cli_3.6.1         stringi_1.7.8     cachem_1.0.6     
## [49] ggsignif_0.6.3    bslib_0.4.0       generics_0.1.3    vctrs_0.6.2      
## [53] tools_4.2.3       R.cache_0.16.0    glue_1.6.2        beeswarm_0.4.0   
## [57] purrr_0.3.4       abind_1.4-5       fastmap_1.1.0     yaml_2.3.5       
## [61] colorspace_2.0-3  rstatix_0.7.0     knitr_1.40        sass_0.4.2</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="id_02_model_training.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="id_04_candidate_antigen_clustering.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["main_notebook.pdf", "PDF"]],
"search": false,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
