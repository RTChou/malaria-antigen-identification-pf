% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  11pt,
  oneside]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[left=1in,right=1in,top=1.5in,bottom=1.5in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
% section formatting
\usepackage{fancyhdr}
\renewcommand{\chaptername}{Section}
\usepackage{titlesec}
\titleformat{\chapter}[display]   
{\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}   
\titlespacing*{\chapter}{0pt}{-50pt}{40pt}
\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}

% tables
\usepackage{booktabs}
\usepackage{longtable}
\usepackage[bf, singlelinecheck=off, justification=centering]{caption}

% increase color options
\usepackage{color}
\usepackage{color, colortbl}
\usepackage[dvipsnames, x11names]{xcolor}
\definecolor{carminered}{rgb}{1.0, 0.0, 0.22}

% links 
\usepackage[colorlinks=true, urlcolor=blue, linkcolor=Violet, citecolor=BrickRed, pdfborder={0 0 0}]{hyperref}
\urlstyle{tt}

\usepackage[scale=.7]{sourcecodepro}

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

\renewenvironment{quote}{\begin{VF}}{\end{VF}}
\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\makeatletter
\newenvironment{kframe}{%
\medskip{}
\setlength{\fboxsep}{.8em}
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\makeatletter
\@ifundefined{Shaded}{
}{\renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}}
\makeatother

\newenvironment{rmdblock}[1]
  {
  \begin{itemize}
  \renewcommand{\labelitemi}{
    \raisebox{-.7\height}[0pt][0pt]{
      {\setkeys{Gin}{width=3em,keepaspectratio}\includegraphics{images/#1}}
    }
  }
  \setlength{\fboxsep}{1em}
  \begin{kframe}
  \item
  }
  {
  \end{kframe}
  \end{itemize}
  }
\newenvironment{rmdnote}
  {\begin{rmdblock}{note}}
  {\end{rmdblock}}
\newenvironment{rmdcaution}
  {\begin{rmdblock}{caution}}
  {\end{rmdblock}}
\newenvironment{rmdimportant}
  {\begin{rmdblock}{important}}
  {\end{rmdblock}}
\newenvironment{rmdtip}
  {\begin{rmdblock}{tip}}
  {\end{rmdblock}}
\newenvironment{rmdwarning}
  {\begin{rmdblock}{warning}}
  {\end{rmdblock}}

\usepackage{makeidx}
\makeindex

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\frontmatter
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Malaria vaccine antigen identification for Plasmodium falciparum},
  colorlinks=true,
  linkcolor={Maroon},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Malaria vaccine antigen identification for \emph{Plasmodium falciparum}}
\author{}
\date{\vspace{-2.5em}2023-04-25}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\mainmatter

\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

The research aims to identify and prioritize previously unknown vaccine antigen candidates with potentially high efficacy against the most prevalent malaria parasite \emph{Plasmodium falciparum}. Positive-unlabeled random forest (PURF) was applied to learn from the small set of known \emph{Plasmodium falciparum} antigens and the other proteins with unknown antigenic properties. The research notebook contains data and code generated in the study ``\emph{Positive-unlabeled learning identifies vaccine candidate antigens in the malaria parasite Plasmodium falciparum}.'' The notebook also includes instructions on installing the PURF package, retrieving protein variables and assembling machine learning input from the database, as well as code for experimental analysis and plotting.

The notebook is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.

\hypertarget{01_data_engineering}{%
\chapter{Data engineering}\label{01_data_engineering}}

\hypertarget{purf-package-installization}{%
\section{\texorpdfstring{\texttt{purf} package installization}{purf package installization}}\label{purf-package-installization}}

\texttt{purf} is a Python package that adapts the ensemble and tree modules from \texttt{scikit-learn} (version 0.24.2). The package implements and modifies the positive-unlabeled random forest (PURF) algorithm proposed by Li and Hua (\protect\hyperlink{ref-li2014towards}{Li and Hua 2014}; \protect\hyperlink{ref-denis2005learning}{Denis, Gilleron, and Letouzey 2005}; \protect\hyperlink{ref-de1999positive}{De Comité et al. 1999}).

\textbf{In bash: }

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Create and activate Conda environment
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{conda}\NormalTok{ create }\AttributeTok{{-}n}\NormalTok{ purf scikit{-}learn=0.24.2 numpy=1.19.0 cython=0.29.21 pandas=1.3.2}
\ExtensionTok{conda}\NormalTok{ activate purf}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Download package
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{cd}\NormalTok{ purf}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Install package
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ setup.py install}
\end{Highlighting}
\end{Shaded}

\hypertarget{retrieving-p.-falciparum-protein-variables}{%
\section{\texorpdfstring{Retrieving \emph{P. falciparum} protein variables}{Retrieving P. falciparum protein variables}}\label{retrieving-p.-falciparum-protein-variables}}

\textbf{In bash: }

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{echo} \StringTok{"create database pf\_reverse\_vaccinology"} \KeywordTok{|} \ExtensionTok{mariadb} \AttributeTok{{-}u} \OperatorTok{\textless{}}\NormalTok{dbuser}\OperatorTok{\textgreater{}}\NormalTok{ {-}p}
\ExtensionTok{mariadb} \AttributeTok{{-}u} \OperatorTok{\textless{}}\NormalTok{dbuser}\OperatorTok{\textgreater{}}\NormalTok{ {-}p pf\_reverse\_vaccinology }\OperatorTok{\textless{}}\NormalTok{ ./data/supplementary\_data\_1\_pf\_reverse\_vaccinology.sql}
\end{Highlighting}
\end{Shaded}

Overall database schema:

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 1} \end{center}

Detailed database structure:

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 1} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(RMariaDB)}
\FunctionTok{library}\NormalTok{(DBI)}
\FunctionTok{library}\NormalTok{(rlist)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output\_path }\OtherTok{\textless{}{-}} \StringTok{"./other\_data/pf\_assembled\_data.csv"}
\NormalTok{db }\OtherTok{\textless{}{-}} \FunctionTok{dbConnect}\NormalTok{(RMariaDB}\SpecialCharTok{::}\FunctionTok{MariaDB}\NormalTok{(), }\AttributeTok{user =} \StringTok{"root"}\NormalTok{, }\AttributeTok{password =} \StringTok{""}\NormalTok{, }\AttributeTok{dbname =} \StringTok{"pf\_reverse\_vaccinology"}\NormalTok{)}

\NormalTok{get\_data }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(table\_name, db) \{}
\NormalTok{  sql }\OtherTok{\textless{}{-}} \FunctionTok{sqlInterpolate}\NormalTok{(db, }\StringTok{"SELECT * FROM ?table"}\NormalTok{, }\AttributeTok{table =} \FunctionTok{dbQuoteIdentifier}\NormalTok{(db, table\_name))}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{subset}\NormalTok{(}\FunctionTok{dbGetQuery}\NormalTok{(db, sql), }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(id)))}
\NormalTok{\}}

\CommentTok{\# protein ID and transcript ID map table}
\NormalTok{id\_map }\OtherTok{\textless{}{-}} \FunctionTok{dbGetQuery}\NormalTok{(db, }\StringTok{\textquotesingle{}SELECT dbxref\_1.accession AS accession, dbxref\_1.dbxref\_id AS protein\_id FROM dbxref AS dbxref\_1}
\StringTok{                         LEFT OUTER JOIN feature AS feature\_1 ON dbxref\_1.dbxref\_id = feature\_1.dbxref\_id}
\StringTok{                         LEFT OUTER JOIN cvterm ON feature\_1.type\_id = cvterm.cvterm\_id}
\StringTok{                         LEFT OUTER JOIN feature\_relationship ON feature\_1.feature\_id = feature\_relationship.subject\_id}
\StringTok{                         LEFT OUTER JOIN feature AS feature\_2 ON feature\_relationship.object\_id = feature\_2.feature\_id}
\StringTok{                         LEFT OUTER JOIN dbxref AS dbxref\_2 ON feature\_2.dbxref\_id = dbxref\_2.dbxref\_id}
\StringTok{                         LEFT OUTER JOIN organism ON feature\_1.organism\_id = organism.organism\_id}
\StringTok{                         WHERE feature\_1.is\_obsolete = 0 AND cvterm.name = "polypeptide" AND organism.species="falciparum\_3D7"\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{immunological-data-sets}{%
\subsection{Immunological data sets}\label{immunological-data-sets}}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 1 immunological data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# predivac\_processed result for T{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"predivac\_processed"}\NormalTok{, db))}

\CommentTok{\# bepipred\_2\_0 result for B{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"bepipred\_2\_0\_processed"}\NormalTok{, db))}

\CommentTok{\# bepipred\_1\_0 result for B{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"bepipred\_1\_0\_processed"}\NormalTok{, db))}

\CommentTok{\# abcpred result for B{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"abcpred\_processed"}\NormalTok{, db))}

\CommentTok{\# ctlpred result for cytotoxic T{-}cell epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"ctlpred\_processed"}\NormalTok{, db))}

\CommentTok{\# il\_10pred result for interleukine{-}10 inducing epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"il\_10pred\_processed"}\NormalTok{, db))}

\CommentTok{\# ifnepitope result for IFN{-}gamma inducing epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"ifnepitope\_processed"}\NormalTok{, db))}

\CommentTok{\# tappred for high binding affinity epitopes toward the TAP transporter}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"tappred\_processed"}\NormalTok{, db))}

\CommentTok{\# mhc\_i for MHC class I epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"mhc\_i"}\NormalTok{, db))}

\CommentTok{\# mhc\_ii for MHC class II epitopes}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"mhc\_ii"}\NormalTok{, db))}

\CommentTok{\# antigenicity}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"antigenicity"}\NormalTok{, db))}

\CommentTok{\# immunogenicity}
\NormalTok{immu }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(immu, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"immunogenicity"}\NormalTok{, db))}

\CommentTok{\# merge immunological data sets}
\NormalTok{immunological\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ immu) \{}
\NormalTok{  immunological\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ immunological\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{proteomic-data-sets}{%
\subsection{Proteomic data sets}\label{proteomic-data-sets}}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 1 proteomic data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# cello result for subcellualr localization}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{subset}\NormalTok{(}\FunctionTok{get\_data}\NormalTok{(}\StringTok{"cello"}\NormalTok{, db), }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(location\_id)))}

\CommentTok{\# maap result for malaria adhesin/adhesin{-}like proteins}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"maap"}\NormalTok{, db))}

\CommentTok{\# peptides result for physicochemical properties}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"r\_peptides"}\NormalTok{, db))}

\CommentTok{\# protr result for physicochemical properties}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"protr"}\NormalTok{, db))}

\CommentTok{\# hydrophilicity}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"hydrophilicity"}\NormalTok{, db))}

\CommentTok{\# predgpi result for gpi anchors prediction}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"predgpi"}\NormalTok{, db))}

\CommentTok{\# signalp result for signal cleavage prediction}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{subset}\NormalTok{(}\FunctionTok{get\_data}\NormalTok{(}\StringTok{"signalp"}\NormalTok{, db), }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(is\_secprotein, cleavage\_site, cs\_probability)))}

\CommentTok{\# abpred results for amino acid compositions and other variables}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"abpred"}\NormalTok{, db))}

\CommentTok{\# glycoep results for N{-}linked and O{-}linked glycosylation}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"glycoep\_processed"}\NormalTok{, db))}

\CommentTok{\# blastp result for similarity to human proteins}
\NormalTok{pro }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(pro, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"blastp"}\NormalTok{, db))}

\CommentTok{\# merge proteomic data sets}
\NormalTok{proteomic\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ pro) \{}
\NormalTok{  proteomic\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ proteomic\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{structural-data-sets}{%
\subsection{Structural data sets}\label{structural-data-sets}}

\begin{center}\includegraphics[width=0.25\linewidth]{./figures/Supplementary Fig 1 structural data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# tmhmm result for transmembrane helices prediction}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"tmhmm\_processed"}\NormalTok{, db))}

\CommentTok{\# seg result for sequence complexity}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"seg"}\NormalTok{, db))}

\CommentTok{\# seg + tmhmm result}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"seg\_processed"}\NormalTok{, db))}

\CommentTok{\# b\_cell\_epitope\_methods for structural predictions}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"beta\_turn"}\NormalTok{, db))}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"surface\_accessibility"}\NormalTok{, db))}
\NormalTok{struc }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(struc, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"flexibility"}\NormalTok{, db))}

\CommentTok{\# merge structural analysis data sets}
\NormalTok{structural\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ struc) \{}
\NormalTok{  structural\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ structural\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{genomic-data-sets}{%
\subsection{Genomic data sets}\label{genomic-data-sets}}

\begin{center}\includegraphics[width=0.4\linewidth]{./figures/Supplementary Fig 1 genomic data} \end{center}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{geno }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}

\CommentTok{\# snp result}
\NormalTok{geno }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(geno, }\FunctionTok{get\_data}\NormalTok{(}\StringTok{"snp"}\NormalTok{, db))}

\CommentTok{\# merge structural analysis data sets}
\NormalTok{genomic\_ds }\OtherTok{\textless{}{-}}\NormalTok{ id\_map[}\StringTok{"protein\_id"}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (ds }\ControlFlowTok{in}\NormalTok{ geno) \{}
\NormalTok{  genomic\_ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ genomic\_ds, }\AttributeTok{y =}\NormalTok{ ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{final-assembly}{%
\subsection{Final assembly}\label{final-assembly}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# prepare predictor variables}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ immunological\_ds, }\AttributeTok{y =}\NormalTok{ proteomic\_ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ data, }\AttributeTok{y =}\NormalTok{ structural\_ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ data, }\AttributeTok{y =}\NormalTok{ genomic\_ds, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ id\_map, }\AttributeTok{y =}\NormalTok{ data, }\AttributeTok{by =} \StringTok{"protein\_id"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{accession }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{accession}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(data, }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(protein\_id, accession))}
\FunctionTok{rownames}\NormalTok{(data) }\OtherTok{\textless{}{-}}\NormalTok{ accession}

\CommentTok{\# write to output}
\FunctionTok{write.csv}\NormalTok{(data, output\_path)}

\CommentTok{\# close database connection}
\FunctionTok{dbDisconnect}\NormalTok{(db)}
\end{Highlighting}
\end{Shaded}

\hypertarget{generating-ml-input}{%
\section{Generating ML input}\label{generating-ml-input}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{response\_var }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_antigen\_labels.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{predictor\_vars }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_assembled\_data.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{ml\_input }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ response\_var, }\AttributeTok{y =}\NormalTok{ predictor\_vars, }\AttributeTok{by =} \StringTok{"row.names"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{row\_names }\OtherTok{\textless{}{-}}\NormalTok{ ml\_input}\SpecialCharTok{$}\NormalTok{Row.names}
\NormalTok{ml\_input }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(ml\_input, }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(Row.names))}
\FunctionTok{rownames}\NormalTok{(ml\_input) }\OtherTok{\textless{}{-}}\NormalTok{ row\_names}

\CommentTok{\# write to output}
\FunctionTok{write.csv}\NormalTok{(ml\_input, }\StringTok{"./data/supplementary\_data\_3\_pf\_ml\_input.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] rlist_0.4.6.2  DBI_1.1.3      RMariaDB_1.2.2
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.9        rstudioapi_0.14   knitr_1.40        magrittr_2.0.3   
##  [5] hms_1.1.2         bit_4.0.4         R.cache_0.16.0    rlang_1.1.0      
##  [9] fastmap_1.1.0     stringr_1.4.1     styler_1.8.0      tools_4.2.3      
## [13] data.table_1.14.2 xfun_0.32         R.oo_1.25.0       cli_3.6.1        
## [17] ellipsis_0.3.2    htmltools_0.5.3   yaml_2.3.5        bit64_4.0.5      
## [21] digest_0.6.29     lifecycle_1.0.3   bookdown_0.28     purrr_0.3.4      
## [25] vctrs_0.6.2       R.utils_2.12.0    codetools_0.2-19  evaluate_0.16    
## [29] rmarkdown_2.16    stringi_1.7.8     compiler_4.2.3    R.methodsS3_1.8.2
## [33] pkgconfig_2.0.3
\end{verbatim}

\hypertarget{02_model_training}{%
\chapter{Model training}\label{02_model_training}}

\hypertarget{simulation-experiment-with-99-unlabeled-data-set.}{%
\section{Simulation experiment with 99\% unlabeled data set.}\label{simulation-experiment-with-99-unlabeled-data-set.}}

\hypertarget{analysis}{%
\subsection{Analysis}\label{analysis}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ sklearn.datasets }\ImportTok{import}\NormalTok{ make\_classification}
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{from}\NormalTok{ sklearn.ensemble }\ImportTok{import}\NormalTok{ RandomForestClassifier}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ re}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X\_list }\OperatorTok{=}\NormalTok{ []}
\NormalTok{y\_list }\OperatorTok{=}\NormalTok{ []}

\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\DecValTok{5}\NormalTok{):}
\NormalTok{    X, y }\OperatorTok{=}\NormalTok{ make\_classification(}
\NormalTok{        n\_samples }\OperatorTok{=} \DecValTok{5000}\NormalTok{, }
\NormalTok{        n\_features }\OperatorTok{=} \DecValTok{300}\NormalTok{, }
\NormalTok{        n\_informative }\OperatorTok{=} \DecValTok{250}\NormalTok{, }
\NormalTok{        n\_redundant }\OperatorTok{=} \DecValTok{40}\NormalTok{, }
\NormalTok{        n\_repeated }\OperatorTok{=} \DecValTok{10}\NormalTok{, }
\NormalTok{        n\_classes }\OperatorTok{=} \DecValTok{2}\NormalTok{, }
\NormalTok{        n\_clusters\_per\_class }\OperatorTok{=} \DecValTok{1}\NormalTok{, }
\NormalTok{        class\_sep }\OperatorTok{=} \DecValTok{2}\NormalTok{, }
\NormalTok{        random\_state }\OperatorTok{=}\NormalTok{ i}\OperatorTok{+}\DecValTok{1}\NormalTok{)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X)}
    \CommentTok{\# Check the contents of the set}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\%d}\StringTok{ data points and }\SpecialCharTok{\%d}\StringTok{ features\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (X.shape))}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\%d}\StringTok{ positive out of }\SpecialCharTok{\%d}\StringTok{ total\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
\NormalTok{    X\_list.append(X)}
\NormalTok{    y\_list.append(y)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y\_orig\_list }\OperatorTok{=}\NormalTok{ []}
\NormalTok{res\_ }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}index\textquotesingle{}}\NormalTok{ : }\BuiltInTok{range}\NormalTok{(}\DecValTok{5000}\NormalTok{)\})}
\NormalTok{i }\OperatorTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{ X, y }\KeywordTok{in} \BuiltInTok{zip}\NormalTok{(X\_list, y\_list):}
\NormalTok{    res\_[}\StringTok{\textquotesingle{}label\_\textquotesingle{}} \OperatorTok{+} \BuiltInTok{str}\NormalTok{(i }\OperatorTok{+} \DecValTok{1}\NormalTok{)] }\OperatorTok{=}\NormalTok{ y}
    \CommentTok{\# Convert to positive{-}unlabeled data where labeled positives are conditionally randomly selected}
\NormalTok{    rf }\OperatorTok{=}\NormalTok{ RandomForestClassifier(}
\NormalTok{        n\_estimators }\OperatorTok{=} \DecValTok{1000}\NormalTok{,}
\NormalTok{        max\_samples }\OperatorTok{=} \BuiltInTok{min}\NormalTok{(}\BuiltInTok{sum}\NormalTok{(y}\OperatorTok{==}\DecValTok{0}\NormalTok{), }\BuiltInTok{sum}\NormalTok{(y}\OperatorTok{==}\DecValTok{1}\NormalTok{)),}
\NormalTok{        oob\_score }\OperatorTok{=} \VariableTok{True}\NormalTok{,}
\NormalTok{        n\_jobs }\OperatorTok{=} \OperatorTok{{-}}\DecValTok{1}\NormalTok{,}
\NormalTok{        random\_state }\OperatorTok{=} \DecValTok{30}
\NormalTok{    )}
\NormalTok{    rf.fit(X, y)}
\NormalTok{    res\_[}\StringTok{\textquotesingle{}rf\_\textquotesingle{}} \OperatorTok{+} \BuiltInTok{str}\NormalTok{(i }\OperatorTok{+} \DecValTok{1}\NormalTok{)] }\OperatorTok{=}\NormalTok{ rf.oob\_decision\_function\_[:,}\DecValTok{1}\NormalTok{]}
    \CommentTok{\# Keep the original targets safe for later usage}
\NormalTok{    y\_orig }\OperatorTok{=}\NormalTok{ y.copy()}
\NormalTok{    y\_orig\_list.append(y\_orig)}
    \CommentTok{\# 99\% unlabeled}
\NormalTok{    np.random.seed(}\DecValTok{0}\NormalTok{)}
\NormalTok{    y[np.random.choice(np.where((res\_[}\StringTok{\textquotesingle{}label\_\textquotesingle{}} \OperatorTok{+} \BuiltInTok{str}\NormalTok{(i }\OperatorTok{+} \DecValTok{1}\NormalTok{)] }\OperatorTok{==} \DecValTok{1}\NormalTok{))[}\DecValTok{0}\NormalTok{], replace}\OperatorTok{=}\VariableTok{False}\NormalTok{, size}\OperatorTok{=}\DecValTok{50}\NormalTok{)] }\OperatorTok{=} \DecValTok{2} 
\NormalTok{    y[y }\OperatorTok{==} \DecValTok{1}\NormalTok{] }\OperatorTok{=} \DecValTok{0}
\NormalTok{    y[y }\OperatorTok{==} \DecValTok{2}\NormalTok{] }\OperatorTok{=} \DecValTok{1}
\NormalTok{    res\_[}\StringTok{\textquotesingle{}pu\_label\_\textquotesingle{}} \OperatorTok{+} \BuiltInTok{str}\NormalTok{(i }\OperatorTok{+} \DecValTok{1}\NormalTok{)] }\OperatorTok{=}\NormalTok{ y}
    \CommentTok{\# Check the new contents of the set}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}}\SpecialCharTok{\%d}\StringTok{ positive out of }\SpecialCharTok{\%d}\StringTok{ total\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
\NormalTok{    y\_list[i] }\OperatorTok{=}\NormalTok{ y}
\NormalTok{    i }\OperatorTok{+=} \DecValTok{1}
    
\NormalTok{res\_.to\_csv(}\StringTok{\textquotesingle{}./other\_data/simulation\_labels.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ train\_purf(features, outcome, res\_path, pickle\_path}\OperatorTok{=}\StringTok{\textquotesingle{}./tmp.pkl\textquotesingle{}}\NormalTok{, pos\_level}\OperatorTok{=}\FloatTok{0.5}\NormalTok{, save\_model}\OperatorTok{=}\VariableTok{False}\NormalTok{):}
    \CommentTok{\# Imputation}
\NormalTok{    imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ X}
    \CommentTok{\# Training PURF}
\NormalTok{    purf }\OperatorTok{=}\NormalTok{ PURandomForestClassifier(}
\NormalTok{        n\_estimators }\OperatorTok{=} \DecValTok{10000}\NormalTok{,}
\NormalTok{        oob\_score }\OperatorTok{=} \VariableTok{True}\NormalTok{,}
\NormalTok{        n\_jobs }\OperatorTok{=} \OperatorTok{{-}}\DecValTok{1}\NormalTok{,}
\NormalTok{        random\_state }\OperatorTok{=} \DecValTok{42}\NormalTok{,}
\NormalTok{        pos\_level }\OperatorTok{=}\NormalTok{ pos\_level}
\NormalTok{    )}
\NormalTok{    purf.fit(X, y)}
    \CommentTok{\# Storing results}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: X.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{ : y\})}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ purf.oob\_decision\_function\_[:,}\DecValTok{1}\NormalTok{]}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ res.groupby(}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{).mean().merge(features, left\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{, right\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\NormalTok{    res.to\_csv(res\_path)}
    \ControlFlowTok{if}\NormalTok{ save\_model }\KeywordTok{is} \VariableTok{True}\NormalTok{:}
        \ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(pickle\_path, }\StringTok{\textquotesingle{}wb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ out:}
\NormalTok{            pickle.dump(purf, out, pickle.HIGHEST\_PROTOCOL)}

\NormalTok{i }\OperatorTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{ X, y }\KeywordTok{in} \BuiltInTok{zip}\NormalTok{(X\_list, y\_list):}
\NormalTok{    train\_purf(X, y, res\_path}\OperatorTok{=}\StringTok{\textquotesingle{}./other\_data/simulation\_res\_\textquotesingle{}} \OperatorTok{+} \BuiltInTok{str}\NormalTok{(i }\OperatorTok{+} \DecValTok{1}\NormalTok{) }\OperatorTok{+} \StringTok{\textquotesingle{}.csv\textquotesingle{}}\NormalTok{)}
\NormalTok{    i }\OperatorTok{+=} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting}{%
\subsection{Plotting}\label{plotting}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(pROC)}
\FunctionTok{library}\NormalTok{(mixR)}
\FunctionTok{library}\NormalTok{(pracma)}
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggpubr)}
\FunctionTok{library}\NormalTok{(rstatix)}
\FunctionTok{library}\NormalTok{(cowplot)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{labels }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/simulation\_labels.csv"}\NormalTok{)}
\NormalTok{tmp }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{read.csv}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"./other\_data/simulation\_res\_"}\NormalTok{, i, }\StringTok{".csv"}\NormalTok{), }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)[, }\StringTok{"OOB score"}\NormalTok{, }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{]))}
\FunctionTok{colnames}\NormalTok{(tmp) }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{paste0}\NormalTok{(}\StringTok{"OOB\_score\_"}\NormalTok{, i))}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(tmp, labels[, }\FunctionTok{c}\NormalTok{(}
  \FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{paste0}\NormalTok{(}\StringTok{"label\_"}\NormalTok{, i)),}
  \FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{paste0}\NormalTok{(}\StringTok{"pu\_label\_"}\NormalTok{, i))}
\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{roc\_true\_labels }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{auroc\_true\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{) \{}
\NormalTok{  roc\_ }\OtherTok{\textless{}{-}} \FunctionTok{roc}\NormalTok{(}\AttributeTok{response =}\NormalTok{ data[, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"label\_"}\NormalTok{, i)], }\AttributeTok{predictor =}\NormalTok{ data[, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"OOB\_score\_"}\NormalTok{, i)])}
\NormalTok{  roc\_true\_labels }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(roc\_true\_labels, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{fpr =} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ roc\_}\SpecialCharTok{$}\NormalTok{specificities, }\AttributeTok{tpr =}\NormalTok{ roc\_}\SpecialCharTok{$}\NormalTok{sensitivities))}
\NormalTok{  auroc\_true\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(auroc\_true\_labels, }\FunctionTok{as.numeric}\NormalTok{(roc\_}\SpecialCharTok{$}\NormalTok{auc))}
\NormalTok{\}}

\NormalTok{roc\_pu\_labels }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{auroc\_pu\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{) \{}
\NormalTok{  roc\_ }\OtherTok{\textless{}{-}} \FunctionTok{roc}\NormalTok{(}\AttributeTok{response =}\NormalTok{ data[, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"pu\_label\_"}\NormalTok{, i)], }\AttributeTok{predictor =}\NormalTok{ data[, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"OOB\_score\_"}\NormalTok{, i)])}
\NormalTok{  roc\_pu\_labels }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(roc\_pu\_labels, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{fpr =} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ roc\_}\SpecialCharTok{$}\NormalTok{specificities, }\AttributeTok{tpr =}\NormalTok{ roc\_}\SpecialCharTok{$}\NormalTok{sensitivities))}
\NormalTok{  auroc\_pu\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(auroc\_pu\_labels, }\FunctionTok{as.numeric}\NormalTok{(roc\_}\SpecialCharTok{$}\NormalTok{auc))}
\NormalTok{\}}

\NormalTok{roc\_estimated }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{auroc\_estimated }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{) \{}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{mixfit}\NormalTok{(data[, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"OOB\_score\_"}\NormalTok{, i)], }\AttributeTok{ncomp =} \DecValTok{2}\NormalTok{)}
  \CommentTok{\# Calculate receiver operating characteristic (ROC) curve}
  \CommentTok{\# for putative positive and negative samples}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.01}\NormalTok{)}
\NormalTok{  neg\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{1}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{1}\NormalTok{])}
\NormalTok{  pos\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{2}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{2}\NormalTok{])}
\NormalTok{  fpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{+}\NormalTok{ neg\_cum) }\CommentTok{\# false positive / (false positive + true negative)}
\NormalTok{  tpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{+}\NormalTok{ pos\_cum) }\CommentTok{\# true positive / (true positive + false negative)}
\NormalTok{  roc\_estimated }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(roc\_estimated, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{fpr =}\NormalTok{ fpr, }\AttributeTok{tpr =}\NormalTok{ tpr))}
\NormalTok{  auroc\_estimated }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(auroc\_estimated, }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{fpr, tpr)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sem }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\FunctionTok{sd}\NormalTok{(x, na.rm) }\SpecialCharTok{/} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{length}\NormalTok{(}\FunctionTok{na.omit}\NormalTok{(x)))}

\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}
  \FunctionTok{do.call}\NormalTok{(rbind, roc\_true\_labels),}
  \FunctionTok{do.call}\NormalTok{(rbind, roc\_pu\_labels),}
  \FunctionTok{do.call}\NormalTok{(rbind, roc\_estimated)}
\NormalTok{)}

\NormalTok{ds}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{do.call}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rep}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"True labels"}\NormalTok{), }\FunctionTok{nrow}\NormalTok{(roc\_true\_labels[[i]])))),}
  \FunctionTok{do.call}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rep}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"PU labels"}\NormalTok{), }\FunctionTok{nrow}\NormalTok{(roc\_pu\_labels[[i]])))),}
  \FunctionTok{melt}\NormalTok{(}\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rep}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Estimated"}\NormalTok{), }\FunctionTok{nrow}\NormalTok{(roc\_estimated[[i]]))))}\SpecialCharTok{$}\NormalTok{value}
\NormalTok{)}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{group)}

\NormalTok{ds}\SpecialCharTok{$}\NormalTok{sub\_group }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{do.call}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rep}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"True labels"}\NormalTok{, i), }\FunctionTok{nrow}\NormalTok{(roc\_true\_labels[[i]])))),}
  \FunctionTok{do.call}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rep}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"PU labels"}\NormalTok{, i), }\FunctionTok{nrow}\NormalTok{(roc\_pu\_labels[[i]])))),}
  \FunctionTok{melt}\NormalTok{(}\FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(i) }\FunctionTok{rep}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Estimated"}\NormalTok{, i), }\FunctionTok{nrow}\NormalTok{(roc\_estimated[[i]]))))}\SpecialCharTok{$}\NormalTok{value}
\NormalTok{)}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{sub\_group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{sub\_group)}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ fpr, }\AttributeTok{y =}\NormalTok{ tpr, }\AttributeTok{colour =}\NormalTok{ group, }\AttributeTok{group =}\NormalTok{ sub\_group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size =} \FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#E41A1C"}\NormalTok{, }\StringTok{"\#377EB8"}\NormalTok{, }\StringTok{"\#4DAF4A"}\NormalTok{),}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Estimated"}\NormalTok{, }\StringTok{"True labels"}\NormalTok{, }\StringTok{"PU labels"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
      \FunctionTok{paste0}\NormalTok{(}
        \StringTok{"Estimated (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(auroc\_estimated), }\DecValTok{3}\NormalTok{), }\StringTok{" ± "}\NormalTok{,}
        \FunctionTok{round}\NormalTok{(}\FunctionTok{sem}\NormalTok{(auroc\_estimated), }\DecValTok{3}\NormalTok{), }\StringTok{")"}
\NormalTok{      ),}
      \FunctionTok{paste0}\NormalTok{(}
        \StringTok{"True labels (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(auroc\_true\_labels), }\DecValTok{3}\NormalTok{), }\StringTok{" ± "}\NormalTok{,}
        \FunctionTok{round}\NormalTok{(}\FunctionTok{sem}\NormalTok{(auroc\_true\_labels), }\DecValTok{3}\NormalTok{), }\StringTok{")"}
\NormalTok{      ),}
      \FunctionTok{paste0}\NormalTok{(}
        \StringTok{"PU labels (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(auroc\_pu\_labels), }\DecValTok{3}\NormalTok{), }\StringTok{" ± "}\NormalTok{,}
        \FunctionTok{round}\NormalTok{(}\FunctionTok{sem}\NormalTok{(auroc\_pu\_labels), }\DecValTok{3}\NormalTok{), }\StringTok{")"}
\NormalTok{      )}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.6}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"False positive rate"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"True positive rate"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\StringTok{"AUROC"} \OtherTok{=} \FunctionTok{c}\NormalTok{(auroc\_true\_labels, auroc\_pu\_labels, auroc\_estimated))}

\NormalTok{ds}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{rep}\NormalTok{(}\StringTok{"True labels"}\NormalTok{, }\FunctionTok{length}\NormalTok{(auroc\_true\_labels)),}
  \FunctionTok{rep}\NormalTok{(}\StringTok{"PU labels"}\NormalTok{, }\FunctionTok{length}\NormalTok{(auroc\_pu\_labels)),}
  \FunctionTok{rep}\NormalTok{(}\StringTok{"Estimated"}\NormalTok{, }\FunctionTok{length}\NormalTok{(auroc\_estimated))}
\NormalTok{)}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{group, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Estimated"}\NormalTok{, }\StringTok{"True labels"}\NormalTok{, }\StringTok{"PU labels"}\NormalTok{))}

\NormalTok{stats }\OtherTok{\textless{}{-}} \FunctionTok{wilcox\_test}\NormalTok{(ds, AUROC }\SpecialCharTok{\textasciitilde{}}\NormalTok{ group, }\AttributeTok{p.adjust.method =} \StringTok{"BH"}\NormalTok{)}
\NormalTok{stats }\OtherTok{\textless{}{-}}\NormalTok{ stats }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{add\_xy\_position}\NormalTok{(}\AttributeTok{fun =} \StringTok{"mean\_se"}\NormalTok{, }\AttributeTok{x =} \StringTok{"group"}\NormalTok{)}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggbarplot}\NormalTok{(ds,}
  \AttributeTok{x =} \StringTok{"group"}\NormalTok{, }\AttributeTok{y =} \StringTok{"AUROC"}\NormalTok{, }\AttributeTok{add =} \StringTok{"mean\_se"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"group"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.3}\NormalTok{,}
  \AttributeTok{add.params =} \FunctionTok{list}\NormalTok{(}\AttributeTok{size =} \FloatTok{0.3}\NormalTok{)}
\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#E41A1C"}\NormalTok{, }\StringTok{"\#377EB8"}\NormalTok{, }\StringTok{"\#4DAF4A"}\NormalTok{),}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Estimated"}\NormalTok{, }\StringTok{"True labels"}\NormalTok{, }\StringTok{"PU labels"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{stat\_pvalue\_manual}\NormalTok{(stats, }\AttributeTok{label =} \StringTok{"p = \{p.adj\}"}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1, p2, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{))}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 2} \end{center}

\hypertarget{hyper-parameter-tuning-for-purf}{%
\section{Hyper-parameter tuning for PURF}\label{hyper-parameter-tuning-for-purf}}

\hypertarget{analysis-1}{%
\subsection{Analysis}\label{analysis-1}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ re}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# input set (5393, 1 + 272)}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_3\_pf\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pf3d7\_features }\OperatorTok{=}\NormalTok{ data.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{pf3d7\_outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ train\_purf(features, outcome, pos\_level, res\_path, pickle\_path):}
    \CommentTok{\# Imputation}
\NormalTok{    imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ X}

    \CommentTok{\# Training PURF}
\NormalTok{    purf }\OperatorTok{=}\NormalTok{ PURandomForestClassifier(}
\NormalTok{        n\_estimators }\OperatorTok{=} \DecValTok{100000}\NormalTok{,}
\NormalTok{        oob\_score }\OperatorTok{=} \VariableTok{True}\NormalTok{,}
\NormalTok{        n\_jobs }\OperatorTok{=} \DecValTok{64}\NormalTok{,}
\NormalTok{        random\_state }\OperatorTok{=} \DecValTok{42}\NormalTok{,}
\NormalTok{        pos\_level }\OperatorTok{=}\NormalTok{ pos\_level}
\NormalTok{    )}
\NormalTok{    purf.fit(X, y)}

    \CommentTok{\# Storing results}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: X.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{: y\})}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ purf.oob\_decision\_function\_[:,}\DecValTok{1}\NormalTok{]}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ res.groupby(}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{).mean().merge(features, left\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{, right\_on}\OperatorTok{=}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{)}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ res[[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]]}
\NormalTok{    features.to\_csv(res\_path, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{)}
    \ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(pickle\_path, }\StringTok{\textquotesingle{}wb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ out:}
\NormalTok{        pickle.dump(purf, out, pickle.HIGHEST\_PROTOCOL)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ [}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{0.6}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{]:}
\NormalTok{    train\_purf(pf3d7\_features, pf3d7\_outcome, pos\_level}\OperatorTok{=}\NormalTok{pos\_level,}
\NormalTok{        res\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/without\_weighting/}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level,}
\NormalTok{        pickle\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/without\_weighting/}\SpecialCharTok{\%.1f}\StringTok{\_purf.pkl\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/without\_wighting/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}
\NormalTok{tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}0.1\_res.tsv\textquotesingle{}}\NormalTok{, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB scores\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pos\_level\_parameter\_tuning\_wo\_weighting.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-1}{%
\subsection{Plotting}\label{plotting-1}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mixR)}
\FunctionTok{library}\NormalTok{(pracma)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(grid)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pos\_level\_parameter\_tuning\_wo\_weighting.csv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\CommentTok{\# Extract data with only unlabeled proteins}
\NormalTok{data\_unl }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{plot\_list2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.1}\NormalTok{)) \{}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{mixfit}\NormalTok{(data\_unl[[}\FunctionTok{as.character}\NormalTok{(i)]], }\AttributeTok{ncomp =} \DecValTok{2}\NormalTok{)}

  \CommentTok{\# Calculate receiver operating characteristic (ROC) curve}
  \CommentTok{\# for putative positive and negative samples}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.01}\NormalTok{)}
\NormalTok{  neg\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{1}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{1}\NormalTok{])}
\NormalTok{  pos\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{2}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{2}\NormalTok{])}
\NormalTok{  fpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{+}\NormalTok{ neg\_cum) }\CommentTok{\# false positive / (false positive + true negative)}
\NormalTok{  tpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{+}\NormalTok{ pos\_cum) }\CommentTok{\# true positive / (true positive + false negative)}

\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{plot}\NormalTok{(fit, }\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}
    \StringTok{"Positive level = "}\NormalTok{, i,}
    \StringTok{" (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{fpr, tpr), }\DecValTok{2}\NormalTok{), }\StringTok{")"}
\NormalTok{  )) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Putative negative"}\NormalTok{, }\StringTok{"Putative positive"}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.85}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.8}\NormalTok{, }\FloatTok{1.5}\NormalTok{)}

  \CommentTok{\# Calculate percent rank for labeled positives}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(i))]}
  \FunctionTok{colnames}\NormalTok{(data\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\StringTok{"OOB score"}\NormalTok{)}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(data\_[[}\StringTok{"OOB score"}\NormalTok{]]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data)}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{percent\_rank), ]}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data\_) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_)}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"EPR: "}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}

\NormalTok{  p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{percent\_rank}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =} \StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_colour\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"purple"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{midpoint =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.4}\NormalTok{, }\FloatTok{0.15}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{guides}\NormalTok{(}\AttributeTok{colour =} \FunctionTok{guide\_colourbar}\NormalTok{(}\AttributeTok{title.position =} \StringTok{"top"}\NormalTok{, }\AttributeTok{direction =} \StringTok{"horizontal"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{labs}\NormalTok{(}\AttributeTok{colour =} \StringTok{"Score (proportion of votes)"}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}
      \StringTok{"Positive level = "}\NormalTok{, i,}
      \StringTok{" (AUC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{x, }\DecValTok{1}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{percent\_rank, }\DecValTok{0}\NormalTok{)), }\DecValTok{2}\NormalTok{), }\StringTok{")"}
\NormalTok{    )) }\SpecialCharTok{+}
    \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{  plot\_list }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list, p)}
\NormalTok{  plot\_list2 }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list2, p2)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{bimodal-distribution-plot}{%
\subsubsection{Bimodal distribution plot}\label{bimodal-distribution-plot}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Density"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob, }\AttributeTok{bottom =}\NormalTok{ x\_grob))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 3} \end{center}

\hypertarget{known-antigen-ranking}{%
\subsubsection{Known antigen ranking}\label{known-antigen-ranking}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list2, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob2, }\AttributeTok{bottom =}\NormalTok{ x\_grob2))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 4} \end{center}

\hypertarget{variable-space-weighting}{%
\section{Variable space weighting}\label{variable-space-weighting}}

\hypertarget{analysis-2}{%
\subsection{Analysis}\label{analysis-2}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{from}\NormalTok{ sklearn.datasets }\ImportTok{import}\NormalTok{ make\_classification}
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{from}\NormalTok{ sklearn.ensemble }\ImportTok{import}\NormalTok{ RandomForestClassifier}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ re}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# input set (5393, 1 + 272)}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_3\_pf\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pf3d7\_features }\OperatorTok{=}\NormalTok{ data.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{pf3d7\_outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ train\_purf(features, outcome, pos\_level, res\_path, pickle\_path):}
    \CommentTok{\# Imputation}
\NormalTok{    imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ X}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples before variable space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}

    \CommentTok{\# variable space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}

    \CommentTok{\# variable space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    scaler }\OperatorTok{=}\NormalTok{ MinMaxScaler(feature\_range}\OperatorTok{=}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\NormalTok{    dist }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(lab\_pos.shape[}\DecValTok{0}\NormalTok{]):}
\NormalTok{        dist.append(distance.euclidean(lab\_pos.iloc[i, :], median))}
        
\NormalTok{    dist }\OperatorTok{=}\NormalTok{ np.asarray(dist).reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{round}\NormalTok{(scaler.fit\_transform(dist))}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.array(counts, dtype}\OperatorTok{=}\NormalTok{np.int64)[:, }\DecValTok{0}\NormalTok{]}

\NormalTok{    X\_temp }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{, :]}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{0}\NormalTok{, :]}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ np.asarray([}\DecValTok{0}\NormalTok{] }\OperatorTok{*}\NormalTok{ X.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(counts)))}
\NormalTok{    appended\_data }\OperatorTok{=}\NormalTok{ [X]}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(counts)):}
\NormalTok{        appended\_data.append(pd.concat([X\_temp.iloc[[i]]] }\OperatorTok{*}\NormalTok{ counts[i]))}

\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.concat(appended\_data)}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples after variable space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}

    \CommentTok{\# Training PURF}
\NormalTok{    purf }\OperatorTok{=}\NormalTok{ PURandomForestClassifier(}
\NormalTok{        n\_estimators }\OperatorTok{=} \DecValTok{100000}\NormalTok{,}
\NormalTok{        oob\_score }\OperatorTok{=} \VariableTok{True}\NormalTok{,}
\NormalTok{        n\_jobs }\OperatorTok{=} \DecValTok{64}\NormalTok{,}
\NormalTok{        random\_state }\OperatorTok{=} \DecValTok{42}\NormalTok{,}
\NormalTok{        pos\_level }\OperatorTok{=}\NormalTok{ pos\_level}
\NormalTok{    )}
\NormalTok{    purf.fit(X, y)}

    \CommentTok{\# Storing results}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: X.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{: y\})}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ purf.oob\_decision\_function\_[:,}\DecValTok{1}\NormalTok{]}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ res.groupby(}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{).mean().merge(features, left\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{, right\_on}\OperatorTok{=}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{)}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ res[[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]]}
\NormalTok{    features.to\_csv(res\_path, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{)}
    \ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(pickle\_path, }\StringTok{\textquotesingle{}wb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ out:}
\NormalTok{        pickle.dump(purf, out, pickle.HIGHEST\_PROTOCOL)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ [}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.4}\NormalTok{, }\FloatTok{0.6}\NormalTok{, }\FloatTok{0.3}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.2}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{]:}
\NormalTok{    train\_purf(pf3d7\_features, pf3d7\_outcome, pos\_level}\OperatorTok{=}\NormalTok{pos\_level,}
\NormalTok{        res\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/with\_weighting/}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level,}
\NormalTok{        pickle\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/with\_weighting/}\SpecialCharTok{\%.1f}\StringTok{\_purf.pkl\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/with\_weighting/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}
\NormalTok{tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}0.1\_res.tsv\textquotesingle{}}\NormalTok{, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\_res.tsv\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level, sep}\OperatorTok{=}\StringTok{\textquotesingle{}}\CharTok{\textbackslash{}t}\StringTok{\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB scores\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\StringTok{\textquotesingle{}}\SpecialCharTok{\%.1f}\StringTok{\textquotesingle{}} \OperatorTok{\%}\NormalTok{ pos\_level }\ControlFlowTok{for}\NormalTok{ pos\_level }\KeywordTok{in}\NormalTok{ np.arange(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.1}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./other\_data/pos\_level\_parameter\_tuning\_w\_weighting.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-2}{%
\subsection{Plotting}\label{plotting-2}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mixR)}
\FunctionTok{library}\NormalTok{(pracma)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(grid)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pos\_level\_parameter\_tuning\_w\_weighting.csv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\CommentTok{\# Extract data with only unlabeled proteins}
\NormalTok{data\_unl }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot\_list }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\NormalTok{plot\_list2 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.1}\NormalTok{)) \{}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{mixfit}\NormalTok{(data\_unl[[}\FunctionTok{as.character}\NormalTok{(i)]], }\AttributeTok{ncomp =} \DecValTok{2}\NormalTok{)}

  \CommentTok{\# Calculate receiver operating characteristic (ROC) curve}
  \CommentTok{\# for putative positive and negative samples}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.01}\NormalTok{)}
\NormalTok{  neg\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{1}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{1}\NormalTok{])}
\NormalTok{  pos\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{2}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{2}\NormalTok{])}
\NormalTok{  fpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{+}\NormalTok{ neg\_cum) }\CommentTok{\# false positive / (false positive + true negative)}
\NormalTok{  tpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{+}\NormalTok{ pos\_cum) }\CommentTok{\# true positive / (true positive + false negative)}

\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{plot}\NormalTok{(fit, }\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}
    \StringTok{"Positive level = "}\NormalTok{, i,}
    \StringTok{" (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{fpr, tpr), }\DecValTok{2}\NormalTok{), }\StringTok{")"}
\NormalTok{  )) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Putative negative"}\NormalTok{, }\StringTok{"Putative positive"}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.85}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.8}\NormalTok{, }\FloatTok{1.5}\NormalTok{)}

  \CommentTok{\# Calculate percent rank for labeled positives}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\FunctionTok{as.character}\NormalTok{(i))]}
  \FunctionTok{colnames}\NormalTok{(data\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\StringTok{"OOB score"}\NormalTok{)}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(data\_[[}\StringTok{"OOB score"}\NormalTok{]]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data)}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{  data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{percent\_rank), ]}
\NormalTok{  data\_}\SpecialCharTok{$}\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data\_) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_)}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"EPR: "}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}

\NormalTok{  p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{percent\_rank}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =} \StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{scale\_colour\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"purple"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{midpoint =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
          \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.4}\NormalTok{, }\FloatTok{0.15}\NormalTok{),}
          \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{        )}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{theme}\NormalTok{(}
          \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.title =} \FunctionTok{element\_blank}\NormalTok{(),}
          \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
          \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{        )}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{guides}\NormalTok{(}\AttributeTok{colour =} \FunctionTok{guide\_colourbar}\NormalTok{(}\AttributeTok{title.position =} \StringTok{"top"}\NormalTok{, }\AttributeTok{direction =} \StringTok{"horizontal"}\NormalTok{))}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
\NormalTok{    \{}
      \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \FloatTok{0.1}\NormalTok{) \{}
        \FunctionTok{labs}\NormalTok{(}\AttributeTok{colour =} \StringTok{"Score (proportion of votes)"}\NormalTok{)}
\NormalTok{      \}}
\NormalTok{    \} }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}
      \StringTok{"Positive level = "}\NormalTok{, i,}
      \StringTok{" (AUC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{x, }\DecValTok{1}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{percent\_rank, }\DecValTok{0}\NormalTok{)), }\DecValTok{2}\NormalTok{), }\StringTok{")"}
\NormalTok{    )) }\SpecialCharTok{+}
    \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{  plot\_list }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list, p)}
\NormalTok{  plot\_list2 }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plot\_list2, p2)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{bimodal-distribution-plot-1}{%
\subsubsection{Bimodal distribution plot}\label{bimodal-distribution-plot-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Density"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob, }\AttributeTok{bottom =}\NormalTok{ x\_grob))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 5} \end{center}

\hypertarget{known-antigen-ranking-1}{%
\subsubsection{Known antigen ranking}\label{known-antigen-ranking-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{))}
\NormalTok{y\_grob2 }\OtherTok{\textless{}{-}} \FunctionTok{textGrob}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{, }\AttributeTok{gp =} \FunctionTok{gpar}\NormalTok{(}\AttributeTok{fontsize =} \DecValTok{15}\NormalTok{), }\AttributeTok{rot =} \DecValTok{90}\NormalTok{)}
\FunctionTok{grid.arrange}\NormalTok{(}\FunctionTok{arrangeGrob}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(}\AttributeTok{plotlist =}\NormalTok{ plot\_list2, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{), }\AttributeTok{left =}\NormalTok{ y\_grob2, }\AttributeTok{bottom =}\NormalTok{ x\_grob2))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 6} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] gridExtra_2.3  cowplot_1.1.1  rstatix_0.7.0  ggpubr_0.4.0   ggplot2_3.4.2 
##  [6] reshape2_1.4.4 pracma_2.3.8   mixR_0.2.0     pROC_1.18.0    rlist_0.4.6.2 
## 
## loaded via a namespace (and not attached):
##  [1] reticulate_1.25   styler_1.8.0      tidyselect_1.1.2  xfun_0.32        
##  [5] purrr_0.3.4       lattice_0.20-45   carData_3.0-5     colorspace_2.0-3 
##  [9] vctrs_0.6.2       generics_0.1.3    htmltools_0.5.3   yaml_2.3.5       
## [13] utf8_1.2.2        rlang_1.1.0       R.oo_1.25.0       pillar_1.8.1     
## [17] glue_1.6.2        withr_2.5.0       DBI_1.1.3         R.utils_2.12.0   
## [21] R.cache_0.16.0    lifecycle_1.0.3   plyr_1.8.7        stringr_1.4.1    
## [25] ggsignif_0.6.3    munsell_0.5.0     gtable_0.3.0      R.methodsS3_1.8.2
## [29] codetools_0.2-19  evaluate_0.16     knitr_1.40        fastmap_1.1.0    
## [33] fansi_1.0.3       broom_1.0.0       Rcpp_1.0.9        backports_1.4.1  
## [37] scales_1.2.1      jsonlite_1.8.0    abind_1.4-5       png_0.1-7        
## [41] digest_0.6.29     stringi_1.7.8     bookdown_0.28     dplyr_1.0.9      
## [45] cli_3.6.1         tools_4.2.3       magrittr_2.0.3    tibble_3.1.8     
## [49] car_3.1-0         tidyr_1.2.0       pkgconfig_2.0.3   Matrix_1.5-3     
## [53] data.table_1.14.2 assertthat_0.2.1  rmarkdown_2.16    rstudioapi_0.14  
## [57] R6_2.5.1          compiler_4.2.3
\end{verbatim}

\hypertarget{03_candidate_prioritization}{%
\chapter{Candidate prioritization}\label{03_candidate_prioritization}}

\hypertarget{jackknife-based-validation-of-purf-models}{%
\section{Jackknife-based validation of PURF models}\label{jackknife-based-validation-of-purf-models}}

\hypertarget{analysis-3}{%
\subsection{Analysis}\label{analysis-3}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ re}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# input set (5393, 1 + 272)}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_3\_pf\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pf3d7\_features }\OperatorTok{=}\NormalTok{ data.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{pf3d7\_outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\NormalTok{REF\_ANTIGENS }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}CSP\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0304600.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}RH5\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0424100.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}MSP5\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0206900.1{-}p1\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}P230\textquotesingle{}}\NormalTok{: }\StringTok{\textquotesingle{}PF3D7\_0209000.1{-}p1\textquotesingle{}}\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# private function for train\_purf()}
\KeywordTok{def}\NormalTok{ \_get\_ref\_antigen\_stats(idx, tree, X, y, ref\_indices, max\_samples}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
    \ControlFlowTok{if}\NormalTok{ max\_samples }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        max\_samples }\OperatorTok{=}\NormalTok{ y.shape[}\DecValTok{0}\NormalTok{]}
\NormalTok{    oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], max\_samples)}
\NormalTok{    ref\_oob }\OperatorTok{=}\NormalTok{ [i }\KeywordTok{in}\NormalTok{ oob\_indices }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ ref\_indices]}
\NormalTok{    ref\_pred }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
\NormalTok{    pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X[ref\_indices,:], check\_input}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{    ref\_pred }\OperatorTok{=}\NormalTok{ pred[:,}\DecValTok{1}\NormalTok{]}
    \ControlFlowTok{return}\NormalTok{ ref\_oob, ref\_pred}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ train\_purf(features, outcome, res\_path, pickle\_path, tree\_filtering}\OperatorTok{=}\VariableTok{None}\NormalTok{, model\_path}\OperatorTok{=}\VariableTok{None}\NormalTok{, n\_jobs}\OperatorTok{=}\DecValTok{1}\NormalTok{):}
    \CommentTok{\# Imputation}
\NormalTok{    imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.DataFrame(X, index}\OperatorTok{=}\NormalTok{features.index, columns}\OperatorTok{=}\NormalTok{features.columns)}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ outcome}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ X}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples before feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
    \CommentTok{\# Feature space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
    \CommentTok{\# Feature space weighting}
\NormalTok{    lab\_pos }\OperatorTok{=}\NormalTok{ X.loc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{,:]}
\NormalTok{    median }\OperatorTok{=}\NormalTok{ np.median(lab\_pos, axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    scaler }\OperatorTok{=}\NormalTok{ MinMaxScaler(feature\_range}\OperatorTok{=}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{10}\NormalTok{))}
\NormalTok{    dist }\OperatorTok{=} \BuiltInTok{list}\NormalTok{()}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(lab\_pos.shape[}\DecValTok{0}\NormalTok{]):}
\NormalTok{        dist.append(distance.euclidean(lab\_pos.iloc[i, :], median))}
\NormalTok{    dist }\OperatorTok{=}\NormalTok{ np.asarray(dist).reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.}\BuiltInTok{round}\NormalTok{(scaler.fit\_transform(dist))}
\NormalTok{    counts }\OperatorTok{=}\NormalTok{ np.array(counts, dtype}\OperatorTok{=}\NormalTok{np.int64)[:, }\DecValTok{0}\NormalTok{]}
\NormalTok{    X\_temp }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{1}\NormalTok{, :]}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ X.iloc[y}\OperatorTok{==}\DecValTok{0}\NormalTok{, :]}
\NormalTok{    y }\OperatorTok{=}\NormalTok{ np.asarray([}\DecValTok{0}\NormalTok{] }\OperatorTok{*}\NormalTok{ X.shape[}\DecValTok{0}\NormalTok{] }\OperatorTok{+}\NormalTok{ [}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(counts)))}
\NormalTok{    appended\_data }\OperatorTok{=}\NormalTok{ [X]}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(counts)):}
\NormalTok{        appended\_data.append(pd.concat([X\_temp.iloc[[i]]] }\OperatorTok{*}\NormalTok{ counts[i]))}
\NormalTok{    X }\OperatorTok{=}\NormalTok{ pd.concat(appended\_data)}
    \BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}There are }\SpecialCharTok{\%d}\StringTok{ positives out of }\SpecialCharTok{\%d}\StringTok{ samples after feature space weighting.\textquotesingle{}} \OperatorTok{\%}\NormalTok{ (}\BuiltInTok{sum}\NormalTok{(y), }\BuiltInTok{len}\NormalTok{(y)))}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{: X.index, }\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{ : y\})}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \KeywordTok{not} \VariableTok{None}\NormalTok{:}
        \CommentTok{\# get ref antigen indices}
\NormalTok{        ref\_index\_dict }\OperatorTok{=}\NormalTok{ \{ref:}\BuiltInTok{list}\NormalTok{() }\ControlFlowTok{for}\NormalTok{ ref }\KeywordTok{in} \BuiltInTok{list}\NormalTok{(REF\_ANTIGENS.values())\}}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(res.shape[}\DecValTok{0}\NormalTok{]):}
            \ControlFlowTok{if}\NormalTok{ res[}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{][i] }\KeywordTok{in} \BuiltInTok{list}\NormalTok{(REF\_ANTIGENS.values()):}
\NormalTok{                ref\_index\_dict[res[}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{][i]].append(res.index[i])}
\NormalTok{        ref\_indices }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(ref\_index\_dict.values(), [])}
        \CommentTok{\# get OOB stats and predictions}
\NormalTok{        X }\OperatorTok{=}\NormalTok{ X.astype(}\StringTok{\textquotesingle{}float32\textquotesingle{}}\NormalTok{)}
\NormalTok{        purf }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(model\_path, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{        trees }\OperatorTok{=}\NormalTok{ purf.estimators\_}
\NormalTok{        idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees))]}
\NormalTok{        stats\_res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{n\_jobs)(}
\NormalTok{                    delayed(\_get\_ref\_antigen\_stats)(idx, trees[idx], np.array(X), y, ref\_indices) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}
        \CommentTok{\# ref\_oob data structure:}
        \CommentTok{\# rows represent individual trees}
        \CommentTok{\# column represent reference antigens}
        \CommentTok{\# cells indicate whether the reference antigen is in the OOB samples of the tree}
\NormalTok{        ref\_oob }\OperatorTok{=}\NormalTok{ np.array([ref\_oob }\ControlFlowTok{for}\NormalTok{ ref\_oob, ref\_pred }\KeywordTok{in}\NormalTok{ stats\_res])}
        \CommentTok{\# ref\_pred data structure:}
        \CommentTok{\# rows represent individual trees}
        \CommentTok{\# column represent reference antigens}
        \CommentTok{\# cells indicate the prediction of the reference antigen by the tree}
\NormalTok{        ref\_pred }\OperatorTok{=}\NormalTok{ np.array([ref\_pred }\ControlFlowTok{for}\NormalTok{ ref\_oob, ref\_pred }\KeywordTok{in}\NormalTok{ stats\_res])}
        \CommentTok{\# analyze duplicated reference antigens as a group}
\NormalTok{        cumsum\_num\_ref }\OperatorTok{=}\NormalTok{ np.cumsum(np.array([}\BuiltInTok{len}\NormalTok{(v) }\ControlFlowTok{for}\NormalTok{ k,v }\KeywordTok{in}\NormalTok{ ref\_index\_dict.items()]))}
\NormalTok{        ref\_oob\_all }\OperatorTok{=}\NormalTok{ np.array([ref\_oob[:, }\DecValTok{0}\NormalTok{:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\ControlFlowTok{if}\NormalTok{ i }\OperatorTok{==} \DecValTok{0} \ControlFlowTok{else} \OperatorTok{\textbackslash{}}
\NormalTok{                                ref\_oob[:, cumsum\_num\_ref[i }\OperatorTok{{-}} \DecValTok{1}\NormalTok{]:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textbackslash{}}
                                \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(REF\_ANTIGENS))]).T}
\NormalTok{        ref\_pred\_all }\OperatorTok{=}\NormalTok{ np.array([ref\_pred[:, }\DecValTok{0}\NormalTok{:cumsum\_num\_ref[i]].}\BuiltInTok{any}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\ControlFlowTok{if}\NormalTok{ i }\OperatorTok{==} \DecValTok{0} \ControlFlowTok{else} \OperatorTok{\textbackslash{}}
\NormalTok{                                 ref\_pred[:, cumsum\_num\_ref[i }\OperatorTok{{-}} \DecValTok{1}\NormalTok{]:cumsum\_num\_ref[i]].}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{) }\OperatorTok{\textbackslash{}}
                                 \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(REF\_ANTIGENS))]).T}
        \CommentTok{\# calculate number of reference antigens as OOB samples for each tree}
\NormalTok{        oob\_total }\OperatorTok{=}\NormalTok{ ref\_oob\_all.}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
        \CommentTok{\# assign score of 1 to trees that correctly predict all OOB reference antigens; otherwise, assign 0 score }
\NormalTok{        weights }\OperatorTok{=}\NormalTok{ np.zeros(}\BuiltInTok{len}\NormalTok{(trees))}
        \CommentTok{\# iterate through the trees and calculate the stats}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees)):}
\NormalTok{            oob\_list }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(ref\_oob\_all[i,:])}
\NormalTok{            pred\_list }\OperatorTok{=} \BuiltInTok{list}\NormalTok{(ref\_pred\_all[i,:])}
            \ControlFlowTok{if}\NormalTok{ oob\_total[i] }\OperatorTok{==} \DecValTok{0}\NormalTok{:}
\NormalTok{                weights[i] }\OperatorTok{=} \DecValTok{0}
            \ControlFlowTok{else}\NormalTok{:}
                \ControlFlowTok{if} \BuiltInTok{sum}\NormalTok{(np.array(pred\_list)[oob\_list] }\OperatorTok{!=} \DecValTok{0}\NormalTok{) }\OperatorTok{==}\NormalTok{ oob\_total[i]:}
\NormalTok{                    weights[i] }\OperatorTok{=} \DecValTok{1}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
        \CommentTok{\# Training PURF}
\NormalTok{        purf }\OperatorTok{=}\NormalTok{ PURandomForestClassifier(}
\NormalTok{            n\_estimators }\OperatorTok{=} \DecValTok{100000}\NormalTok{,}
\NormalTok{            oob\_score }\OperatorTok{=} \VariableTok{True}\NormalTok{,}
\NormalTok{            n\_jobs }\OperatorTok{=} \DecValTok{64}\NormalTok{,}
\NormalTok{            random\_state }\OperatorTok{=} \DecValTok{42}\NormalTok{,}
\NormalTok{            pos\_level }\OperatorTok{=} \FloatTok{0.5}
\NormalTok{        )}
\NormalTok{        purf.fit(X, y)}
    \ControlFlowTok{else}\NormalTok{: }
\NormalTok{        purf.\_set\_oob\_score\_with\_weights(np.array(X), y.reshape(}\OperatorTok{{-}}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{), weights}\OperatorTok{=}\NormalTok{weights)}
    \CommentTok{\# Storing results}
\NormalTok{    res[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ purf.oob\_decision\_function\_[:,}\DecValTok{1}\NormalTok{]}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ features.merge(res.groupby(}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{).mean(), left\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{, right\_on}\OperatorTok{=}\StringTok{\textquotesingle{}protein\_id\textquotesingle{}}\NormalTok{)}
\NormalTok{    features }\OperatorTok{=}\NormalTok{ features[[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]]}
\NormalTok{    features.to\_csv(res\_path)}
    \ControlFlowTok{if}\NormalTok{ tree\_filtering }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
        \ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(pickle\_path, }\StringTok{\textquotesingle{}wb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ out:}
\NormalTok{            pickle.dump(purf, out, pickle.HIGHEST\_PROTOCOL)}
    \ControlFlowTok{else}\NormalTok{:}
        \ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(pickle\_path, }\StringTok{\textquotesingle{}wb\textquotesingle{}}\NormalTok{) }\ImportTok{as}\NormalTok{ out:}
\NormalTok{            pickle.dump(\{}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{: purf, }\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{: weights\}, out, pickle.HIGHEST\_PROTOCOL)}
\end{Highlighting}
\end{Shaded}

\hypertarget{training-on-whole-data-set}{%
\subsubsection{Training on whole data set}\label{training-on-whole-data-set}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train\_purf(pf3d7\_features, pf3d7\_outcome,}
\NormalTok{           res\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/0.5\_res\_tree\_filtering.csv\textquotesingle{}}\NormalTok{,}
\NormalTok{           pickle\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{,}
\NormalTok{           model\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_lebel/0.5\_purf.pkl\textquotesingle{}}\NormalTok{,}
\NormalTok{           n\_jobs}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{wo\_tree\_filtering }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/0.5\_res.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{w\_tree\_filtering }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/pos\_level/0.5\_res\_tree\_filtering.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([wo\_tree\_filtering, w\_tree\_filtering[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{]], join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}oob\_score\_without\_tree\_filtering\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}oob\_score\_with\_tree\_filtering\textquotesingle{}}\NormalTok{]}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_4\_purf\_oob\_predictions.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{validation-for-purf-without-tree-filtering}{%
\subsubsection{Validation for PURF without tree filtering}\label{validation-for-purf-without-tree-filtering}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (idx, (antigen, out)) }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(}\BuiltInTok{zip}\NormalTok{(pf3d7\_features.index, pf3d7\_outcome)):}
    \ControlFlowTok{if}\NormalTok{ out }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
        \ControlFlowTok{if}\NormalTok{ antigen }\KeywordTok{in}\NormalTok{ REF\_ANTIGENS.values():}
            \ControlFlowTok{continue}
\NormalTok{        pf3d7\_outcome\_ }\OperatorTok{=}\NormalTok{ pf3d7\_outcome.copy()}
\NormalTok{        pf3d7\_outcome\_[idx] }\OperatorTok{=} \DecValTok{0}
\NormalTok{        train\_purf(pf3d7\_features, pf3d7\_outcome\_,}
\NormalTok{                   res\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/jackknife/\textquotesingle{}} \OperatorTok{+}\NormalTok{ antigen }\OperatorTok{+} \StringTok{\textquotesingle{}\_res.csv\textquotesingle{}}\NormalTok{,}
\NormalTok{                   pickle\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/jackknife/\textquotesingle{}} \OperatorTok{+}\NormalTok{ antigen }\OperatorTok{+} \StringTok{\textquotesingle{}\_purf.pkl\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/jackknife/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}

\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files:}
    \ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{):}
\NormalTok{        tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}
        \ControlFlowTok{break}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [re.match(}\StringTok{\textquotesingle{}PF3D7\_[0{-}9]+\textbackslash{}.[0{-}9]{-}p1\textquotesingle{}}\NormalTok{, }\BuiltInTok{file}\NormalTok{)[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_5\_validation.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{validation-for-purf-with-tree-filtering}{%
\subsubsection{Validation for PURF with tree filtering}\label{validation-for-purf-with-tree-filtering}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (idx, (antigen, out)) }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(}\BuiltInTok{zip}\NormalTok{(pf3d7\_features.index, pf3d7\_outcome)):}
    \ControlFlowTok{if}\NormalTok{ out }\OperatorTok{==} \DecValTok{1}\NormalTok{:}
        \ControlFlowTok{if}\NormalTok{ antigen }\KeywordTok{in}\NormalTok{ REF\_ANTIGENS.values():}
            \ControlFlowTok{continue}
\NormalTok{        pf3d7\_outcome\_ }\OperatorTok{=}\NormalTok{ pf3d7\_outcome.copy()}
\NormalTok{        pf3d7\_outcome\_[idx] }\OperatorTok{=} \DecValTok{0}
\NormalTok{        train\_purf(pf3d7\_features, pf3d7\_outcome\_,}
\NormalTok{                   res\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/tree\_filtering\_jackknife/\textquotesingle{}} \OperatorTok{+}\NormalTok{ antigen }\OperatorTok{+} \StringTok{\textquotesingle{}\_res.csv\textquotesingle{}}\NormalTok{,}
\NormalTok{                   pickle\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/tree\_filtering\_jackknife/\textquotesingle{}} \OperatorTok{+}\NormalTok{ antigen }\OperatorTok{+} \StringTok{\textquotesingle{}\_purf.pkl\textquotesingle{}}\NormalTok{,}
\NormalTok{                   model\_path}\OperatorTok{=}\StringTok{\textquotesingle{}\textasciitilde{}/Downloads/jackknife/\textquotesingle{}} \OperatorTok{+}\NormalTok{ antigen }\OperatorTok{+} \StringTok{\textquotesingle{}\_purf.pkl\textquotesingle{}}\NormalTok{,}
\NormalTok{                   n\_jobs}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{dir} \OperatorTok{=} \StringTok{\textquotesingle{}\textasciitilde{}/Downloads/tree\_filtering\_jackknife/\textquotesingle{}}
\NormalTok{files }\OperatorTok{=}\NormalTok{ os.listdir(}\BuiltInTok{dir}\NormalTok{)}

\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files:}
    \ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{):}
\NormalTok{        tmp }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{]}
        \ControlFlowTok{break}

\NormalTok{data\_frames }\OperatorTok{=}\NormalTok{ [pd.read\_csv(}\BuiltInTok{dir} \OperatorTok{+} \BuiltInTok{file}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)[}\StringTok{\textquotesingle{}OOB score\textquotesingle{}}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df }\OperatorTok{=}\NormalTok{ pd.concat([tmp] }\OperatorTok{+}\NormalTok{ data\_frames, join}\OperatorTok{=}\StringTok{\textquotesingle{}outer\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}\NormalTok{)}
\NormalTok{colnames }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}antigen\_label\textquotesingle{}}\NormalTok{] }\OperatorTok{+}\NormalTok{ [re.match(}\StringTok{\textquotesingle{}PF3D7\_[0{-}9]+\textbackslash{}.[0{-}9]{-}p1\textquotesingle{}}\NormalTok{, }\BuiltInTok{file}\NormalTok{)[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for} \BuiltInTok{file} \KeywordTok{in}\NormalTok{ files }\ControlFlowTok{if} \BuiltInTok{file}\NormalTok{.endswith(}\StringTok{\textquotesingle{}csv\textquotesingle{}}\NormalTok{)]}
\NormalTok{merged\_df.columns }\OperatorTok{=}\NormalTok{ colnames}
\NormalTok{merged\_df.to\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_6\_tree\_filtering\_validation.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-3}{%
\subsection{Plotting}\label{plotting-3}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mixR)}
\FunctionTok{library}\NormalTok{(pracma)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(grid)}
\FunctionTok{library}\NormalTok{(ggbeeswarm)}
\FunctionTok{library}\NormalTok{(ggpubr)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_4\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\CommentTok{\# Extract data with only unlabeled proteins}
\NormalTok{data\_unl }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ]}

\NormalTok{validation\_wo\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_5\_validation.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{validation\_w\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_6\_tree\_filtering\_validation.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plot-score-distribution}{%
\subsubsection{Plot score distribution}\label{plot-score-distribution}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{mixfit}\NormalTok{(data\_unl[, }\StringTok{"oob\_score\_with\_tree\_filtering"}\NormalTok{], }\AttributeTok{ncomp =} \DecValTok{2}\NormalTok{)}

\CommentTok{\# Calculate receiver operating characteristic (ROC) curve}
\CommentTok{\# for putative positive and negative samples}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{1.5}\NormalTok{, }\AttributeTok{by =} \FloatTok{0.01}\NormalTok{)}
\NormalTok{neg\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{1}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{1}\NormalTok{])}
\NormalTok{pos\_cum }\OtherTok{\textless{}{-}} \FunctionTok{pnorm}\NormalTok{(x, }\AttributeTok{mean =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{mu[}\DecValTok{2}\NormalTok{], }\AttributeTok{sd =}\NormalTok{ fit}\SpecialCharTok{$}\NormalTok{sd[}\DecValTok{2}\NormalTok{])}
\NormalTok{fpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ neg\_cum) }\SpecialCharTok{+}\NormalTok{ neg\_cum) }\CommentTok{\# false positive / (false positive + true negative)}
\NormalTok{tpr }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{/}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ pos\_cum) }\SpecialCharTok{+}\NormalTok{ pos\_cum) }\CommentTok{\# true positive / (true positive + false negative)}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{plot}\NormalTok{(fit, }\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"PURF with tree filtering"}\NormalTok{, }\StringTok{" (AUROC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{fpr, tpr), }\DecValTok{2}\NormalTok{), }\StringTok{")"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Putative negative"}\NormalTok{, }\StringTok{"Putative positive"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.8}\NormalTok{, }\FloatTok{0.9}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.3}\NormalTok{, }\FloatTok{1.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Density"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{percent-rank-for-labeled-positives}{%
\subsubsection{Percent rank for labeled positives}\label{percent-rank-for-labeled-positives}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data[}\FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\StringTok{"oob\_score\_with\_tree\_filtering"}\NormalTok{)]}
\FunctionTok{colnames}\NormalTok{(data\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"antigen\_label"}\NormalTok{, }\StringTok{"OOB score"}\NormalTok{)}
\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{percent\_rank }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(data\_[[}\StringTok{"OOB score"}\NormalTok{]]) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data)}
\NormalTok{data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}
\NormalTok{data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{percent\_rank), ]}
\NormalTok{data\_}\SpecialCharTok{$}\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(data\_) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_)}
\FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"EPR: "}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}} \SpecialCharTok{\textgreater{}=} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{nrow}\NormalTok{(data\_), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{percent\_rank}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =} \StringTok{\textasciigrave{}}\AttributeTok{OOB score}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{size =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_gradient2}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{mid =} \StringTok{"purple"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{midpoint =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{0}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{, }\FloatTok{0.15}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{colour =} \FunctionTok{guide\_colourbar}\NormalTok{(}\AttributeTok{title.position =} \StringTok{"top"}\NormalTok{, }\AttributeTok{direction =} \StringTok{"horizontal"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"PURF with tree filtering"}\NormalTok{, }\StringTok{" (AUC = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{trapz}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{x, }\DecValTok{1}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, data\_}\SpecialCharTok{$}\NormalTok{percent\_rank, }\DecValTok{0}\NormalTok{)), }\DecValTok{2}\NormalTok{), }\StringTok{")"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Ranked known antigens (scaled)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Percent rank"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{colour =} \StringTok{"Score (proportion of votes)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{comparison-of-known-antigens}{%
\subsubsection{Comparison of known antigens}\label{comparison-of-known-antigens}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calculate\_known\_antigen\_scores }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(validation\_data, baseline\_scores) \{}
\NormalTok{  scores }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(validation\_data)) \{}
\NormalTok{    known\_antigen }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(validation\_data))[i]}
\NormalTok{    other\_antigens }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(validation\_data))[}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, i)]}
\NormalTok{    scores }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(scores, }\FunctionTok{mean}\NormalTok{(validation\_data[other\_antigens, known\_antigen] }\SpecialCharTok{{-}}\NormalTok{ baseline\_scores[other\_antigens, ]))}
\NormalTok{  \}}
  \FunctionTok{return}\NormalTok{(scores)}
\NormalTok{\}}
\NormalTok{scores\_wo\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_scores}\NormalTok{(}
\NormalTok{  validation\_wo\_tree\_filtering,}
\NormalTok{  data[}\StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{]}
\NormalTok{)}
\NormalTok{scores\_w\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_known\_antigen\_scores}\NormalTok{(}
\NormalTok{  validation\_w\_tree\_filtering,}
\NormalTok{  data[}\StringTok{"oob\_score\_with\_tree\_filtering"}\NormalTok{]}
\NormalTok{)}

\NormalTok{data\_ }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{group =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
    \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{length}\NormalTok{(scores\_wo\_tree\_filtering)),}
    \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(scores\_w\_tree\_filtering))}
\NormalTok{  )),}
  \AttributeTok{score =} \FunctionTok{c}\NormalTok{(scores\_wo\_tree\_filtering, scores\_w\_tree\_filtering),}
  \AttributeTok{paired =} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{48}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{)}

\NormalTok{stats }\OtherTok{\textless{}{-}} \FunctionTok{compare\_means}\NormalTok{(score }\SpecialCharTok{\textasciitilde{}}\NormalTok{ group, }\AttributeTok{data =}\NormalTok{ data\_, }\AttributeTok{method =} \StringTok{"wilcox.test"}\NormalTok{, }\AttributeTok{paired =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ group, }\AttributeTok{y =}\NormalTok{ score)) }\SpecialCharTok{+}
  \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ group), }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{group =}\NormalTok{ paired), }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_beeswarm}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ group),}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{cex =} \DecValTok{2}\NormalTok{, }\AttributeTok{priority =} \StringTok{"random"}\NormalTok{,}
    \AttributeTok{shape =} \DecValTok{21}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#f7d59e"}\NormalTok{, }\StringTok{"\#fcd7d7"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#fc9d03"}\NormalTok{, }\StringTok{"red"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{18}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean difference in scores (proportion of votes)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{comparison-of-top-200-candidates}{%
\subsubsection{Comparison of top 200 candidates}\label{comparison-of-top-200-candidates}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calculate\_overlapping\_candidates }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data, validation\_data) \{}
\NormalTok{  top\_200 }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{48}\NormalTok{) \{}
\NormalTok{    data\_ }\OtherTok{\textless{}{-}}\NormalTok{ validation\_data[data}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ]}
\NormalTok{    data\_ }\OtherTok{\textless{}{-}}\NormalTok{ data\_[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data\_[, }\DecValTok{1} \SpecialCharTok{+}\NormalTok{ i]), ][}\DecValTok{1}\SpecialCharTok{:}\DecValTok{200}\NormalTok{, ]}
\NormalTok{    top\_200 }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(top\_200, }\FunctionTok{rownames}\NormalTok{(data\_))}
\NormalTok{  \}}
\NormalTok{  union\_top\_200 }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(top\_200))}
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\FunctionTok{length}\NormalTok{(union\_top\_200), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
\NormalTok{  mat }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{matrix}\NormalTok{(}\DecValTok{0}\NormalTok{, }\AttributeTok{nrow =} \FunctionTok{length}\NormalTok{(union\_top\_200), }\AttributeTok{ncol =} \DecValTok{48}\NormalTok{))}
  \FunctionTok{rownames}\NormalTok{(mat) }\OtherTok{\textless{}{-}}\NormalTok{ union\_top\_200}
  \FunctionTok{colnames}\NormalTok{(mat) }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\DecValTok{48}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{48}\NormalTok{) mat[top\_200[[i]], i] }\OtherTok{\textless{}{-}} \DecValTok{1}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{apply}\NormalTok{(mat, }\DecValTok{1}\NormalTok{, sum))}
\NormalTok{\}}
\NormalTok{agreement\_wo\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_overlapping\_candidates}\NormalTok{(data, validation\_wo\_tree\_filtering)}
\NormalTok{agreement\_w\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{calculate\_overlapping\_candidates}\NormalTok{(data, validation\_w\_tree\_filtering)}
\NormalTok{y1 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{48}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{sum}\NormalTok{(agreement\_wo\_tree\_filtering }\SpecialCharTok{\textgreater{}=}\NormalTok{ x))}
\NormalTok{y2 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{48}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{sum}\NormalTok{(agreement\_w\_tree\_filtering }\SpecialCharTok{\textgreater{}=}\NormalTok{ x))}
\NormalTok{data\_ }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{48}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{y =} \FunctionTok{c}\NormalTok{(y1, y2),}
  \AttributeTok{group =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{length}\NormalTok{(y1)), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(y2))))}
\NormalTok{)}

\NormalTok{p4 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{color =}\NormalTok{ group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#fc9d03"}\NormalTok{, }\StringTok{"red"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_reverse}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{48}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\DecValTok{114}\NormalTok{, }\DecValTok{150}\NormalTok{, }\DecValTok{200}\NormalTok{, }\DecValTok{250}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.72}\NormalTok{, }\FloatTok{0.15}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Number of models"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of candidate antigens"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1, p2, p3, p4, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{))}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 2} \end{center}

\hypertarget{model-interpretation}{%
\section{Model interpretation}\label{model-interpretation}}

PURF model interpretation with permutation-based variable importance and Wilcox test.

\hypertarget{analysis-4}{%
\subsection{Analysis}\label{analysis-4}}

\hypertarget{variable-importance}{%
\subsubsection{Variable importance}\label{variable-importance}}

Permutation-based variable importance and group variable importance.

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{import}\NormalTok{ multiprocessing}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\NormalTok{num\_cores }\OperatorTok{=}\NormalTok{ multiprocessing.cpu\_count()}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pf\_ml\_input\_processed\_weighted.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pf3d7\_features\_processed }\OperatorTok{=}\NormalTok{ data.iloc[:,}\DecValTok{1}\NormalTok{:]}
\NormalTok{pf3d7\_outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\NormalTok{purf\_model }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{purf }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{]}
\NormalTok{weights }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{]}

\NormalTok{metadata }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_2\_pf\_protein\_variable\_metadata.csv\textquotesingle{}}\NormalTok{)}
\NormalTok{groups }\OperatorTok{=}\NormalTok{ metadata.loc[np.isin(metadata[}\StringTok{\textquotesingle{}column name\textquotesingle{}}\NormalTok{], pf3d7\_features\_processed.columns), }\StringTok{\textquotesingle{}category\textquotesingle{}}\NormalTok{].array}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ calculate\_raw\_var\_imp\_(idx, tree, X, y, weight, groups}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{    rng }\OperatorTok{=}\NormalTok{ np.random.RandomState(idx)}
\NormalTok{    oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{])}
\NormalTok{    oob\_pos }\OperatorTok{=}\NormalTok{ np.intersect1d(oob\_indices, np.where(y }\OperatorTok{==} \DecValTok{1}\NormalTok{)[}\DecValTok{0}\NormalTok{])}
\NormalTok{    noutall }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(oob\_pos)}
\NormalTok{    pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X.iloc[oob\_pos,:])[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{    nrightall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{    imprt, impsd }\OperatorTok{=}\NormalTok{ [], []}
    \ControlFlowTok{if}\NormalTok{ groups }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
        \ControlFlowTok{for}\NormalTok{ var }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(X.shape[}\DecValTok{1}\NormalTok{]):}
\NormalTok{            X\_temp }\OperatorTok{=}\NormalTok{ X.copy()}
\NormalTok{            X\_temp.iloc[:, var] }\OperatorTok{=}\NormalTok{ rng.permutation(X\_temp.iloc[:, var])}
\NormalTok{            pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X\_temp.iloc[oob\_pos,:])[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{            nrightimpall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{            delta }\OperatorTok{=}\NormalTok{ (nrightall }\OperatorTok{{-}}\NormalTok{ nrightimpall) }\OperatorTok{/}\NormalTok{ noutall }\OperatorTok{*}\NormalTok{ weight}
\NormalTok{            imprt.append(delta)}
\NormalTok{            impsd.append(delta }\OperatorTok{*}\NormalTok{ delta)}
    \ControlFlowTok{else}\NormalTok{:}
        \ControlFlowTok{for}\NormalTok{ grp }\KeywordTok{in}\NormalTok{ np.unique(groups):}
\NormalTok{            X\_temp }\OperatorTok{=}\NormalTok{ X.copy()}
\NormalTok{            X\_temp.iloc[:, groups }\OperatorTok{==}\NormalTok{ grp] }\OperatorTok{=}\NormalTok{ rng.permutation(X\_temp.iloc[:, groups }\OperatorTok{==}\NormalTok{ grp])}
\NormalTok{            pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X\_temp.iloc[oob\_pos,:])[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{            nrightimpall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{            delta }\OperatorTok{=}\NormalTok{ (nrightall }\OperatorTok{{-}}\NormalTok{ nrightimpall) }\OperatorTok{/}\NormalTok{ noutall }\OperatorTok{*}\NormalTok{ weight}
\NormalTok{            imprt.append(delta)}
\NormalTok{            impsd.append(delta }\OperatorTok{*}\NormalTok{ delta)}
    \ControlFlowTok{return}\NormalTok{ (imprt, impsd)}
  
\KeywordTok{def}\NormalTok{ calculate\_var\_imp(model, features, outcome, num\_cores, weights}\OperatorTok{=}\VariableTok{None}\NormalTok{, groups}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{    trees }\OperatorTok{=}\NormalTok{ model.estimators\_}
\NormalTok{    idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees))]}
    \ControlFlowTok{if}\NormalTok{ weights }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        weights }\OperatorTok{=}\NormalTok{ np.ones(}\BuiltInTok{len}\NormalTok{(trees))}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{      delayed(calculate\_raw\_var\_imp\_)(idx, trees[idx], features, outcome, weights[idx], groups) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}
\NormalTok{    imprt, impsd }\OperatorTok{=}\NormalTok{ [], []}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(idx\_list)):}
\NormalTok{        imprt.append(res[i][}\DecValTok{0}\NormalTok{])}
\NormalTok{        impsd.append(res[i][}\DecValTok{1}\NormalTok{])}
\NormalTok{    imprt }\OperatorTok{=}\NormalTok{ np.array(imprt).}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    impsd }\OperatorTok{=}\NormalTok{ np.array(impsd).}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    imprt }\OperatorTok{/=} \BuiltInTok{sum}\NormalTok{(weights)}
\NormalTok{    impsd }\OperatorTok{=}\NormalTok{ np.sqrt(((impsd }\OperatorTok{/} \BuiltInTok{sum}\NormalTok{(weights)) }\OperatorTok{{-}}\NormalTok{ imprt }\OperatorTok{*}\NormalTok{ imprt) }\OperatorTok{/} \BuiltInTok{sum}\NormalTok{(weights))}
\NormalTok{    mda }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(imprt)):}
        \ControlFlowTok{if}\NormalTok{ impsd[i] }\OperatorTok{!=} \DecValTok{0}\NormalTok{:}
\NormalTok{            mda.append(imprt[i] }\OperatorTok{/}\NormalTok{ impsd[i])}
        \ControlFlowTok{else}\NormalTok{:}
\NormalTok{            mda.append(imprt[i])}
    \ControlFlowTok{if}\NormalTok{ groups }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        var\_imp }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{: features.columns, }\StringTok{\textquotesingle{}meanDecreaseAccuracy\textquotesingle{}}\NormalTok{: mda\})}
    \ControlFlowTok{else}\NormalTok{: }
\NormalTok{        var\_imp }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{: np.unique(groups), }\StringTok{\textquotesingle{}meanDecreaseAccuracy\textquotesingle{}}\NormalTok{: mda\})}
    \ControlFlowTok{return}\NormalTok{ var\_imp}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{var\_imp }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, pf3d7\_features\_processed, pf3d7\_outcome, num\_cores, weights)}
\NormalTok{grp\_var\_imp }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, pf3d7\_features\_processed, pf3d7\_outcome, num\_cores, weights, groups)}
\NormalTok{var\_imp.to\_csv(}\StringTok{\textquotesingle{}./other\_data/known\_antigen\_variable\_importance.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\NormalTok{grp\_var\_imp.to\_csv(}\StringTok{\textquotesingle{}./other\_data/known\_antigen\_group\_variable\_importance.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{wilcoxon-test}{%
\subsubsection{Wilcoxon test}\label{wilcoxon-test}}

Variable value comparison between known antigens and other 52 random proteins predicted as negative.

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_4\_purf\_oob\_predictions.csv"}\NormalTok{)}
\NormalTok{known\_antigens }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\NormalTok{other\_proteins }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ prediction}\SpecialCharTok{$}\NormalTok{oob\_score\_with\_tree\_filtering }\SpecialCharTok{\textless{}} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{22}\NormalTok{)}
\NormalTok{random\_proteins }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(other\_proteins, }\AttributeTok{size =} \DecValTok{52}\NormalTok{, }\AttributeTok{replace =} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Load imputed data}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_ml\_input\_processed\_weighted.csv"}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[}\SpecialCharTok{!}\FunctionTok{duplicated}\NormalTok{(data), ]}
\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{X, }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ known\_antigens) }\DecValTok{1} \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ random\_proteins) }\DecValTok{0} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[, }\DecValTok{3}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)]}

\CommentTok{\# Min{-}max normalization}
\NormalTok{min\_max }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  (x }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x)) }\SpecialCharTok{/}\NormalTok{ (}\FunctionTok{max}\NormalTok{(x) }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x))}
\NormalTok{\}}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(data, min\_max))}

\FunctionTok{save}\NormalTok{(compared\_group, data, }\AttributeTok{file =} \StringTok{"./rdata/known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)) \{}
\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{wilcox.test}\NormalTok{(data[compared\_group }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, i], data[compared\_group }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, i])}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}
\NormalTok{adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}
\CommentTok{\# adj\_pval = {-}log10(adj\_pval)}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{variable =} \FunctionTok{colnames}\NormalTok{(data), }\AttributeTok{adj\_pval =}\NormalTok{ adj\_pval)}
\FunctionTok{write.csv}\NormalTok{(wilcox\_res, }\StringTok{"./other\_data/known\_antigen\_wilcox\_res.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-4}{%
\subsection{Plotting}\label{plotting-4}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(stringr)}

\NormalTok{colorset }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"genomic"} \OtherTok{=} \StringTok{"\#0C1C63"}\NormalTok{, }\StringTok{"immunological"} \OtherTok{=} \StringTok{"\#408002"}\NormalTok{, }\StringTok{"proteomic"} \OtherTok{=} \StringTok{"\#0F80FF"}\NormalTok{, }\StringTok{"structural"} \OtherTok{=} \StringTok{"\#FEAE34"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{variable-importance-1}{%
\subsubsection{Variable importance}\label{variable-importance-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/known\_antigen\_variable\_importance.csv"}\NormalTok{)}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), ]}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, ]}

\NormalTok{metadata }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_2\_pf\_protein\_variable\_metadata.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{metadata }\OtherTok{\textless{}{-}}\NormalTok{ metadata[}\FunctionTok{c}\NormalTok{(}\StringTok{"category"}\NormalTok{, }\StringTok{"column name"}\NormalTok{)]}
\NormalTok{metadata }\OtherTok{\textless{}{-}}\NormalTok{ metadata[metadata}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{column name}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ var\_imp}\SpecialCharTok{$}\NormalTok{variable, ]}

\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ metadata, }\AttributeTok{by.x =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"column name"}\NormalTok{)}
\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{category, }\AttributeTok{levels =} \FunctionTok{names}\NormalTok{(colorset))}
\NormalTok{var\_imp}\SpecialCharTok{$}\NormalTok{color }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{category, }\ControlFlowTok{function}\NormalTok{(x) colorset[x])}

\NormalTok{var\_imp\_ }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp}
\NormalTok{firstup }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OtherTok{\textless{}{-}} \FunctionTok{toupper}\NormalTok{(}\FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{  x}
\NormalTok{\}}
\NormalTok{var\_imp\_}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(var\_imp\_}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(var\_imp\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ meanDecreaseAccuracy, }\AttributeTok{fill =}\NormalTok{ category)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{pch =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ colorset, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Genomic"}\NormalTok{, }\StringTok{"Immunological"}\NormalTok{, }\StringTok{"Proteomic"}\NormalTok{, }\StringTok{"Structural"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{min}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), }\FunctionTok{max}\NormalTok{(var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.major.y =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dotted"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{20}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.2}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean decrease in accuracy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{group-variable-importance}{%
\subsubsection{Group variable importance}\label{group-variable-importance}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grp\_var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/known\_antigen\_group\_variable\_importance.csv"}\NormalTok{)}

\NormalTok{grp\_var\_imp\_ }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp}
\NormalTok{grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{category }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{tolower}\NormalTok{(grp\_var\_imp\_}\SpecialCharTok{$}\NormalTok{variable))}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(grp\_var\_imp\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ meanDecreaseAccuracy, }\AttributeTok{fill =}\NormalTok{ category)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{pch =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =}\NormalTok{ colorset, }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Genomic"}\NormalTok{, }\StringTok{"Immunological"}\NormalTok{, }\StringTok{"Proteomic"}\NormalTok{, }\StringTok{"Structural"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{min}\NormalTok{(grp\_var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), }\FunctionTok{max}\NormalTok{(grp\_var\_imp}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy) }\SpecialCharTok{+} \DecValTok{5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.major.y =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dotted"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{10}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{20}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{57}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Mean decrease in accuracy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{wilcoxon-test-1}{%
\subsubsection{Wilcoxon test}\label{wilcoxon-test-1}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/known\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/known\_antigen\_wilcox\_res.csv"}\NormalTok{)}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}}\NormalTok{ compared\_group}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data[wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\SpecialCharTok{!=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, ]}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(wilcox\_data, }\AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\StringTok{"compared\_group"}\NormalTok{))}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wilcox\_data, }\AttributeTok{y =} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ wilcox\_res), }\AttributeTok{by =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{tile\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(wilcox\_data))}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group)}

\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(wilcox\_data)) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval[i]}
  \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{1e{-}3}\NormalTok{) \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{round}\NormalTok{(x, }\DecValTok{3}\NormalTok{))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    a }\OtherTok{\textless{}{-}} \FunctionTok{strsplit}\NormalTok{(}\FunctionTok{format}\NormalTok{(x, }\AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{3}\NormalTok{), }\StringTok{"e"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{1}\NormalTok{]), }\StringTok{" \%*\% 10\^{}"}\NormalTok{, }\FunctionTok{as.integer}\NormalTok{(a[}\DecValTok{2}\NormalTok{]))}
\NormalTok{  \}}
\NormalTok{  adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(adj\_pval\_tmp, res)}
\NormalTok{\}}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval }\OtherTok{\textless{}{-}}\NormalTok{ adj\_pval\_tmp}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# p3\_1 = ggplot(wilcox\_data, aes(x=reorder(variable, meanDecreaseAccuracy), y=tile\_pos)) +}
\CommentTok{\#   geom\_text(aes(label=adj\_pval), size=3, fontface=\textquotesingle{}plain\textquotesingle{}, family=\textquotesingle{}sans\textquotesingle{}, hjust=0, parse=TRUE) +}
\CommentTok{\#   scale\_fill\_gradient(low=\textquotesingle{}blue\textquotesingle{}, high=\textquotesingle{}red\textquotesingle{}) +}
\CommentTok{\#   coord\_flip() +}
\CommentTok{\#   theme\_bw() +}
\CommentTok{\#   xlab(\textquotesingle{}\textquotesingle{}) +}
\CommentTok{\#   ylab(\textquotesingle{}\textquotesingle{}) +}
\CommentTok{\#   ylim(0, 0.5)}
\CommentTok{\#}
\CommentTok{\# legend\_1 = get\_legend(p3\_1 +}
\CommentTok{\#                         theme(legend.title=element\_text(vjust=0.7, color=\textquotesingle{}black\textquotesingle{}),}
\CommentTok{\#                               legend.background=element\_blank()) +}
\CommentTok{\#                         guides(fill=guide\_colorbar(title=expression("{-}Log"[10]*"FDR"),}
\CommentTok{\#                                                    direction = "horizontal")))}

\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(wilcox\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, meanDecreaseAccuracy), }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ compared\_group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{position =} \FunctionTok{position\_jitterdodge}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ adj\_pval), }\AttributeTok{y =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{, }\AttributeTok{family =} \StringTok{"sans"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{parse =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9} \SpecialCharTok{+} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"solid"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"blue"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Known antigens"}\NormalTok{, }\StringTok{"Random predicted non{-}antigens"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Normalized variable value"}\NormalTok{)}

\NormalTok{legend\_2 }\OtherTok{\textless{}{-}} \FunctionTok{get\_legend}\NormalTok{(p3 }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.direction =} \StringTok{"horizontal"}\NormalTok{,}
    \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{, }\FloatTok{0.9}\NormalTok{)}
\NormalTok{  ))}

\NormalTok{p3 }\OtherTok{\textless{}{-}}\NormalTok{ p3 }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}
  \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{size =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
  \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{90}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
  \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}
  \FunctionTok{plot\_grid}\NormalTok{(p1, p3,}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{),}
    \AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.47}\NormalTok{, }\FloatTok{0.53}\NormalTok{)}
\NormalTok{  ),}
  \FunctionTok{plot\_grid}\NormalTok{(p2, }\ConstantTok{NULL}\NormalTok{, legend\_2,}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{, }\StringTok{""}\NormalTok{), }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{,}
    \AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.47}\NormalTok{, }\FloatTok{0.13}\NormalTok{, }\FloatTok{0.4}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.65}\NormalTok{, }\FloatTok{0.35}\NormalTok{)}
\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 3} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] stringr_1.4.1    ggpubr_0.4.0     ggbeeswarm_0.6.0 cowplot_1.1.1   
## [5] ggplot2_3.4.2    rlist_0.4.6.2    pracma_2.3.8     mixR_0.2.0      
## 
## loaded via a namespace (and not attached):
##  [1] reticulate_1.25   styler_1.8.0      beeswarm_0.4.0    tidyselect_1.1.2 
##  [5] xfun_0.32         purrr_0.3.4       lattice_0.20-45   carData_3.0-5    
##  [9] colorspace_2.0-3  vctrs_0.6.2       generics_0.1.3    htmltools_0.5.3  
## [13] yaml_2.3.5        utf8_1.2.2        rlang_1.1.0       R.oo_1.25.0      
## [17] pillar_1.8.1      glue_1.6.2        withr_2.5.0       DBI_1.1.3        
## [21] R.utils_2.12.0    R.cache_0.16.0    lifecycle_1.0.3   ggsignif_0.6.3   
## [25] munsell_0.5.0     gtable_0.3.0      R.methodsS3_1.8.2 codetools_0.2-19 
## [29] evaluate_0.16     knitr_1.40        fastmap_1.1.0     vipor_0.4.5      
## [33] fansi_1.0.3       broom_1.0.0       Rcpp_1.0.9        backports_1.4.1  
## [37] scales_1.2.1      jsonlite_1.8.0    abind_1.4-5       png_0.1-7        
## [41] digest_0.6.29     stringi_1.7.8     rstatix_0.7.0     bookdown_0.28    
## [45] dplyr_1.0.9       cli_3.6.1         tools_4.2.3       magrittr_2.0.3   
## [49] tibble_3.1.8      car_3.1-0         tidyr_1.2.0       pkgconfig_2.0.3  
## [53] Matrix_1.5-3      data.table_1.14.2 assertthat_0.2.1  rmarkdown_2.16   
## [57] rstudioapi_0.14   R6_2.5.1          compiler_4.2.3
\end{verbatim}

\hypertarget{04_candidate_antigen_clustering}{%
\chapter{Candidate antigen clustering}\label{04_candidate_antigen_clustering}}

\hypertarget{clustering-analysis-of-the-proximity-matrix-from-the-tree-filtered-purf-model}{%
\section{Clustering analysis of the proximity matrix from the tree-filtered PURF model}\label{clustering-analysis-of-the-proximity-matrix-from-the-tree-filtered-purf-model}}

\hypertarget{analysis-5}{%
\subsection{Analysis}\label{analysis-5}}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ purf.pu\_ensemble }\ImportTok{import}\NormalTok{ PURandomForestClassifier}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ multiprocessing}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\NormalTok{num\_cores }\OperatorTok{=}\NormalTok{ multiprocessing.cpu\_count()}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# input set (5393, 1 + 272)}
\NormalTok{data }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_3\_pf\_ml\_input.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{features }\OperatorTok{=}\NormalTok{ data.iloc[:, }\DecValTok{1}\NormalTok{:]}
\NormalTok{outcome }\OperatorTok{=}\NormalTok{ np.array(data.antigen\_label)}

\CommentTok{\# Imputation}
\NormalTok{imputer }\OperatorTok{=}\NormalTok{ SimpleImputer(strategy}\OperatorTok{=}\StringTok{\textquotesingle{}median\textquotesingle{}}\NormalTok{)}
\NormalTok{X }\OperatorTok{=}\NormalTok{ imputer.fit\_transform(features)}

\CommentTok{\# Load model}
\NormalTok{model\_tree\_filtered }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/0.5\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{model }\OperatorTok{=}\NormalTok{ model\_tree\_filtered[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{]}
\NormalTok{weights }\OperatorTok{=}\NormalTok{ model\_tree\_filtered[}\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{]}

\KeywordTok{def}\NormalTok{ calculate\_proximity\_(trees, y, leaf\_indices):}
\NormalTok{    same\_leaf\_mat }\OperatorTok{=}\NormalTok{ np.zeros([y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{]])}
\NormalTok{    same\_oob\_mat }\OperatorTok{=}\NormalTok{ np.zeros([y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{]])}
    \ControlFlowTok{for}\NormalTok{ idx, tree }\KeywordTok{in} \BuiltInTok{enumerate}\NormalTok{(trees):}
\NormalTok{        oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{])}
        \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ oob\_indices:}
            \ControlFlowTok{for}\NormalTok{ j }\KeywordTok{in}\NormalTok{ oob\_indices:}
\NormalTok{                same\_oob\_mat[i, j] }\OperatorTok{+=} \DecValTok{1}
                \ControlFlowTok{if}\NormalTok{ leaf\_indices[i, idx] }\OperatorTok{==}\NormalTok{ leaf\_indices[j, idx]:}
\NormalTok{                    same\_leaf\_mat[i, j] }\OperatorTok{+=} \DecValTok{1}
    \ControlFlowTok{return}\NormalTok{ (same\_leaf\_mat, same\_oob\_mat)}

\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Calculate proximity without tree filtering}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}

\NormalTok{trees }\OperatorTok{=}\NormalTok{ model.estimators\_}
\NormalTok{leaf\_indices }\OperatorTok{=}\NormalTok{ model.}\BuiltInTok{apply}\NormalTok{(X)}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees))]}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ np.array\_split(idx\_list, }\DecValTok{1000}\NormalTok{)}

\NormalTok{res\_1 }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{    delayed(calculate\_proximity\_)(}\BuiltInTok{list}\NormalTok{(trees[i] }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ idx), outcome, leaf\_indices[:, idx]) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list[}\DecValTok{0}\NormalTok{:}\BuiltInTok{round}\NormalTok{(}\BuiltInTok{len}\NormalTok{(idx\_list) }\OperatorTok{/} \DecValTok{2}\NormalTok{)])}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}Done first part!\textquotesingle{}}\NormalTok{)}

\NormalTok{res\_2 }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{    delayed(calculate\_proximity\_)(}\BuiltInTok{list}\NormalTok{(trees[i] }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ idx), outcome, leaf\_indices[:, idx]) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list[}\BuiltInTok{round}\NormalTok{(}\BuiltInTok{len}\NormalTok{(idx\_list) }\OperatorTok{/} \DecValTok{2}\NormalTok{):])}
\BuiltInTok{print}\NormalTok{(}\StringTok{\textquotesingle{}Done second part!\textquotesingle{}}\NormalTok{)}

\NormalTok{same\_leaf\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res\_1 }\OperatorTok{+}\NormalTok{ res\_2])}
\NormalTok{same\_oob\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{1}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res\_1 }\OperatorTok{+}\NormalTok{ res\_2])}
\NormalTok{prox\_mat }\OperatorTok{=}\NormalTok{ pd.DataFrame(np.divide(same\_leaf\_mat, same\_oob\_mat, out}\OperatorTok{=}\NormalTok{np.zeros\_like(same\_leaf\_mat),}
\NormalTok{                        where}\OperatorTok{=}\NormalTok{same\_oob\_mat}\OperatorTok{!=}\DecValTok{0}\NormalTok{))}
\NormalTok{prox\_mat.index }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.columns }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.to\_csv(}\StringTok{\textquotesingle{}./other\_data/proximity\_values.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}

\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Calculate proximity with tree filtering}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}

\NormalTok{trees }\OperatorTok{=}\NormalTok{ model.estimators\_}
\NormalTok{leaf\_indices }\OperatorTok{=}\NormalTok{ model.}\BuiltInTok{apply}\NormalTok{(X)}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees)) }\ControlFlowTok{if}\NormalTok{ weights[i] }\OperatorTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{idx\_list }\OperatorTok{=}\NormalTok{ np.array\_split(idx\_list, }\DecValTok{1000}\NormalTok{)}

\NormalTok{res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{    delayed(calculate\_proximity\_)(}\BuiltInTok{list}\NormalTok{(trees[i] }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in}\NormalTok{ idx), outcome, leaf\_indices[:, idx]) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}

\NormalTok{same\_leaf\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{0}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res])}
\NormalTok{same\_oob\_mat }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{([r[}\DecValTok{1}\NormalTok{] }\ControlFlowTok{for}\NormalTok{ r }\KeywordTok{in}\NormalTok{ res])}

\NormalTok{prox\_mat }\OperatorTok{=}\NormalTok{ pd.DataFrame(np.divide(same\_leaf\_mat, same\_oob\_mat, out}\OperatorTok{=}\NormalTok{np.zeros\_like(same\_leaf\_mat), }
\NormalTok{                        where}\OperatorTok{=}\NormalTok{same\_oob\_mat}\OperatorTok{!=}\DecValTok{0}\NormalTok{))}
\NormalTok{prox\_mat.index }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.columns }\OperatorTok{=}\NormalTok{ features.index}
\NormalTok{prox\_mat.to\_csv(}\StringTok{\textquotesingle{}./other\_data/proximity\_values\_tree\_filtering.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{multi-dimensional-scaling}{%
\subsubsection{Multi-dimensional scaling}\label{multi-dimensional-scaling}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Multidimensional scaling}
\NormalTok{prox\_mat }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/proximity\_values\_tree\_filtering.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{cmdscale}\NormalTok{(}\FunctionTok{as.dist}\NormalTok{(}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ prox\_mat), }\AttributeTok{k =} \FunctionTok{ncol}\NormalTok{(prox\_mat) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, }\AttributeTok{eig =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{var\_explained }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{eig }\SpecialCharTok{*} \DecValTok{100} \SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{eig), }\DecValTok{2}\NormalTok{)}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 1 ("}\NormalTok{, var\_explained[}\DecValTok{1}\NormalTok{], }\StringTok{"\%)"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 2 ("}\NormalTok{, var\_explained[}\DecValTok{2}\NormalTok{], }\StringTok{"\%)"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Dimension 3 ("}\NormalTok{, var\_explained[}\DecValTok{3}\NormalTok{], }\StringTok{"\%)"}\NormalTok{))}

\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(mds}\SpecialCharTok{$}\NormalTok{points)}
\FunctionTok{write.csv}\NormalTok{(mds, }\StringTok{"./other\_data/mds\_proximity\_values\_tree\_filtering.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-5}{%
\subsection{Plotting}\label{plotting-5}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(factoextra)}
\FunctionTok{library}\NormalTok{(NbClust)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(ggpubr)}
\FunctionTok{library}\NormalTok{(ggbeeswarm)}
\FunctionTok{library}\NormalTok{(ggforce)}
\FunctionTok{library}\NormalTok{(cluster)}
\FunctionTok{library}\NormalTok{(umap)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_4\_purf\_oob\_predictions.csv"}\NormalTok{)}
\NormalTok{prediction }\OtherTok{\textless{}{-}}\NormalTok{ prediction[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{prediction}\SpecialCharTok{$}\NormalTok{oob\_score\_with\_tree\_filtering), ]}
\NormalTok{top\_200 }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{200}\NormalTok{]}

\NormalTok{mds }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/mds\_proximity\_values\_tree\_filtering.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{mds\_ }\OtherTok{\textless{}{-}}\NormalTok{ mds[}\FunctionTok{rownames}\NormalTok{(mds) }\SpecialCharTok{\%in\%}\NormalTok{ top\_200, ]}
\end{Highlighting}
\end{Shaded}

\hypertarget{clustering-on-candidate-antigens}{%
\subsubsection{Clustering on candidate antigens}\label{clustering-on-candidate-antigens}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Gap statistic}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{gap\_stat }\OtherTok{\textless{}{-}} \FunctionTok{clusGap}\NormalTok{(mds\_, kmeans, }\AttributeTok{nstart =} \DecValTok{100}\NormalTok{, }\AttributeTok{K.max =} \DecValTok{10}\NormalTok{, }\AttributeTok{B =} \DecValTok{100}\NormalTok{, }\AttributeTok{iter.max =} \DecValTok{50}\NormalTok{)}
\NormalTok{p0\_1 }\OtherTok{\textless{}{-}} \FunctionTok{fviz\_gap\_stat}\NormalTok{(gap\_stat, }\AttributeTok{maxSE =} \FunctionTok{list}\NormalTok{(}\AttributeTok{method =} \StringTok{"Tibs2001SEmax"}\NormalTok{, }\AttributeTok{SE.factor =} \DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Gap statistic method"}\NormalTok{)}

\CommentTok{\# Silhouette method}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{p0\_2 }\OtherTok{\textless{}{-}} \FunctionTok{fviz\_nbclust}\NormalTok{(mds\_, kmeans, }\AttributeTok{nstart =} \DecValTok{100}\NormalTok{, }\AttributeTok{method =} \StringTok{"silhouette"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Silhouette method"}\NormalTok{)}

\CommentTok{\# Elbow method}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{p0\_3 }\OtherTok{\textless{}{-}} \FunctionTok{fviz\_nbclust}\NormalTok{(mds\_, kmeans, }\AttributeTok{nstart =} \DecValTok{100}\NormalTok{, }\AttributeTok{method =} \StringTok{"wss"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{3}\NormalTok{, }\AttributeTok{linetype =} \DecValTok{2}\NormalTok{, }\AttributeTok{color =} \StringTok{"steelblue"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Elbow method"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{label }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_antigen\_labels.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{label}\SpecialCharTok{$}\NormalTok{antigen\_label[}\FunctionTok{rownames}\NormalTok{(label) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{)] }\OtherTok{\textless{}{-}} \DecValTok{2}

\CommentTok{\# Clustering}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}
\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{kmeans}\NormalTok{(mds\_, }\DecValTok{3}\NormalTok{, }\AttributeTok{nstart =} \DecValTok{100}\NormalTok{)}\SpecialCharTok{$}\NormalTok{cluster}
\NormalTok{label}\SpecialCharTok{$}\NormalTok{antigen\_label[}\FunctionTok{rownames}\NormalTok{(label) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]] }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{label}\SpecialCharTok{$}\NormalTok{antigen\_label[}\FunctionTok{rownames}\NormalTok{(label) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{2}\NormalTok{]] }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{2}
\NormalTok{label}\SpecialCharTok{$}\NormalTok{antigen\_label[}\FunctionTok{rownames}\NormalTok{(label) }\SpecialCharTok{\%in\%} \FunctionTok{names}\NormalTok{(clusters)[clusters }\SpecialCharTok{==} \DecValTok{3}\NormalTok{]] }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{3}

\NormalTok{protein\_id\_1 }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(label)[label}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{protein\_id\_2 }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(label)[label}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \SpecialCharTok{{-}}\DecValTok{2}\NormalTok{]}
\NormalTok{protein\_id\_3 }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(label)[label}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \SpecialCharTok{{-}}\DecValTok{3}\NormalTok{]}

\FunctionTok{save}\NormalTok{(protein\_id\_1, protein\_id\_2, protein\_id\_3, }\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Save candidate gene accessions for GO enrichment analysis}
\NormalTok{gene\_accession\_1 }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(protein\_id\_1, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[1{-}9]{-}p1"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{gene\_accession\_2 }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(protein\_id\_2, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[1{-}9]{-}p1"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{gene\_accession\_3 }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(protein\_id\_3, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.[1{-}9]{-}p1"}\NormalTok{, }\StringTok{""}\NormalTok{)}

\FunctionTok{write.table}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\StringTok{"acc"} \OtherTok{=}\NormalTok{ gene\_accession\_1),}
  \AttributeTok{sep =} \StringTok{", "}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{col.names =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{file =} \StringTok{"./other\_data/top\_200\_candidates\_gene\_accession\_1.csv"}
\NormalTok{)}
\FunctionTok{write.table}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\StringTok{"acc"} \OtherTok{=}\NormalTok{ gene\_accession\_2),}
  \AttributeTok{sep =} \StringTok{", "}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{col.names =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{file =} \StringTok{"./other\_data/top\_200\_candidates\_gene\_accession\_2.csv"}
\NormalTok{)}
\FunctionTok{write.table}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\StringTok{"acc"} \OtherTok{=}\NormalTok{ gene\_accession\_3),}
  \AttributeTok{sep =} \StringTok{", "}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{col.names =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{file =} \StringTok{"./other\_data/top\_200\_candidates\_gene\_accession\_3.csv"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{22}\NormalTok{)}
\NormalTok{umap\_res }\OtherTok{\textless{}{-}} \FunctionTok{umap}\NormalTok{(mds)}

\NormalTok{umap\_df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(umap\_res}\SpecialCharTok{$}\NormalTok{layout)}
\FunctionTok{rownames}\NormalTok{(umap\_df) }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(mds)}
\NormalTok{umap\_df}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}}\NormalTok{ label}\SpecialCharTok{$}\NormalTok{antigen\_label}
\NormalTok{umap\_df\_subset }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df[umap\_df}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{), ]}
\NormalTok{umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label)}
\NormalTok{umap\_df\_subset }\OtherTok{\textless{}{-}}\NormalTok{ umap\_df\_subset[}\FunctionTok{order}\NormalTok{(umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label), ]}
\NormalTok{umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label\_text }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_subset) }\SpecialCharTok{==} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"CSP"}
\NormalTok{umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_subset) }\SpecialCharTok{==} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"RH5"}
\NormalTok{umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_subset) }\SpecialCharTok{==} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"MSP5"}
\NormalTok{umap\_df\_subset}\SpecialCharTok{$}\NormalTok{label\_text[}\FunctionTok{rownames}\NormalTok{(umap\_df\_subset) }\SpecialCharTok{==} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"P230"}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1\_1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ umap\_df\_subset, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{\textasciigrave{}}\AttributeTok{V1}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{V2}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ label), }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey30"}\NormalTok{) }\SpecialCharTok{+}
  \CommentTok{\# geom\_mark\_ellipse(aes(fill=label, filter=!label \%in\% c(1,2)), size=0, alpha=0.2, expand=unit(1, "mm"), color=\textquotesingle{}grey90\textquotesingle{}) +}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#03a1fc"}\NormalTok{, }\StringTok{"\#984EA3"}\NormalTok{, }\StringTok{"\#FF7F00"}\NormalTok{, }\StringTok{"\#b8ffe0"}\NormalTok{, }\StringTok{"\#ffee00"}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Candidate antigen (Group 1)"}\NormalTok{, }\StringTok{"Candidate antigen (Group 2)"}\NormalTok{, }\StringTok{"Candidate antigen (Group 3)"}\NormalTok{, }\StringTok{"Known antigen"}\NormalTok{, }\StringTok{"Reference antigen"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ label\_text), }\AttributeTok{size =} \FloatTok{3.5}\NormalTok{, }\AttributeTok{nudge\_x =} \SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\AttributeTok{nudge\_y =} \DecValTok{1}\NormalTok{, }\AttributeTok{point.padding =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\FunctionTok{min}\NormalTok{(umap\_df\_subset}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{V1}\StringTok{\textasciigrave{}}\NormalTok{), }\FunctionTok{max}\NormalTok{(umap\_df\_subset}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{V1}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FunctionTok{min}\NormalTok{(umap\_df\_subset}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{V2}\StringTok{\textasciigrave{}}\NormalTok{), }\FunctionTok{max}\NormalTok{(umap\_df\_subset}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{V2}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dimension 1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Dimension 2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{difference-in-scores}{%
\subsubsection{Difference in scores}\label{difference-in-scores}}

Prediction scores of clustering groups before and after tree filtering.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_4\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)[, }\DecValTok{2}\SpecialCharTok{:}\DecValTok{3}\NormalTok{]}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}
\NormalTok{data\_subset }\OtherTok{\textless{}{-}}\NormalTok{ prediction[}\FunctionTok{rownames}\NormalTok{(prediction) }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(protein\_id\_1, protein\_id\_2, protein\_id\_3), ]}
\NormalTok{data\_subset}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{data\_subset}\SpecialCharTok{$}\NormalTok{label[}\FunctionTok{rownames}\NormalTok{(data\_subset) }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_1] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{data\_subset}\SpecialCharTok{$}\NormalTok{label[}\FunctionTok{rownames}\NormalTok{(data\_subset) }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_2] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{data\_subset}\SpecialCharTok{$}\NormalTok{label[}\FunctionTok{rownames}\NormalTok{(data\_subset) }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_3] }\OtherTok{\textless{}{-}} \StringTok{"Group 3"}
\NormalTok{data\_subset}\SpecialCharTok{$}\NormalTok{label }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(data\_subset}\SpecialCharTok{$}\NormalTok{label)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{) \{}
\NormalTok{  ds\_ }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(data\_subset[data\_subset}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Group "}\NormalTok{, i), ])}
\NormalTok{  ds\_}\SpecialCharTok{$}\NormalTok{paired }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(ds\_) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{), }\DecValTok{2}\NormalTok{)}
\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{compare\_means}\NormalTok{(value }\SpecialCharTok{\textasciitilde{}}\NormalTok{ variable, }\AttributeTok{data =}\NormalTok{ ds\_, }\AttributeTok{method =} \StringTok{"wilcox.test"}\NormalTok{, }\AttributeTok{paired =} \ConstantTok{TRUE}\NormalTok{)}\SpecialCharTok{$}\NormalTok{p)}
\NormalTok{  ds }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(ds, ds\_)}
\NormalTok{\}}
\NormalTok{adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}

\NormalTok{p2\_1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ ds[[}\DecValTok{1}\NormalTok{]], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ variable), }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{group =}\NormalTok{ paired), }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_beeswarm}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ variable),}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{cex =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{priority =} \StringTok{"random"}\NormalTok{,}
    \AttributeTok{shape =} \DecValTok{21}
\NormalTok{  ) }\SpecialCharTok{+}
  \CommentTok{\# annotate("segment", x=1, xend=2, y=0.991, yend=0.991, colour="black") +}
  \CommentTok{\# annotate("segment", x=1, xend=1, y=0.991, yend=0.989, colour="black") +}
  \CommentTok{\# annotate("segment", x=2, xend=2, y=0.991, yend=0.989, colour="black") +}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{y =} \FloatTok{0.994}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(adj\_pval[}\DecValTok{1}\NormalTok{], }\DecValTok{3}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#f7d59e"}\NormalTok{, }\StringTok{"\#fcd7d7"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#fc9d03"}\NormalTok{, }\StringTok{"red"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{30}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Score (proportion of votes)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FloatTok{0.935}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{)}

\NormalTok{p2\_2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ ds[[}\DecValTok{2}\NormalTok{]], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ variable), }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{group =}\NormalTok{ paired), }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_beeswarm}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ variable),}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{cex =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{priority =} \StringTok{"random"}\NormalTok{,}
    \AttributeTok{shape =} \DecValTok{21}
\NormalTok{  ) }\SpecialCharTok{+}
  \CommentTok{\# annotate("segment", x=1, xend=2, y=0.997, yend=0.997, colour="black") +}
  \CommentTok{\# annotate("segment", x=1, xend=1, y=0.997, yend=0.995, colour="black") +}
  \CommentTok{\# annotate("segment", x=2, xend=2, y=0.997, yend=0.995, colour="black") +}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(adj\_pval[}\DecValTok{2}\NormalTok{], }\DecValTok{3}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#f7d59e"}\NormalTok{, }\StringTok{"\#fcd7d7"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#fc9d03"}\NormalTok{, }\StringTok{"red"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{30}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FloatTok{0.935}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 2"}\NormalTok{)}

\NormalTok{p2\_3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ ds[[}\DecValTok{3}\NormalTok{]], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ variable), }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{group =}\NormalTok{ paired), }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_beeswarm}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ variable),}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{cex =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{priority =} \StringTok{"random"}\NormalTok{,}
    \AttributeTok{shape =} \DecValTok{21}
\NormalTok{  ) }\SpecialCharTok{+}
  \CommentTok{\# annotate("segment", x=1, xend=2, y=0.997, yend=0.997, colour="black") +}
  \CommentTok{\# annotate("segment", x=1, xend=1, y=0.997, yend=0.995, colour="black") +}
  \CommentTok{\# annotate("segment", x=2, xend=2, y=0.997, yend=0.995, colour="black") +}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{y =} \DecValTok{1}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(adj\_pval[}\DecValTok{3}\NormalTok{], }\DecValTok{3}\NormalTok{))) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#f7d59e"}\NormalTok{, }\StringTok{"\#fcd7d7"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#fc9d03"}\NormalTok{, }\StringTok{"red"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"oob\_score\_without\_tree\_filtering"}\NormalTok{,}
      \StringTok{"oob\_score\_with\_tree\_filtering"}
\NormalTok{    ),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{30}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\FloatTok{0.935}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# p\_1 = plot\_grid(p1\_1, legend\_1, p1\_2, p1\_3, nrow=2, rel\_widths=c(0.5, 0.5))}
\NormalTok{p\_2 }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p2\_1, p2\_2, p2\_3, }\ConstantTok{NULL}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.28}\NormalTok{, }\FloatTok{0.25}\NormalTok{, }\FloatTok{0.25}\NormalTok{, }\FloatTok{0.03}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}\AttributeTok{file =} \StringTok{"./figures/Fig 4.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{3500}\NormalTok{, }\AttributeTok{height =} \DecValTok{2200}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p1\_1)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../figures/Fig 4.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \FloatTok{4.4}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p1\_1)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{png}\NormalTok{(}\AttributeTok{file =} \StringTok{"./figures/Supplementary Fig 8.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{6000}\NormalTok{, }\AttributeTok{height =} \DecValTok{4000}\NormalTok{, }\AttributeTok{res =} \DecValTok{600}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p\_2)}
\FunctionTok{dev.off}\NormalTok{()}

\FunctionTok{pdf}\NormalTok{(}\AttributeTok{file =} \StringTok{"../supplementary\_figures/Supplementary Fig 8.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{8}\NormalTok{)}
\FunctionTok{print}\NormalTok{(p\_2)}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 4} \end{center}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 8} \end{center}

\hypertarget{comparison-of-the-candidate-clustering-groups}{%
\section{Comparison of the candidate clustering groups}\label{comparison-of-the-candidate-clustering-groups}}

Comparisons of clustering groups before and after tree filtering in terms of distances to reference antigens and predictions scores.

\hypertarget{plotting-6}{%
\subsection{Plotting}\label{plotting-6}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggbeeswarm)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(ggpubr)}
\FunctionTok{library}\NormalTok{(rlist)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prox\_wo\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/proximity\_values.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{prox\_w\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/proximity\_values\_tree\_filtering.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(prox\_wo\_tree\_filtering) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(prox\_wo\_tree\_filtering)}
\FunctionTok{rownames}\NormalTok{(prox\_w\_tree\_filtering) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(prox\_w\_tree\_filtering)}
\NormalTok{dist\_wo\_tree\_filtering }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ prox\_wo\_tree\_filtering}
\NormalTok{dist\_w\_tree\_filtering }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ prox\_w\_tree\_filtering}
\NormalTok{diff\_dist }\OtherTok{\textless{}{-}}\NormalTok{ dist\_w\_tree\_filtering }\SpecialCharTok{{-}}\NormalTok{ dist\_wo\_tree\_filtering}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# CSP, RH5, MSP5, P230}
\NormalTok{ref }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{)}
\NormalTok{dist\_wo\_tree\_filtering[ref, ref]}
\NormalTok{dist\_w\_tree\_filtering[ref, ref]}
\NormalTok{diff\_dist[ref, ref]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plot\_boxplots }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(protein\_id, protein\_name, ylim1, ylim2) \{}
\NormalTok{  dist\_0 }\OtherTok{\textless{}{-}}\NormalTok{ dist\_wo\_tree\_filtering[}\FunctionTok{c}\NormalTok{(protein\_id\_1, protein\_id\_2, protein\_id\_3), protein\_id]}
\NormalTok{  dist\_1 }\OtherTok{\textless{}{-}}\NormalTok{ dist\_w\_tree\_filtering[}\FunctionTok{c}\NormalTok{(protein\_id\_1, protein\_id\_2, protein\_id\_3), protein\_id]}
\NormalTok{  dist\_smry }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{label =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
      \FunctionTok{rep}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\FunctionTok{length}\NormalTok{(protein\_id\_1)),}
      \FunctionTok{rep}\NormalTok{(}\StringTok{"Group 2"}\NormalTok{, }\FunctionTok{length}\NormalTok{(protein\_id\_2)),}
      \FunctionTok{rep}\NormalTok{(}\StringTok{"Group 3"}\NormalTok{, }\FunctionTok{length}\NormalTok{(protein\_id\_3))}
\NormalTok{    )),}
    \AttributeTok{value =} \FunctionTok{c}\NormalTok{(dist\_0, dist\_1),}
    \AttributeTok{variable =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{length}\NormalTok{(dist\_0)), }\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(dist\_1))))}
\NormalTok{  )}

\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\NormalTok{  ds }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{) \{}
\NormalTok{    ds\_ }\OtherTok{\textless{}{-}}\NormalTok{ dist\_smry[dist\_smry}\SpecialCharTok{$}\NormalTok{label }\SpecialCharTok{==} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Group "}\NormalTok{, i), ]}
\NormalTok{    ds\_}\SpecialCharTok{$}\NormalTok{paired }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(ds\_) }\SpecialCharTok{/} \DecValTok{2}\NormalTok{), }\DecValTok{2}\NormalTok{)}
\NormalTok{    pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{compare\_means}\NormalTok{(value }\SpecialCharTok{\textasciitilde{}}\NormalTok{ variable,}
      \AttributeTok{data =}\NormalTok{ ds\_, }\AttributeTok{method =} \StringTok{"wilcox.test"}\NormalTok{,}
      \AttributeTok{paired =} \ConstantTok{TRUE}
\NormalTok{    )}\SpecialCharTok{$}\NormalTok{p)}
\NormalTok{    ds }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(ds, ds\_)}
\NormalTok{  \}}
\NormalTok{  adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}

\NormalTok{  plots }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{) \{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ ds[[i]], }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =}\NormalTok{ value)) }\SpecialCharTok{+}
      \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey60"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ variable), }\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{group =}\NormalTok{ paired), }\AttributeTok{alpha =} \FloatTok{0.6}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_beeswarm}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ variable),}
        \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{, }\AttributeTok{cex =} \DecValTok{2}\NormalTok{,}
        \AttributeTok{priority =} \StringTok{"random"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}
\NormalTok{      ) }\SpecialCharTok{+}
      \CommentTok{\# annotate("segment", x=1, xend=2, y=max(ds[[i]]$value) + 0.04, yend=max(ds[[i]]$value) + 0.04,}
      \CommentTok{\#          colour="black") +}
      \CommentTok{\# annotate("segment", x=1, xend=1, y=max(ds[[i]]$value) + 0.04, yend=max(ds[[i]]$value) + 0.03,}
      \CommentTok{\#          colour="black") +}
      \CommentTok{\# annotate("segment", x=2, xend=2, y=max(ds[[i]]$value) + 0.04, yend=max(ds[[i]]$value) + 0.03,}
      \CommentTok{\#          colour="black") +}
\NormalTok{      \{}
        \ControlFlowTok{if}\NormalTok{ (adj\_pval[i] }\SpecialCharTok{\textgreater{}=} \FloatTok{1e{-}3}\NormalTok{) \{}
          \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}
            \AttributeTok{x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds[[i]]}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.06}\NormalTok{,}
            \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, }\FunctionTok{round}\NormalTok{(adj\_pval[i], }\DecValTok{3}\NormalTok{))}
\NormalTok{          )}
\NormalTok{        \} }\ControlFlowTok{else}\NormalTok{ \{}
          \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}
            \AttributeTok{x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds[[i]]}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.06}\NormalTok{,}
            \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, }\FunctionTok{formatC}\NormalTok{(adj\_pval[i], }\AttributeTok{format =} \StringTok{"e"}\NormalTok{, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{))}
\NormalTok{          )}
\NormalTok{        \}}
\NormalTok{      \} }\SpecialCharTok{+}
      \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#f7d59e"}\NormalTok{, }\StringTok{"\#fcd7d7"}\NormalTok{)) }\SpecialCharTok{+}
      \FunctionTok{scale\_fill\_manual}\NormalTok{(}
        \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#fc9d03"}\NormalTok{, }\StringTok{"red"}\NormalTok{),}
        \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)}
\NormalTok{      ) }\SpecialCharTok{+}
      \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Without tree filtering"}\NormalTok{, }\StringTok{"With tree filtering"}\NormalTok{)) }\SpecialCharTok{+}
      \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{      \{}
        \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
          \FunctionTok{theme}\NormalTok{(}
            \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{25}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
            \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
            \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{8}\NormalTok{),}
            \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
            \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
            \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
            \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{          )}
\NormalTok{        \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) \{}
          \FunctionTok{theme}\NormalTok{(}
            \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
            \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
            \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{8}\NormalTok{),}
            \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
            \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
            \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{          )}
\NormalTok{        \} }\ControlFlowTok{else}\NormalTok{ \{}
          \FunctionTok{theme}\NormalTok{(}
            \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
            \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
            \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \DecValTok{8}\NormalTok{),}
            \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
            \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{(),}
            \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
            \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{          )}
\NormalTok{        \}}
\NormalTok{      \} }\SpecialCharTok{+}
      \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{      \{}
        \ControlFlowTok{if}\NormalTok{ (i }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
          \FunctionTok{ylab}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Euclidean distance to "}\NormalTok{, protein\_name))}
\NormalTok{        \} }\ControlFlowTok{else}\NormalTok{ \{}
          \FunctionTok{ylab}\NormalTok{(}\StringTok{""}\NormalTok{)}
\NormalTok{        \}}
\NormalTok{      \} }\SpecialCharTok{+}
      \FunctionTok{ylim}\NormalTok{(ylim1) }\SpecialCharTok{+}
      \FunctionTok{ggtitle}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Group "}\NormalTok{, i))}
\NormalTok{    plots }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plots, p)}
\NormalTok{  \}}

  \CommentTok{\# Plot difference}
\NormalTok{  diff\_grps }\OtherTok{\textless{}{-}}\NormalTok{ diff\_dist[}\FunctionTok{c}\NormalTok{(protein\_id\_1, protein\_id\_2, protein\_id\_3), protein\_id]}
\NormalTok{  ds }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{value =} \FunctionTok{c}\NormalTok{(diff\_grps),}
    \AttributeTok{group =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
      \FunctionTok{rep}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\FunctionTok{length}\NormalTok{(protein\_id\_1)),}
      \FunctionTok{rep}\NormalTok{(}\StringTok{"Group 2"}\NormalTok{, }\FunctionTok{length}\NormalTok{(protein\_id\_2)),}
      \FunctionTok{rep}\NormalTok{(}\StringTok{"Group 3"}\NormalTok{, }\FunctionTok{length}\NormalTok{(protein\_id\_3))}
\NormalTok{    ))}
\NormalTok{  )}

\NormalTok{  stats }\OtherTok{\textless{}{-}} \FunctionTok{compare\_means}\NormalTok{(value }\SpecialCharTok{\textasciitilde{}}\NormalTok{ group, }\AttributeTok{data =}\NormalTok{ ds, }\AttributeTok{method =} \StringTok{"wilcox.test"}\NormalTok{, }\AttributeTok{p.adjust.method =} \StringTok{"BH"}\NormalTok{)}

\NormalTok{  p }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ ds, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ group, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ group)) }\SpecialCharTok{+}
    \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"dashed"}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outlier.colour =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{geom\_beeswarm}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ group),}
      \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{cex =} \FloatTok{1.5}\NormalTok{,}
      \AttributeTok{priority =} \StringTok{"random"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}
\NormalTok{    ) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.95}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{xend =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.002}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.95}\NormalTok{, }\AttributeTok{xend =} \FloatTok{1.95}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.002}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \FloatTok{1.5}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.007}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, stats}\SpecialCharTok{$}\NormalTok{p.adj[}\DecValTok{1}\NormalTok{])) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{xend =} \DecValTok{3}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.01}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.01}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{xend =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.008}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.01}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \DecValTok{3}\NormalTok{, }\AttributeTok{xend =} \DecValTok{3}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.008}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.01}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \DecValTok{2}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.013}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, stats}\SpecialCharTok{$}\NormalTok{p.adj[}\DecValTok{2}\NormalTok{])) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{2.05}\NormalTok{, }\AttributeTok{xend =} \DecValTok{3}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \FloatTok{2.05}\NormalTok{, }\AttributeTok{xend =} \FloatTok{2.05}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.002}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"segment"}\NormalTok{, }\AttributeTok{x =} \DecValTok{3}\NormalTok{, }\AttributeTok{xend =} \DecValTok{3}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.002}\NormalTok{, }\AttributeTok{yend =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.004}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\AttributeTok{x =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{y =} \FunctionTok{max}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{value) }\SpecialCharTok{+} \FloatTok{0.007}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"p = "}\NormalTok{, stats}\SpecialCharTok{$}\NormalTok{p.adj[}\DecValTok{3}\NormalTok{])) }\SpecialCharTok{+}
    \FunctionTok{scale\_fill\_manual}\NormalTok{(}
      \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"Group 1"}\NormalTok{, }\StringTok{"Group 2"}\NormalTok{, }\StringTok{"Group 3"}\NormalTok{),}
      \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#03a1fc"}\NormalTok{, }\StringTok{"\#984EA3"}\NormalTok{, }\StringTok{"\#FF7F00"}\NormalTok{),}
      \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
        \StringTok{"Candidate antigen (Group 1)"}\NormalTok{,}
        \StringTok{"Candidate antigen (Group 2)"}\NormalTok{,}
        \StringTok{"Candidate antigen (Group 3)"}
\NormalTok{      )}
\NormalTok{    ) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{theme}\NormalTok{(}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
      \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{38}\NormalTok{, }\DecValTok{15}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
      \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
      \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
      \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
      \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{    ) }\SpecialCharTok{+}
    \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{ylab}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Difference in distances to "}\NormalTok{, protein\_name)) }\SpecialCharTok{+}
    \FunctionTok{ylim}\NormalTok{(ylim2) }\SpecialCharTok{+}
    \FunctionTok{ggtitle}\NormalTok{(}\StringTok{""}\NormalTok{)}

\NormalTok{  plots }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(plots, p)}

  \FunctionTok{return}\NormalTok{(plots)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{ggdraw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{draw\_label}\NormalTok{(}\StringTok{"CSP (circumsporozoite protein); pre{-}erythrocytic stage"}\NormalTok{),}
  \FunctionTok{plot\_grid}\NormalTok{(}
    \AttributeTok{plotlist =} \FunctionTok{plot\_boxplots}\NormalTok{(}
      \AttributeTok{protein\_id =} \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\AttributeTok{protein\_name =} \StringTok{"CSP"}\NormalTok{,}
      \AttributeTok{ylim1 =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.15}\NormalTok{, }\FloatTok{0.7}\NormalTok{), }\AttributeTok{ylim2 =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.03}\NormalTok{, }\FloatTok{0.04}\NormalTok{)}
\NormalTok{    ),}
    \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.29}\NormalTok{, }\FloatTok{0.22}\NormalTok{, }\FloatTok{0.23}\NormalTok{, }\FloatTok{0.48}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{)}
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{ggdraw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{draw\_label}\NormalTok{(}\StringTok{"RH5 (reticulocyte binding protein homologue 5); erythrocytic stage"}\NormalTok{),}
  \FunctionTok{plot\_grid}\NormalTok{(}
    \AttributeTok{plotlist =} \FunctionTok{plot\_boxplots}\NormalTok{(}
      \AttributeTok{protein\_id =} \StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{, }\AttributeTok{protein\_name =} \StringTok{"RH5"}\NormalTok{,}
      \AttributeTok{ylim1 =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.15}\NormalTok{, }\FloatTok{0.7}\NormalTok{), }\AttributeTok{ylim2 =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.03}\NormalTok{, }\FloatTok{0.04}\NormalTok{)}
\NormalTok{    ),}
    \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.29}\NormalTok{, }\FloatTok{0.22}\NormalTok{, }\FloatTok{0.23}\NormalTok{, }\FloatTok{0.48}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"b"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{)}
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{ggdraw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{draw\_label}\NormalTok{(}\StringTok{"MSP5 (merozoite surface protein 5); erythrocytic stage"}\NormalTok{),}
  \FunctionTok{plot\_grid}\NormalTok{(}
    \AttributeTok{plotlist =} \FunctionTok{plot\_boxplots}\NormalTok{(}
      \AttributeTok{protein\_id =} \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\AttributeTok{protein\_name =} \StringTok{"MSP5"}\NormalTok{,}
      \AttributeTok{ylim1 =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.15}\NormalTok{, }\FloatTok{0.7}\NormalTok{), }\AttributeTok{ylim2 =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.03}\NormalTok{, }\FloatTok{0.04}\NormalTok{)}
\NormalTok{    ),}
    \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.29}\NormalTok{, }\FloatTok{0.22}\NormalTok{, }\FloatTok{0.23}\NormalTok{, }\FloatTok{0.48}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{)}
\NormalTok{p4 }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{ggdraw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{draw\_label}\NormalTok{(}\StringTok{"P230 (6{-}cysteine protein); gametocyte stage"}\NormalTok{),}
  \FunctionTok{plot\_grid}\NormalTok{(}
    \AttributeTok{plotlist =} \FunctionTok{plot\_boxplots}\NormalTok{(}
      \AttributeTok{protein\_id =} \StringTok{"PF3D7\_0209000.1{-}p1"}\NormalTok{, }\AttributeTok{protein\_name =} \StringTok{"P230"}\NormalTok{,}
      \AttributeTok{ylim1 =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.15}\NormalTok{, }\FloatTok{0.7}\NormalTok{), }\AttributeTok{ylim2 =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.03}\NormalTok{, }\FloatTok{0.04}\NormalTok{)}
\NormalTok{    ),}
    \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.29}\NormalTok{, }\FloatTok{0.22}\NormalTok{, }\FloatTok{0.23}\NormalTok{, }\FloatTok{0.48}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"d"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1, p2, p3, p4, }\AttributeTok{nrow =} \DecValTok{2}\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 9} \end{center}

\hypertarget{important-variables-for-candidate-clustering-groups}{%
\section{Important variables for candidate clustering groups}\label{important-variables-for-candidate-clustering-groups}}

Wilcox test to compare variable values in candidate groups and randomly selected proteins.

\hypertarget{analysis-6}{%
\subsection{Analysis}\label{analysis-6}}

Permutation-based variable importance of candidate antigen groups.

\hypertarget{variable-importance-2}{%
\subsubsection{Variable importance}\label{variable-importance-2}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_ml\_input\_processed\_weighted.csv"}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}

\NormalTok{data\_1 }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{data\_1}\SpecialCharTok{$}\NormalTok{antigen\_label }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{data\_1}\SpecialCharTok{$}\NormalTok{antigen\_label[data\_1}\SpecialCharTok{$}\NormalTok{X }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_1] }\OtherTok{\textless{}{-}} \DecValTok{1}
\FunctionTok{write.csv}\NormalTok{(data\_1, }\StringTok{"./other\_data/pf\_ml\_input\_processed\_weighted\_group\_1.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{data\_2 }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{data\_2}\SpecialCharTok{$}\NormalTok{antigen\_label }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{data\_2}\SpecialCharTok{$}\NormalTok{antigen\_label[data\_2}\SpecialCharTok{$}\NormalTok{X }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_2] }\OtherTok{\textless{}{-}} \DecValTok{1}
\FunctionTok{write.csv}\NormalTok{(data\_2, }\StringTok{"./other\_data/pf\_ml\_input\_processed\_weighted\_group\_2.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{data\_3 }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{data\_3}\SpecialCharTok{$}\NormalTok{antigen\_label }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{data\_3}\SpecialCharTok{$}\NormalTok{antigen\_label[data\_3}\SpecialCharTok{$}\NormalTok{X }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_3] }\OtherTok{\textless{}{-}} \DecValTok{1}
\FunctionTok{write.csv}\NormalTok{(data\_3, }\StringTok{"./other\_data/pf\_ml\_input\_processed\_weighted\_group\_3.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{In Python: }

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ numpy }\ImportTok{as}\NormalTok{ np}
\ImportTok{import}\NormalTok{ pickle}
\ImportTok{from}\NormalTok{ sklearn.impute }\ImportTok{import}\NormalTok{ SimpleImputer}
\ImportTok{from}\NormalTok{ sklearn.preprocessing }\ImportTok{import}\NormalTok{ MinMaxScaler}
\ImportTok{from}\NormalTok{ scipy.spatial }\ImportTok{import}\NormalTok{ distance}
\ImportTok{import}\NormalTok{ multiprocessing}
\ImportTok{from}\NormalTok{ joblib }\ImportTok{import}\NormalTok{ Parallel, delayed}
\NormalTok{num\_cores }\OperatorTok{=}\NormalTok{ multiprocessing.cpu\_count()}
\ImportTok{from}\NormalTok{ sklearn.ensemble.\_forest }\ImportTok{import}\NormalTok{ \_generate\_unsampled\_indices}
\ImportTok{import}\NormalTok{ session\_info}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_1 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pf\_ml\_input\_processed\_weighted\_group\_1.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pf3d7\_features\_processed\_1 }\OperatorTok{=}\NormalTok{ data\_1.iloc[:,}\DecValTok{1}\NormalTok{:].}\BuiltInTok{apply}\NormalTok{(pd.to\_numeric, downcast}\OperatorTok{=}\StringTok{\textquotesingle{}float\textquotesingle{}}\NormalTok{)}
\NormalTok{pf3d7\_outcome\_1 }\OperatorTok{=}\NormalTok{ np.array(data\_1.antigen\_label)}

\NormalTok{data\_2 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pf\_ml\_input\_processed\_weighted\_group\_2.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pf3d7\_features\_processed\_2 }\OperatorTok{=}\NormalTok{ data\_2.iloc[:,}\DecValTok{1}\NormalTok{:].}\BuiltInTok{apply}\NormalTok{(pd.to\_numeric, downcast}\OperatorTok{=}\StringTok{\textquotesingle{}float\textquotesingle{}}\NormalTok{)}
\NormalTok{pf3d7\_outcome\_2 }\OperatorTok{=}\NormalTok{ np.array(data\_2.antigen\_label)}

\NormalTok{data\_3 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./other\_data/pf\_ml\_input\_processed\_weighted\_group\_3.csv\textquotesingle{}}\NormalTok{, index\_col}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{pf3d7\_features\_processed\_3 }\OperatorTok{=}\NormalTok{ data\_3.iloc[:,}\DecValTok{1}\NormalTok{:].}\BuiltInTok{apply}\NormalTok{(pd.to\_numeric, downcast}\OperatorTok{=}\StringTok{\textquotesingle{}float\textquotesingle{}}\NormalTok{)}
\NormalTok{pf3d7\_outcome\_3 }\OperatorTok{=}\NormalTok{ np.array(data\_3.antigen\_label)}

\NormalTok{purf\_model }\OperatorTok{=}\NormalTok{ pickle.load(}\BuiltInTok{open}\NormalTok{(}\StringTok{\textquotesingle{}./pickle\_data/pf\_purf\_tree\_filtering.pkl\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}rb\textquotesingle{}}\NormalTok{))}
\NormalTok{purf }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}model\textquotesingle{}}\NormalTok{]}
\NormalTok{weights }\OperatorTok{=}\NormalTok{ purf\_model[}\StringTok{\textquotesingle{}weights\textquotesingle{}}\NormalTok{]}

\NormalTok{metadata }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}./data/supplementary\_data\_2\_pf\_protein\_variable\_metadata.csv\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{def}\NormalTok{ calculate\_raw\_var\_imp\_(idx, tree, X, y, weight, groups}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{    rng }\OperatorTok{=}\NormalTok{ np.random.RandomState(idx)}
\NormalTok{    oob\_indices }\OperatorTok{=}\NormalTok{ \_generate\_unsampled\_indices(tree.random\_state, y.shape[}\DecValTok{0}\NormalTok{], y.shape[}\DecValTok{0}\NormalTok{])}
\NormalTok{    oob\_pos }\OperatorTok{=}\NormalTok{ np.intersect1d(oob\_indices, np.where(y }\OperatorTok{==} \DecValTok{1}\NormalTok{)[}\DecValTok{0}\NormalTok{])}
\NormalTok{    noutall }\OperatorTok{=} \BuiltInTok{len}\NormalTok{(oob\_pos)}
\NormalTok{    pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X.iloc[oob\_pos,:])[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{    nrightall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{    imprt, impsd }\OperatorTok{=}\NormalTok{ [], []}
    \ControlFlowTok{if}\NormalTok{ groups }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
        \ControlFlowTok{for}\NormalTok{ var }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(X.shape[}\DecValTok{1}\NormalTok{]):}
\NormalTok{            X\_temp }\OperatorTok{=}\NormalTok{ X.copy().iloc[oob\_pos,:]}
\NormalTok{            X\_temp.iloc[:, var] }\OperatorTok{=}\NormalTok{ rng.permutation(X\_temp.iloc[:, var])}
\NormalTok{            pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X\_temp)[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{            nrightimpall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{            delta }\OperatorTok{=}\NormalTok{ (nrightall }\OperatorTok{{-}}\NormalTok{ nrightimpall) }\OperatorTok{/}\NormalTok{ noutall }\OperatorTok{*}\NormalTok{ weight}
\NormalTok{            imprt.append(delta)}
\NormalTok{            impsd.append(delta }\OperatorTok{*}\NormalTok{ delta)}
    \ControlFlowTok{else}\NormalTok{:}
        \ControlFlowTok{for}\NormalTok{ grp }\KeywordTok{in}\NormalTok{ np.unique(groups):}
\NormalTok{            X\_temp }\OperatorTok{=}\NormalTok{ X.copy().iloc[oob\_pos,:]}
\NormalTok{            X\_temp.iloc[:, groups }\OperatorTok{==}\NormalTok{ grp] }\OperatorTok{=}\NormalTok{ rng.permutation(X\_temp.iloc[:, groups }\OperatorTok{==}\NormalTok{ grp])}
\NormalTok{            pred }\OperatorTok{=}\NormalTok{ tree.predict\_proba(X\_temp)[:, }\DecValTok{1}\NormalTok{]}
\NormalTok{            nrightimpall }\OperatorTok{=} \BuiltInTok{sum}\NormalTok{(pred }\OperatorTok{==}\NormalTok{ y[oob\_pos])}
\NormalTok{            delta }\OperatorTok{=}\NormalTok{ (nrightall }\OperatorTok{{-}}\NormalTok{ nrightimpall) }\OperatorTok{/}\NormalTok{ noutall }\OperatorTok{*}\NormalTok{ weight}
\NormalTok{            imprt.append(delta)}
\NormalTok{            impsd.append(delta }\OperatorTok{*}\NormalTok{ delta)}
    \ControlFlowTok{return}\NormalTok{ (imprt, impsd)}
  
\KeywordTok{def}\NormalTok{ calculate\_var\_imp(model, features, outcome, num\_cores, weights}\OperatorTok{=}\VariableTok{None}\NormalTok{, groups}\OperatorTok{=}\VariableTok{None}\NormalTok{):}
\NormalTok{    trees }\OperatorTok{=}\NormalTok{ model.estimators\_}
\NormalTok{    idx\_list }\OperatorTok{=}\NormalTok{ [i }\ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(trees))]}
    \ControlFlowTok{if}\NormalTok{ weights }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        weights }\OperatorTok{=}\NormalTok{ np.ones(}\BuiltInTok{len}\NormalTok{(trees))}
\NormalTok{    res }\OperatorTok{=}\NormalTok{ Parallel(n\_jobs}\OperatorTok{=}\NormalTok{num\_cores)(}
\NormalTok{      delayed(calculate\_raw\_var\_imp\_)(idx, trees[idx], features, outcome, weights[idx], groups) }\ControlFlowTok{for}\NormalTok{ idx }\KeywordTok{in}\NormalTok{ idx\_list)}
\NormalTok{    imprt, impsd }\OperatorTok{=}\NormalTok{ [], []}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(idx\_list)):}
\NormalTok{        imprt.append(res[i][}\DecValTok{0}\NormalTok{])}
\NormalTok{        impsd.append(res[i][}\DecValTok{1}\NormalTok{])}
\NormalTok{    imprt }\OperatorTok{=}\NormalTok{ np.array(imprt).}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    impsd }\OperatorTok{=}\NormalTok{ np.array(impsd).}\BuiltInTok{sum}\NormalTok{(axis}\OperatorTok{=}\DecValTok{0}\NormalTok{)}
\NormalTok{    imprt }\OperatorTok{/=} \BuiltInTok{len}\NormalTok{(idx\_list)}
\NormalTok{    impsd }\OperatorTok{=}\NormalTok{ np.sqrt(((impsd }\OperatorTok{/} \BuiltInTok{len}\NormalTok{(idx\_list)) }\OperatorTok{{-}}\NormalTok{ imprt }\OperatorTok{*}\NormalTok{ imprt) }\OperatorTok{/} \BuiltInTok{len}\NormalTok{(idx\_list))}
\NormalTok{    mda }\OperatorTok{=}\NormalTok{ []}
    \ControlFlowTok{for}\NormalTok{ i }\KeywordTok{in} \BuiltInTok{range}\NormalTok{(}\BuiltInTok{len}\NormalTok{(imprt)):}
        \ControlFlowTok{if}\NormalTok{ impsd[i] }\OperatorTok{!=} \DecValTok{0}\NormalTok{:}
\NormalTok{            mda.append(imprt[i] }\OperatorTok{/}\NormalTok{ impsd[i])}
        \ControlFlowTok{else}\NormalTok{:}
\NormalTok{            mda.append(imprt[i])}
    \ControlFlowTok{if}\NormalTok{ groups }\KeywordTok{is} \VariableTok{None}\NormalTok{:}
\NormalTok{        var\_imp }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{: features.columns, }\StringTok{\textquotesingle{}meanDecreaseAccuracy\textquotesingle{}}\NormalTok{: mda\})}
    \ControlFlowTok{else}\NormalTok{: }
\NormalTok{        var\_imp }\OperatorTok{=}\NormalTok{ pd.DataFrame(\{}\StringTok{\textquotesingle{}variable\textquotesingle{}}\NormalTok{: np.unique(groups), }\StringTok{\textquotesingle{}meanDecreaseAccuracy\textquotesingle{}}\NormalTok{: mda\})}
    \ControlFlowTok{return}\NormalTok{ var\_imp}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{var\_imp\_1 }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, pf3d7\_features\_processed\_1, pf3d7\_outcome\_1, num\_cores, weights)}
\NormalTok{var\_imp\_1.to\_csv(}\StringTok{\textquotesingle{}./other\_data/candidate\_variable\_importance\_1.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}

\NormalTok{var\_imp\_2 }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, pf3d7\_features\_processed\_2, pf3d7\_outcome\_2, num\_cores, weights)}
\NormalTok{var\_imp\_2.to\_csv(}\StringTok{\textquotesingle{}./other\_data/candidate\_variable\_importance\_2.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}

\NormalTok{var\_imp\_3 }\OperatorTok{=}\NormalTok{ calculate\_var\_imp(purf, pf3d7\_features\_processed\_3, pf3d7\_outcome\_3, num\_cores, weights)}
\NormalTok{var\_imp\_3.to\_csv(}\StringTok{\textquotesingle{}./other\_data/candidate\_variable\_importance\_3.csv\textquotesingle{}}\NormalTok{, index}\OperatorTok{=}\VariableTok{False}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{wilcoxon-test-2}{%
\subsubsection{Wilcoxon test}\label{wilcoxon-test-2}}

Variable value comparison between candidate antigens and other random proteins predicted as negative.

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_4\_purf\_oob\_predictions.csv"}\NormalTok{)}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}
\NormalTok{other\_proteins }\OtherTok{\textless{}{-}}\NormalTok{ prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ prediction}\SpecialCharTok{$}\NormalTok{oob\_score\_with\_tree\_filtering }\SpecialCharTok{\textless{}} \FloatTok{0.5}\NormalTok{, ]}\SpecialCharTok{$}\NormalTok{protein\_id}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{22}\NormalTok{)}
\NormalTok{random\_protein\_1 }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(other\_proteins, }\AttributeTok{size =} \FunctionTok{length}\NormalTok{(protein\_id\_1), }\AttributeTok{replace =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{random\_protein\_2 }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(other\_proteins, }\AttributeTok{size =} \FunctionTok{length}\NormalTok{(protein\_id\_2), }\AttributeTok{replace =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{random\_protein\_3 }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(other\_proteins, }\AttributeTok{size =} \FunctionTok{length}\NormalTok{(protein\_id\_3), }\AttributeTok{replace =} \ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\# Load imputed data}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_ml\_input\_processed\_weighted.csv"}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[}\SpecialCharTok{!}\FunctionTok{duplicated}\NormalTok{(data), ]}
\NormalTok{compared\_group\_1 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{X, }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_1) }\DecValTok{1} \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ random\_protein\_1) }\DecValTok{0} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{compared\_group\_2 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{X, }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_2) }\DecValTok{1} \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ random\_protein\_2) }\DecValTok{0} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{compared\_group\_3 }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{X, }\ControlFlowTok{function}\NormalTok{(x) }\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_3) }\DecValTok{1} \ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%in\%}\NormalTok{ random\_protein\_3) }\DecValTok{0} \ControlFlowTok{else} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[, }\DecValTok{3}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)]}

\CommentTok{\# Min{-}max normalization}
\NormalTok{min\_max }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  (x }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x)) }\SpecialCharTok{/}\NormalTok{ (}\FunctionTok{max}\NormalTok{(x) }\SpecialCharTok{{-}} \FunctionTok{min}\NormalTok{(x))}
\NormalTok{\}}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{lapply}\NormalTok{(data, min\_max))}

\FunctionTok{save}\NormalTok{(compared\_group\_1, compared\_group\_2, compared\_group\_3, data, }\AttributeTok{file =} \StringTok{"./rdata/candidate\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)) \{}
\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{wilcox.test}\NormalTok{(data[compared\_group\_1 }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, i], data[compared\_group\_1 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, i])}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}
\NormalTok{adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}
\CommentTok{\# adj\_pval = {-}log10(adj\_pval)}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{variable =} \FunctionTok{colnames}\NormalTok{(data), }\AttributeTok{adj\_pval =}\NormalTok{ adj\_pval)}
\FunctionTok{write.csv}\NormalTok{(wilcox\_res, }\StringTok{"./other\_data/candidate\_antigen\_wilcox\_res\_1.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)) \{}
\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{wilcox.test}\NormalTok{(data[compared\_group\_2 }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, i], data[compared\_group\_2 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, i])}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}
\NormalTok{adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}
\CommentTok{\# adj\_pval = {-}log10(adj\_pval)}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{variable =} \FunctionTok{colnames}\NormalTok{(data), }\AttributeTok{adj\_pval =}\NormalTok{ adj\_pval)}
\FunctionTok{write.csv}\NormalTok{(wilcox\_res, }\StringTok{"./other\_data/candidate\_antigen\_wilcox\_res\_2.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(data)) \{}
\NormalTok{  pval }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(pval, }\FunctionTok{wilcox.test}\NormalTok{(data[compared\_group\_3 }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, i], data[compared\_group\_3 }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, i])}\SpecialCharTok{$}\NormalTok{p.value)}
\NormalTok{\}}
\NormalTok{adj\_pval }\OtherTok{\textless{}{-}} \FunctionTok{p.adjust}\NormalTok{(pval, }\AttributeTok{method =} \StringTok{"BH"}\NormalTok{, }\AttributeTok{n =} \FunctionTok{length}\NormalTok{(pval))}
\CommentTok{\# adj\_pval = {-}log10(adj\_pval)}
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{variable =} \FunctionTok{colnames}\NormalTok{(data), }\AttributeTok{adj\_pval =}\NormalTok{ adj\_pval)}
\FunctionTok{write.csv}\NormalTok{(wilcox\_res, }\StringTok{"./other\_data/candidate\_antigen\_wilcox\_res\_3.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-7}{%
\subsection{Plotting}\label{plotting-7}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(sfsmisc)}
\FunctionTok{library}\NormalTok{(stringr)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{firstup }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{) }\OtherTok{\textless{}{-}} \FunctionTok{toupper}\NormalTok{(}\FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{  x}
\NormalTok{\}}

\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/candidate\_antigen\_wilcox\_data.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_antigen\_wilcox\_res\_1.csv"}\NormalTok{)}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}}\NormalTok{ compared\_group\_1}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/processed\_candidate\_variable\_importance\_1.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data[wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\SpecialCharTok{!=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, ]}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(wilcox\_data, }\AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\StringTok{"compared\_group"}\NormalTok{))}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wilcox\_data, }\AttributeTok{y =} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ wilcox\_res, }\AttributeTok{by.x =} \StringTok{"row.names"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"variable"}\NormalTok{), }\AttributeTok{by.x =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"Row.names"}\NormalTok{, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{tile\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(wilcox\_data))}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group)}

\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(wilcox\_data)) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval[i]}
  \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{1e{-}3}\NormalTok{) \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{round}\NormalTok{(x, }\DecValTok{3}\NormalTok{))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    a }\OtherTok{\textless{}{-}} \FunctionTok{strsplit}\NormalTok{(}\FunctionTok{format}\NormalTok{(x, }\AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{"e"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{1}\NormalTok{]), }\StringTok{" \%*\% 10\^{}"}\NormalTok{, }\FunctionTok{as.integer}\NormalTok{(a[}\DecValTok{2}\NormalTok{]))}
\NormalTok{  \}}
\NormalTok{  adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(adj\_pval\_tmp, res)}
\NormalTok{\}}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval }\OtherTok{\textless{}{-}}\NormalTok{ adj\_pval\_tmp}

\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(wilcox\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, }\StringTok{\textasciigrave{}}\AttributeTok{Mean decrease accuracy}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ compared\_group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{position =} \FunctionTok{position\_jitterdodge}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ adj\_pval), }\AttributeTok{y =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{, }\AttributeTok{family =} \StringTok{"sans"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{parse =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9} \SpecialCharTok{+} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"solid"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
      \StringTok{"nonsynonymous\_snps"}\NormalTok{,}
      \StringTok{"max\_karplus\_schulz\_flexibility"}\NormalTok{,}
      \StringTok{"max\_parker\_hydrophilicity"}\NormalTok{,}
      \StringTok{"PmN"}\NormalTok{,}
      \StringTok{"mitochondrial"}\NormalTok{,}
      \StringTok{"avg\_parker\_hydrophilicity"}\NormalTok{,}
      \StringTok{"hydrophobicity\_Group3"}\NormalTok{,}
      \StringTok{"total\_snps"}\NormalTok{,}
      \StringTok{"min\_score\_ifn\_epitopes"}\NormalTok{,}
      \StringTok{"pi\_value"}
\NormalTok{    ), }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{      x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{      x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
      \FunctionTok{return}\NormalTok{(x)}
\NormalTok{    \}),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"Number non{-}synonymous SNPs"}\NormalTok{,}
      \StringTok{"Maximum score of Karplus and Schulz flexibility"}\NormalTok{,}
      \StringTok{"Maximum score of Parker hydrophilicity"}\NormalTok{,}
      \FunctionTok{expression}\NormalTok{(}\StringTok{"\% positive charge a.a. {-} \% negative charge a.a."}\NormalTok{),}
      \StringTok{"Mitochondrial"}\NormalTok{,}
      \StringTok{"Average score of Parker hydrophilicity"}\NormalTok{,}
      \FunctionTok{expression}\NormalTok{(}\StringTok{"\% hydrophobicity amino acids"}\NormalTok{),}
      \StringTok{"Total number of SNPs"}\NormalTok{,}
      \StringTok{"Minimum score of IFN{-}gamma inducing epitopes"}\NormalTok{,}
      \StringTok{"Isoelectric point (PI) value"}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"blue"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Candidate antigens"}\NormalTok{, }\StringTok{"Random predicted non{-}antigens"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Normalized variable value"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 1 (61 candidates)"}\NormalTok{)}

\NormalTok{legend }\OtherTok{\textless{}{-}} \FunctionTok{get\_legend}\NormalTok{(p1 }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}
  \AttributeTok{legend.title =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{legend.key =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{legend.direction =} \StringTok{"horizontal"}\NormalTok{,}
  \AttributeTok{legend.position =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.35}\NormalTok{, }\FloatTok{0.9}\NormalTok{)}
\NormalTok{))}

\NormalTok{p1 }\OtherTok{\textless{}{-}}\NormalTok{ p1 }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}
  \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
  \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
  \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{70}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{30}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
  \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
  \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_antigen\_wilcox\_res\_2.csv"}\NormalTok{)}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}}\NormalTok{ compared\_group\_2}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/processed\_candidate\_variable\_importance\_2.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data[wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\SpecialCharTok{!=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, ]}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(wilcox\_data, }\AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\StringTok{"compared\_group"}\NormalTok{))}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wilcox\_data, }\AttributeTok{y =} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ wilcox\_res, }\AttributeTok{by.x =} \StringTok{"row.names"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"variable"}\NormalTok{), }\AttributeTok{by.x =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"Row.names"}\NormalTok{, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{tile\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(wilcox\_data))}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group)}

\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(wilcox\_data)) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval[i]}
  \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{1e{-}3}\NormalTok{) \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{round}\NormalTok{(x, }\DecValTok{3}\NormalTok{))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    a }\OtherTok{\textless{}{-}} \FunctionTok{strsplit}\NormalTok{(}\FunctionTok{format}\NormalTok{(x, }\AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{"e"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{1}\NormalTok{]), }\StringTok{" \%*\% 10\^{}"}\NormalTok{, }\FunctionTok{as.integer}\NormalTok{(a[}\DecValTok{2}\NormalTok{]))}
\NormalTok{  \}}
\NormalTok{  adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(adj\_pval\_tmp, res)}
\NormalTok{\}}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval }\OtherTok{\textless{}{-}}\NormalTok{ adj\_pval\_tmp}

\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(wilcox\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, }\StringTok{\textasciigrave{}}\AttributeTok{Mean decrease accuracy}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ compared\_group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{position =} \FunctionTok{position\_jitterdodge}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ adj\_pval), }\AttributeTok{y =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{, }\AttributeTok{family =} \StringTok{"sans"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{parse =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9} \SpecialCharTok{+} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"solid"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
      \StringTok{"max\_parker\_hydrophilicity"}\NormalTok{,}
      \StringTok{"nonsynonymous\_snps"}\NormalTok{,}
      \StringTok{"max\_karplus\_schulz\_flexibility"}\NormalTok{,}
      \StringTok{"cytoskeletal"}\NormalTok{,}
      \StringTok{"mitochondrial"}\NormalTok{,}
      \StringTok{"hydrophobicity\_Group3"}\NormalTok{,}
      \StringTok{"min\_score\_ifn\_epitopes"}\NormalTok{,}
      \StringTok{"PmN"}\NormalTok{,}
      \StringTok{"total\_snps"}\NormalTok{,}
      \StringTok{"avg\_parker\_hydrophilicity"}
\NormalTok{    ), }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{      x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{      x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
      \FunctionTok{return}\NormalTok{(x)}
\NormalTok{    \}),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"Maximum score of Parker hydrophilicity"}\NormalTok{,}
      \StringTok{"Number non{-}synonymous SNPs"}\NormalTok{,}
      \StringTok{"Maximum score of Karplus and Schulz flexibility"}\NormalTok{,}
      \StringTok{"Cytoskeletal"}\NormalTok{,}
      \StringTok{"Mitochondrial"}\NormalTok{,}
      \StringTok{"\% hydrophobicity amino acids"}\NormalTok{,}
      \StringTok{"Minimum score of IFN{-}gamma inducing epitopes"}\NormalTok{,}
      \FunctionTok{expression}\NormalTok{(}\StringTok{"\% positive charge a.a. {-} \% negative charge a.a."}\NormalTok{),}
      \StringTok{"Total number of SNPs"}\NormalTok{,}
      \StringTok{"Average score of Parker hydrophilicity"}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"blue"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Candidate antigens"}\NormalTok{, }\StringTok{"Random predicted non{-}antigens"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{70}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Normalized variable value"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 2 (83 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wilcox\_res }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_antigen\_wilcox\_res\_3.csv"}\NormalTok{)}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}}\NormalTok{ compared\_group\_3}
\NormalTok{var\_imp }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/processed\_candidate\_variable\_importance\_3.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data[wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\SpecialCharTok{!=} \SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, ]}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(wilcox\_data, }\AttributeTok{id =} \FunctionTok{c}\NormalTok{(}\StringTok{"compared\_group"}\NormalTok{))}
\NormalTok{wilcox\_data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ wilcox\_data, }\AttributeTok{y =} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ var\_imp, }\AttributeTok{y =}\NormalTok{ wilcox\_res, }\AttributeTok{by.x =} \StringTok{"row.names"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"variable"}\NormalTok{), }\AttributeTok{by.x =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{by.y =} \StringTok{"Row.names"}\NormalTok{, }\AttributeTok{all.y =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{tile\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(wilcox\_data))}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{compared\_group)}

\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{variable }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(wilcox\_data}\SpecialCharTok{$}\NormalTok{variable, }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{  x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
  \FunctionTok{return}\NormalTok{(x)}
\NormalTok{\})}

\NormalTok{adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(wilcox\_data)) \{}
\NormalTok{  x }\OtherTok{\textless{}{-}}\NormalTok{ wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval[i]}
  \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\textgreater{}=} \FloatTok{1e{-}3}\NormalTok{) \{}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{round}\NormalTok{(x, }\DecValTok{3}\NormalTok{))}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    a }\OtherTok{\textless{}{-}} \FunctionTok{strsplit}\NormalTok{(}\FunctionTok{format}\NormalTok{(x, }\AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{"e"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]]}
\NormalTok{    res }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"italic(p) == "}\NormalTok{, }\FunctionTok{as.numeric}\NormalTok{(a[}\DecValTok{1}\NormalTok{]), }\StringTok{" \%*\% 10\^{}"}\NormalTok{, }\FunctionTok{as.integer}\NormalTok{(a[}\DecValTok{2}\NormalTok{]))}
\NormalTok{  \}}
\NormalTok{  adj\_pval\_tmp }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(adj\_pval\_tmp, res)}
\NormalTok{\}}
\NormalTok{wilcox\_data}\SpecialCharTok{$}\NormalTok{adj\_pval }\OtherTok{\textless{}{-}}\NormalTok{ adj\_pval\_tmp}

\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(wilcox\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(variable, }\StringTok{\textasciigrave{}}\AttributeTok{Mean decrease accuracy}\StringTok{\textasciigrave{}}\NormalTok{), }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =}\NormalTok{ compared\_group)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{outlier.color =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{lwd =} \FloatTok{0.3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}
    \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{stroke =} \FloatTok{0.3}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{,}
    \AttributeTok{position =} \FunctionTok{position\_jitterdodge}\NormalTok{()}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ adj\_pval), }\AttributeTok{y =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{size =} \DecValTok{3}\NormalTok{, }\AttributeTok{fontface =} \StringTok{"plain"}\NormalTok{, }\AttributeTok{family =} \StringTok{"sans"}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{0}\NormalTok{, }\AttributeTok{parse =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9} \SpecialCharTok{+} \FloatTok{0.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"grey80"}\NormalTok{, }\AttributeTok{linetype =} \StringTok{"solid"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
      \StringTok{"out\_number\_b\_cell\_epitopes\_bepipred\_1\_0"}\NormalTok{,}
      \StringTok{"max\_parker\_hydrophilicity"}\NormalTok{,}
      \StringTok{"max\_karplus\_schulz\_flexibility"}\NormalTok{,}
      \StringTok{"nonsynonymous\_snps"}\NormalTok{,}
      \StringTok{"hydrophobicity\_Group3"}\NormalTok{,}
      \StringTok{"cytoskeletal"}\NormalTok{,}
      \StringTok{"mitochondrial"}\NormalTok{,}
      \StringTok{"PmN"}\NormalTok{,}
      \StringTok{"avg\_parker\_hydrophilicity"}\NormalTok{,}
      \StringTok{"min\_parker\_hydrophilicity"}
\NormalTok{    ), }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{      x }\OtherTok{\textless{}{-}} \FunctionTok{str\_replace\_all}\NormalTok{(x, }\StringTok{"[\_}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\NormalTok{      x }\OtherTok{\textless{}{-}} \FunctionTok{firstup}\NormalTok{(x)}
      \FunctionTok{return}\NormalTok{(x)}
\NormalTok{    \}),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"Number B{-}cell epitopes in outer membrane regions"}\NormalTok{,}
      \StringTok{"Maximum score of Parker hydrophilicity"}\NormalTok{,}
      \StringTok{"Maximum score of Karplus and Schulz flexibility"}\NormalTok{,}
      \StringTok{"Number non{-}synonymous SNPs"}\NormalTok{,}
      \FunctionTok{expression}\NormalTok{(}\StringTok{"\% hydrophobicity amino acids"}\NormalTok{),}
      \StringTok{"Cytoskeletal"}\NormalTok{,}
      \StringTok{"Mitochondrial"}\NormalTok{,}
      \FunctionTok{expression}\NormalTok{(}\StringTok{"\% positive charge a.a. {-} \% negative charge a.a."}\NormalTok{),}
      \StringTok{"Average score of Parker hydrophilicity"}\NormalTok{,}
      \StringTok{"Minimum score of Parker hydrophilicity"}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{clip =} \StringTok{"off"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"0"}\NormalTok{), }\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"blue"}\NormalTok{),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Candidate antigens"}\NormalTok{, }\StringTok{"Random predicted non{-}antigens"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{70}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{20}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Normalized variable value"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 3 (56 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(p1, p3, }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.5}\NormalTok{)),}
  \FunctionTok{plot\_grid}\NormalTok{(p2,}
    \ConstantTok{NULL}\NormalTok{,}
    \FunctionTok{plot\_grid}\NormalTok{(}\ConstantTok{NULL}\NormalTok{, legend, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.45}\NormalTok{, }\FloatTok{0.6}\NormalTok{)),}
    \ConstantTok{NULL}\NormalTok{,}
    \AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.02}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.4}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.52}\NormalTok{, }\FloatTok{0.48}\NormalTok{)}
\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 10} \end{center}

\hypertarget{comparison-of-important-variables}{%
\section{Comparison of important variables}\label{comparison-of-important-variables}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{var\_imp\_1 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_variable\_importance\_1.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{var\_imp\_2 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_variable\_importance\_2.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{var\_imp\_3 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_variable\_importance\_3.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{var\_imp\_1 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_1[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp\_1}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{var\_imp\_2 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_2[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp\_2}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{var\_imp\_3 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_3[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp\_3}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{var\_imp\_1}\SpecialCharTok{$}\NormalTok{rank\_1 }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp\_1}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy)}
\NormalTok{var\_imp\_2}\SpecialCharTok{$}\NormalTok{rank\_2 }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp\_2}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy)}
\NormalTok{var\_imp\_3}\SpecialCharTok{$}\NormalTok{rank\_3 }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{var\_imp\_3}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy)}

\NormalTok{var\_imp\_1}\SpecialCharTok{$}\NormalTok{rank\_2 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_2[}\FunctionTok{rownames}\NormalTok{(var\_imp\_1), }\StringTok{"rank\_2"}\NormalTok{]}
\NormalTok{var\_imp\_1}\SpecialCharTok{$}\NormalTok{rank\_3 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_3[}\FunctionTok{rownames}\NormalTok{(var\_imp\_1), }\StringTok{"rank\_3"}\NormalTok{]}

\NormalTok{var\_imp\_2}\SpecialCharTok{$}\NormalTok{rank\_1 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_1[}\FunctionTok{rownames}\NormalTok{(var\_imp\_2), }\StringTok{"rank\_1"}\NormalTok{]}
\NormalTok{var\_imp\_2}\SpecialCharTok{$}\NormalTok{rank\_3 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_3[}\FunctionTok{rownames}\NormalTok{(var\_imp\_2), }\StringTok{"rank\_3"}\NormalTok{]}

\NormalTok{var\_imp\_3}\SpecialCharTok{$}\NormalTok{rank\_1 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_1[}\FunctionTok{rownames}\NormalTok{(var\_imp\_3), }\StringTok{"rank\_1"}\NormalTok{]}
\NormalTok{var\_imp\_3}\SpecialCharTok{$}\NormalTok{rank\_2 }\OtherTok{\textless{}{-}}\NormalTok{ var\_imp\_2[}\FunctionTok{rownames}\NormalTok{(var\_imp\_3), }\StringTok{"rank\_2"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{grp\_var\_imp\_1 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_group\_variable\_importance\_1.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{grp\_var\_imp\_2 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_group\_variable\_importance\_2.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{grp\_var\_imp\_3 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/candidate\_group\_variable\_importance\_3.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{grp\_var\_imp\_1 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_1[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{grp\_var\_imp\_1}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{grp\_var\_imp\_2 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_2[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{grp\_var\_imp\_2}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{grp\_var\_imp\_3 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_3[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{grp\_var\_imp\_3}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy), , drop }\OtherTok{=} \ConstantTok{FALSE}\NormalTok{]}
\NormalTok{grp\_var\_imp\_1}\SpecialCharTok{$}\NormalTok{rank\_1 }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{grp\_var\_imp\_1}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy)}
\NormalTok{grp\_var\_imp\_2}\SpecialCharTok{$}\NormalTok{rank\_2 }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{grp\_var\_imp\_2}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy)}
\NormalTok{grp\_var\_imp\_3}\SpecialCharTok{$}\NormalTok{rank\_3 }\OtherTok{\textless{}{-}} \FunctionTok{rank}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{grp\_var\_imp\_3}\SpecialCharTok{$}\NormalTok{meanDecreaseAccuracy)}

\NormalTok{grp\_var\_imp\_1}\SpecialCharTok{$}\NormalTok{rank\_2 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_2[}\FunctionTok{rownames}\NormalTok{(grp\_var\_imp\_1), }\StringTok{"rank\_2"}\NormalTok{]}
\NormalTok{grp\_var\_imp\_1}\SpecialCharTok{$}\NormalTok{rank\_3 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_3[}\FunctionTok{rownames}\NormalTok{(grp\_var\_imp\_1), }\StringTok{"rank\_3"}\NormalTok{]}

\NormalTok{grp\_var\_imp\_2}\SpecialCharTok{$}\NormalTok{rank\_1 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_1[}\FunctionTok{rownames}\NormalTok{(grp\_var\_imp\_2), }\StringTok{"rank\_1"}\NormalTok{]}
\NormalTok{grp\_var\_imp\_2}\SpecialCharTok{$}\NormalTok{rank\_3 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_3[}\FunctionTok{rownames}\NormalTok{(grp\_var\_imp\_2), }\StringTok{"rank\_3"}\NormalTok{]}

\NormalTok{grp\_var\_imp\_3}\SpecialCharTok{$}\NormalTok{rank\_1 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_1[}\FunctionTok{rownames}\NormalTok{(grp\_var\_imp\_3), }\StringTok{"rank\_1"}\NormalTok{]}
\NormalTok{grp\_var\_imp\_3}\SpecialCharTok{$}\NormalTok{rank\_2 }\OtherTok{\textless{}{-}}\NormalTok{ grp\_var\_imp\_2[}\FunctionTok{rownames}\NormalTok{(grp\_var\_imp\_3), }\StringTok{"rank\_2"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{var\_imp\_1\_ }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(var\_imp\_1[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"meanDecreaseAccuracy"}\NormalTok{, }\StringTok{"rank\_2"}\NormalTok{, }\StringTok{"rank\_3"}\NormalTok{)], grp\_var\_imp\_1[, }\FunctionTok{c}\NormalTok{(}\StringTok{"meanDecreaseAccuracy"}\NormalTok{, }\StringTok{"rank\_2"}\NormalTok{, }\StringTok{"rank\_3"}\NormalTok{)])}

\FunctionTok{colnames}\NormalTok{(var\_imp\_1\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Mean decrease accuracy"}\NormalTok{, }\StringTok{"Group 2 rank"}\NormalTok{, }\StringTok{"Group 3 rank"}\NormalTok{)}
\FunctionTok{write.csv}\NormalTok{(var\_imp\_1\_, }\StringTok{"./other\_data/processed\_candidate\_variable\_importance\_1.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{var\_imp\_2\_ }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(var\_imp\_2[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"meanDecreaseAccuracy"}\NormalTok{, }\StringTok{"rank\_1"}\NormalTok{, }\StringTok{"rank\_3"}\NormalTok{)], grp\_var\_imp\_2[, }\FunctionTok{c}\NormalTok{(}\StringTok{"meanDecreaseAccuracy"}\NormalTok{, }\StringTok{"rank\_1"}\NormalTok{, }\StringTok{"rank\_3"}\NormalTok{)])}
\FunctionTok{colnames}\NormalTok{(var\_imp\_2\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Mean decrease accuracy"}\NormalTok{, }\StringTok{"Group 1 rank"}\NormalTok{, }\StringTok{"Group 3 rank"}\NormalTok{)}
\FunctionTok{write.csv}\NormalTok{(var\_imp\_2\_, }\StringTok{"./other\_data/processed\_candidate\_variable\_importance\_2.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{var\_imp\_3\_ }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(var\_imp\_3[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"meanDecreaseAccuracy"}\NormalTok{, }\StringTok{"rank\_1"}\NormalTok{, }\StringTok{"rank\_2"}\NormalTok{)], grp\_var\_imp\_3[, }\FunctionTok{c}\NormalTok{(}\StringTok{"meanDecreaseAccuracy"}\NormalTok{, }\StringTok{"rank\_1"}\NormalTok{, }\StringTok{"rank\_2"}\NormalTok{)])}
\FunctionTok{colnames}\NormalTok{(var\_imp\_3\_) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Mean decrease accuracy"}\NormalTok{, }\StringTok{"Group 1 rank"}\NormalTok{, }\StringTok{"Group 2 rank"}\NormalTok{)}
\FunctionTok{write.csv}\NormalTok{(var\_imp\_3\_, }\StringTok{"./other\_data/processed\_candidate\_variable\_importance\_3.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Group 1}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Table 1} \end{center}

\textbf{Group 2}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Table 2} \end{center}

\textbf{Group 3}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Table 3} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] sfsmisc_1.1-13   umap_0.2.8.0     cluster_2.1.4    ggforce_0.3.4   
##  [5] ggbeeswarm_0.6.0 ggpubr_0.4.0     rlist_0.4.6.2    reshape2_1.4.4  
##  [9] cowplot_1.1.1    ggrepel_0.9.1    stringr_1.4.1    NbClust_3.0.1   
## [13] factoextra_1.0.7 ggplot2_3.4.2   
## 
## loaded via a namespace (and not attached):
##  [1] tidyr_1.2.0       jsonlite_1.8.0    carData_3.0-5     R.utils_2.12.0   
##  [5] assertthat_0.2.1  askpass_1.1       vipor_0.4.5       yaml_2.3.5       
##  [9] pillar_1.8.1      backports_1.4.1   lattice_0.20-45   glue_1.6.2       
## [13] reticulate_1.25   digest_0.6.29     ggsignif_0.6.3    polyclip_1.10-0  
## [17] colorspace_2.0-3  htmltools_0.5.3   Matrix_1.5-3      R.oo_1.25.0      
## [21] plyr_1.8.7        pkgconfig_2.0.3   broom_1.0.0       bookdown_0.28    
## [25] purrr_0.3.4       scales_1.2.1      tweenr_2.0.1      RSpectra_0.16-1  
## [29] tibble_3.1.8      openssl_2.0.2     styler_1.8.0      generics_0.1.3   
## [33] farver_2.1.1      car_3.1-0         withr_2.5.0       cli_3.6.1        
## [37] magrittr_2.0.3    evaluate_0.16     R.methodsS3_1.8.2 fansi_1.0.3      
## [41] R.cache_0.16.0    MASS_7.3-58.2     rstatix_0.7.0     beeswarm_0.4.0   
## [45] tools_4.2.3       data.table_1.14.2 lifecycle_1.0.3   munsell_0.5.0    
## [49] compiler_4.2.3    rlang_1.1.0       grid_4.2.3        rstudioapi_0.14  
## [53] rmarkdown_2.16    codetools_0.2-19  gtable_0.3.0      abind_1.4-5      
## [57] DBI_1.1.3         R6_2.5.1          knitr_1.40        dplyr_1.0.9      
## [61] fastmap_1.1.0     utf8_1.2.2        stringi_1.7.8     Rcpp_1.0.9       
## [65] vctrs_0.6.2       png_0.1-7         tidyselect_1.1.2  xfun_0.32
\end{verbatim}

\hypertarget{05_further_characterization}{%
\chapter{Further characterization}\label{05_further_characterization}}

\hypertarget{gene-ontology-analysis}{%
\section{Gene ontology analysis}\label{gene-ontology-analysis}}

Gene ontology (GO) enrichment analysis using GOATOOLS (\protect\hyperlink{ref-Klopfenstein:2018vj}{Klopfenstein et al. 2018}).

\hypertarget{analysis-7}{%
\subsection{Analysis}\label{analysis-7}}

\textbf{In bash: }

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{python}\NormalTok{ ./other\_data/goea.py }\AttributeTok{{-}s} \StringTok{"./other\_data/top\_200\_candidates\_gene\_accession\_1.csv"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}p} \StringTok{"./other\_data/PlasmoDB{-}59\_Pfalciparum3D7\_GO.gaf"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}n} \StringTok{"./other\_data/go{-}basic.obo"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}o} \StringTok{"./other\_data/goea\_result\_1.xlsx"}
                            
\ExtensionTok{python}\NormalTok{ ./other\_data/goea.py }\AttributeTok{{-}s} \StringTok{"./other\_data/top\_200\_candidates\_gene\_accession\_2.csv"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}p} \StringTok{"./other\_data/PlasmoDB{-}59\_Pfalciparum3D7\_GO.gaf"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}n} \StringTok{"./other\_data/go{-}basic.obo"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}o} \StringTok{"./other\_data/goea\_result\_2.xlsx"}
                            
\ExtensionTok{python}\NormalTok{ ./other\_data/goea.py }\AttributeTok{{-}s} \StringTok{"./other\_data/top\_200\_candidates\_gene\_accession\_3.csv"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}p} \StringTok{"./other\_data/PlasmoDB{-}59\_Pfalciparum3D7\_GO.gaf"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}n} \StringTok{"./other\_data/go{-}basic.obo"} \DataTypeTok{\textbackslash{}}
                            \AttributeTok{{-}o} \StringTok{"./other\_data/goea\_result\_3.xlsx"}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-8}{%
\subsection{Plotting}\label{plotting-8}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{library}\NormalTok{(shadowtext)}
\FunctionTok{library}\NormalTok{(ggforce)}
\FunctionTok{library}\NormalTok{(reshape)}
\FunctionTok{library}\NormalTok{(cowplot)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{process\_goea\_res }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(file\_name) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(file\_name, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{fill =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{quote =} \StringTok{\textquotesingle{}}\SpecialCharTok{\textbackslash{}"}\StringTok{\textquotesingle{}}\NormalTok{, }\AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}\NormalTok{)}
  \CommentTok{\# calculate percentage from the ratio column}
\NormalTok{  data}\SpecialCharTok{$}\NormalTok{num\_genes }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(data, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.integer}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(}\FunctionTok{strsplit}\NormalTok{(x[}\StringTok{"ratio\_in\_study"}\NormalTok{], }\StringTok{"/"}\NormalTok{))[}\DecValTok{1}\NormalTok{]))}
  \CommentTok{\# select for enrichment (e) data rows}
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{enrichment }\SpecialCharTok{==} \StringTok{"e"}\NormalTok{, ]}

  \CommentTok{\# select for biological process (BP) data rows}
\NormalTok{  res\_bp }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{NS }\SpecialCharTok{==} \StringTok{"BP"}\NormalTok{, ]}
\NormalTok{  res\_bp}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(res\_bp}\SpecialCharTok{$}\NormalTok{p\_fdr\_bh)}
\NormalTok{  res\_bp }\OtherTok{\textless{}{-}}\NormalTok{ res\_bp[}\FunctionTok{order}\NormalTok{(res\_bp}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{  res\_bp}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\StringTok{"Biological process"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(res\_bp))}

  \CommentTok{\# select for cellular component (CC) data rows}
\NormalTok{  res\_cc }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{NS }\SpecialCharTok{==} \StringTok{"CC"}\NormalTok{, ]}
\NormalTok{  res\_cc}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(res\_cc}\SpecialCharTok{$}\NormalTok{p\_fdr\_bh)}
\NormalTok{  res\_cc }\OtherTok{\textless{}{-}}\NormalTok{ res\_cc[}\FunctionTok{order}\NormalTok{(res\_cc}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{  res\_cc}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\StringTok{"Cellular component"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(res\_cc))}

  \CommentTok{\# select for molecular function (MF) data rows}
\NormalTok{  res\_mf }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{NS }\SpecialCharTok{==} \StringTok{"MF"}\NormalTok{, ]}
\NormalTok{  res\_mf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(res\_mf}\SpecialCharTok{$}\NormalTok{p\_fdr\_bh)}
\NormalTok{  res\_mf }\OtherTok{\textless{}{-}}\NormalTok{ res\_mf[}\FunctionTok{order}\NormalTok{(res\_mf}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{), ]}
\NormalTok{  res\_mf}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\StringTok{"Molecular function"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(res\_mf))}

\NormalTok{  ds }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(rbind, }\FunctionTok{list}\NormalTok{(res\_mf, res\_cc, res\_bp))}
\NormalTok{  ds}\SpecialCharTok{$}\NormalTok{name }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{name, }\AttributeTok{levels =}\NormalTok{ ds}\SpecialCharTok{$}\NormalTok{name)}
\NormalTok{  ds}\SpecialCharTok{$}\NormalTok{group }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds}\SpecialCharTok{$}\NormalTok{group, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Biological process"}\NormalTok{, }\StringTok{"Cellular component"}\NormalTok{, }\StringTok{"Molecular function"}\NormalTok{))}

  \FunctionTok{return}\NormalTok{(ds)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds\_1 }\OtherTok{\textless{}{-}} \FunctionTok{process\_goea\_res}\NormalTok{(}\StringTok{"./other\_data/goea\_result\_1.csv"}\NormalTok{)}
\NormalTok{ds\_2 }\OtherTok{\textless{}{-}} \FunctionTok{process\_goea\_res}\NormalTok{(}\StringTok{"./other\_data/goea\_result\_2.csv"}\NormalTok{)}
\NormalTok{ds\_3 }\OtherTok{\textless{}{-}} \FunctionTok{process\_goea\_res}\NormalTok{(}\StringTok{"./other\_data/goea\_result\_3.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_1, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ name, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.0f"}\NormalTok{, num\_genes)), }\AttributeTok{nudge\_y =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  ggforce}\SpecialCharTok{::}\FunctionTok{facet\_col}\NormalTok{(}\AttributeTok{facets =} \FunctionTok{vars}\NormalTok{(group), }\AttributeTok{scales =} \StringTok{"free\_y"}\NormalTok{, }\AttributeTok{space =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.spacing =} \FunctionTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{85}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\StringTok{"{-}Log"}\NormalTok{[}\DecValTok{10}\NormalTok{] }\SpecialCharTok{*} \StringTok{"FDR"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 1 (61 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_2, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ name, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.0f"}\NormalTok{, num\_genes)), }\AttributeTok{nudge\_y =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  ggforce}\SpecialCharTok{::}\FunctionTok{facet\_col}\NormalTok{(}\AttributeTok{facets =} \FunctionTok{vars}\NormalTok{(group), }\AttributeTok{scales =} \StringTok{"free\_y"}\NormalTok{, }\AttributeTok{space =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.spacing =} \FunctionTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\StringTok{"{-}Log"}\NormalTok{[}\DecValTok{10}\NormalTok{] }\SpecialCharTok{*} \StringTok{"FDR"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 2 (83 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_3, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ name, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{{-}Log10FDR}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.05}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{5}\NormalTok{, }\AttributeTok{shape =} \DecValTok{21}\NormalTok{, }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey20"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.0f"}\NormalTok{, num\_genes)), }\AttributeTok{nudge\_y =} \DecValTok{0}\NormalTok{, }\AttributeTok{size =} \FloatTok{2.5}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  ggforce}\SpecialCharTok{::}\FunctionTok{facet\_col}\NormalTok{(}\AttributeTok{facets =} \FunctionTok{vars}\NormalTok{(group), }\AttributeTok{scales =} \StringTok{"free\_y"}\NormalTok{, }\AttributeTok{space =} \StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.spacing =} \FunctionTok{unit}\NormalTok{(}\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{strip.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.border =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{legend.text =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.title.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, ),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\FunctionTok{expression}\NormalTok{(}\StringTok{"{-}Log"}\NormalTok{[}\DecValTok{10}\NormalTok{] }\SpecialCharTok{*} \StringTok{"FDR"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 3 (56 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(p1, p2, p3, }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.39}\NormalTok{, }\FloatTok{0.34}\NormalTok{, }\FloatTok{0.4}\NormalTok{))}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Fig 5} \end{center}

\hypertarget{candidate-antigen-characterization}{%
\section{Candidate antigen characterization}\label{candidate-antigen-characterization}}

Candidate antigen down-selection with essential genes (\protect\hyperlink{ref-Zhang:2018ug}{Zhang et al. 2018}) and characterization using single cell RNA-seq data (\protect\hyperlink{ref-Howick:2019uo}{Howick et al. 2019}).

\hypertarget{analysis-8}{%
\subsection{Analysis}\label{analysis-8}}

\textbf{In R: }

\hypertarget{down-selection-with-essential-genes}{%
\subsubsection{Down-selection with essential genes}\label{down-selection-with-essential-genes}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(RMariaDB)}
\FunctionTok{library}\NormalTok{(DBI)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{db }\OtherTok{\textless{}{-}} \FunctionTok{dbConnect}\NormalTok{(RMariaDB}\SpecialCharTok{::}\FunctionTok{MariaDB}\NormalTok{(), }\AttributeTok{user =} \StringTok{"root"}\NormalTok{, }\AttributeTok{password =} \StringTok{""}\NormalTok{, }\AttributeTok{dbname =} \StringTok{"pf\_reverse\_vaccinology"}\NormalTok{)}

\NormalTok{get\_data }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(table\_name, db) \{}
\NormalTok{  sql }\OtherTok{\textless{}{-}} \FunctionTok{sqlInterpolate}\NormalTok{(db, }\StringTok{"SELECT * FROM ?table"}\NormalTok{, }\AttributeTok{table =} \FunctionTok{dbQuoteIdentifier}\NormalTok{(db, table\_name))}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{subset}\NormalTok{(}\FunctionTok{dbGetQuery}\NormalTok{(db, sql), }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(id)))}
\NormalTok{\}}

\CommentTok{\# pf3d7\_essential\_gene}
\NormalTok{id\_map }\OtherTok{\textless{}{-}} \FunctionTok{dbGetQuery}\NormalTok{(db, }\StringTok{\textquotesingle{}SELECT dbxref\_1.accession AS accession, dbxref\_1.dbxref\_id AS transcript\_id FROM dbxref AS dbxref\_1}
\StringTok{                         LEFT OUTER JOIN feature AS feature\_1 ON dbxref\_1.dbxref\_id = feature\_1.dbxref\_id}
\StringTok{                         LEFT OUTER JOIN cvterm ON feature\_1.type\_id = cvterm.cvterm\_id}
\StringTok{                         LEFT OUTER JOIN feature\_relationship ON feature\_1.feature\_id = feature\_relationship.subject\_id}
\StringTok{                         LEFT OUTER JOIN feature AS feature\_2 ON feature\_relationship.object\_id = feature\_2.feature\_id}
\StringTok{                         LEFT OUTER JOIN dbxref AS dbxref\_2 ON feature\_2.dbxref\_id = dbxref\_2.dbxref\_id}
\StringTok{                         LEFT OUTER JOIN organism ON feature\_1.organism\_id = organism.organism\_id}
\StringTok{                         WHERE feature\_1.is\_obsolete = 0 AND cvterm.name = "CDS" AND organism.species="falciparum\_3D7"\textquotesingle{}}\NormalTok{)}

\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{get\_data}\NormalTok{(}\StringTok{"pf3d7\_essential\_gene"}\NormalTok{, db)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ id\_map, }\AttributeTok{y =}\NormalTok{ data, }\AttributeTok{by =} \StringTok{"transcript\_id"}\NormalTok{, }\AttributeTok{all =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{accession }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{accession}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(data, }\AttributeTok{select =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(transcript\_id, accession))}
\FunctionTok{rownames}\NormalTok{(data) }\OtherTok{\textless{}{-}}\NormalTok{ accession}
\FunctionTok{write.csv}\NormalTok{(data, }\AttributeTok{file =} \StringTok{"./other\_data/pf\_essential\_genes.csv"}\NormalTok{)}

\FunctionTok{dbDisconnect}\NormalTok{(db)}
\end{Highlighting}
\end{Shaded}

\hypertarget{characterization-using-scrna-seq}{%
\subsubsection{Characterization using scRNA-seq}\label{characterization-using-scrna-seq}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# db = dbConnect(RMariaDB::MariaDB(), user=\textquotesingle{}root\textquotesingle{}, password=\textquotesingle{}\textquotesingle{}, dbname = \textquotesingle{}pf\_reverse\_vaccinology\textquotesingle{})}
\CommentTok{\#}
\CommentTok{\# get\_data = function(table\_name, db) \{}
\CommentTok{\#   sql = sqlInterpolate(db, \textquotesingle{}SELECT * FROM ?table\textquotesingle{}, table=dbQuoteIdentifier(db, table\_name))}
\CommentTok{\#   return(subset(dbGetQuery(db, sql), select = {-}c(id)))}
\CommentTok{\# \}}
\CommentTok{\#}
\CommentTok{\# \# scRNA{-}seq metadata}
\CommentTok{\# sc\_metadata = get\_data("pf3d7\_single\_cell\_coldata", db)}
\CommentTok{\# rownames(sc\_metadata) = sc\_metadata[, 1]}
\CommentTok{\# sc\_metadata[, 1] = NULL}
\CommentTok{\# write.csv(sc\_metadata, file=\textquotesingle{}./other\_data/pf\_sc\_metadata.csv\textquotesingle{})}
\CommentTok{\#}
\CommentTok{\# \# scRNA{-}seq count data}
\CommentTok{\# id\_map = dbGetQuery(db, \textquotesingle{}SELECT dbxref\_1.accession AS accession, dbxref\_1.dbxref\_id AS transcript\_id FROM dbxref AS dbxref\_1}
\CommentTok{\#                          LEFT OUTER JOIN feature AS feature\_1 ON dbxref\_1.dbxref\_id = feature\_1.dbxref\_id}
\CommentTok{\#                          LEFT OUTER JOIN cvterm ON feature\_1.type\_id = cvterm.cvterm\_id}
\CommentTok{\#                          LEFT OUTER JOIN feature\_relationship ON feature\_1.feature\_id = feature\_relationship.subject\_id}
\CommentTok{\#                          LEFT OUTER JOIN feature AS feature\_2 ON feature\_relationship.object\_id = feature\_2.feature\_id}
\CommentTok{\#                          LEFT OUTER JOIN dbxref AS dbxref\_2 ON feature\_2.dbxref\_id = dbxref\_2.dbxref\_id}
\CommentTok{\#                          LEFT OUTER JOIN organism ON feature\_1.organism\_id = organism.organism\_id}
\CommentTok{\#                          WHERE feature\_1.is\_obsolete = 0 AND cvterm.name = "CDS" AND organism.species="falciparum\_3D7"\textquotesingle{})}
\CommentTok{\#}
\CommentTok{\# sc\_data\_1 = get\_data("pf3d7\_single\_cell\_count", db)}
\CommentTok{\# sc\_data\_2 = get\_data("pf3d7\_single\_cell\_count\_2", db)}
\CommentTok{\# sc\_data = merge(x=sc\_data\_1, y=sc\_data\_2, by=\textquotesingle{}transcript\_id\textquotesingle{}, all.x=TRUE)}
\CommentTok{\# sc\_data = merge(x=id\_map, y=sc\_data, by=\textquotesingle{}transcript\_id\textquotesingle{}, all=FALSE)}
\CommentTok{\# accession = sc\_data$accession}
\CommentTok{\# sc\_data = subset(sc\_data, select = {-}c(transcript\_id, accession))}
\CommentTok{\# rownames(sc\_data) = accession}
\CommentTok{\# write.csv(sc\_data, file=\textquotesingle{}./other\_data/pf\_sc\_data.csv\textquotesingle{})}
\CommentTok{\#}
\CommentTok{\# dbDisconnect(db)}
\end{Highlighting}
\end{Shaded}

\hypertarget{processing-table}{%
\subsection{Processing table}\label{processing-table}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(reshape2)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggridges)}
\FunctionTok{library}\NormalTok{(rlist)}
\FunctionTok{library}\NormalTok{(cowplot)}
\FunctionTok{library}\NormalTok{(PupillometryR)}
\FunctionTok{library}\NormalTok{(grid)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_4\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{prediction }\OtherTok{\textless{}{-}}\NormalTok{ prediction[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{prediction}\SpecialCharTok{$}\NormalTok{oob\_score\_with\_tree\_filtering), ]}
\NormalTok{labeled\_pos }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(prediction)[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{1}\NormalTok{]}
\NormalTok{top\_200 }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(prediction[prediction}\SpecialCharTok{$}\NormalTok{antigen\_label }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, ])[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{200}\NormalTok{]}

\NormalTok{essential\_genes }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf\_essential\_genes.csv"}\NormalTok{, }\AttributeTok{header =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\NormalTok{essential\_genes }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(essential\_genes)[essential\_genes}\SpecialCharTok{$}\NormalTok{mis }\SpecialCharTok{\textless{}} \FloatTok{0.5}\NormalTok{]}
\NormalTok{essential\_genes }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(essential\_genes, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{paste0}\NormalTok{(x, }\StringTok{"{-}p1"}\NormalTok{))}
\NormalTok{down\_selected }\OtherTok{\textless{}{-}}\NormalTok{ top\_200[top\_200 }\SpecialCharTok{\%in\%}\NormalTok{ essential\_genes]}

\NormalTok{labeled\_pos }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(labeled\_pos, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\FunctionTok{nchar}\NormalTok{(x) }\SpecialCharTok{{-}} \DecValTok{3}\NormalTok{))}
\NormalTok{top\_200\_ }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(top\_200, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{substr}\NormalTok{(x, }\DecValTok{1}\NormalTok{, }\FunctionTok{nchar}\NormalTok{(x) }\SpecialCharTok{{-}} \DecValTok{3}\NormalTok{))}

\CommentTok{\# Downloaded from https://www.malariacellatlas.org/data{-}sets/, or}
\CommentTok{\# https://www.malariacellatlas.org/downloads/pf{-}ss2{-}set1.zip}
\NormalTok{sc\_metadata }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/pf{-}ss2{-}set1/pf{-}ss2{-}set1{-}ss2{-}data.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\CommentTok{\# Already normalized}
\NormalTok{sc\_data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"\textasciitilde{}/Downloads/pf{-}ss2{-}set1/pf{-}ss2{-}set1{-}ss2{-}exp.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(sc\_data) }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(sc\_data), }\StringTok{".1"}\NormalTok{)}

\NormalTok{sc\_data\_ }\OtherTok{\textless{}{-}}\NormalTok{ sc\_data[}\FunctionTok{rownames}\NormalTok{(sc\_data) }\SpecialCharTok{\%in\%}\NormalTok{ top\_200\_ }\SpecialCharTok{|} \FunctionTok{rownames}\NormalTok{(sc\_data) }\SpecialCharTok{\%in\%}\NormalTok{ labeled\_pos, ]}
\NormalTok{stage\_order }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"sporozoite (oocyst)"}\NormalTok{, }\StringTok{"sporozoite (hemolymph)"}\NormalTok{, }\StringTok{"sporozoite (salivary gland)"}\NormalTok{,}
  \StringTok{"sporozoite (injected)"}\NormalTok{, }\StringTok{"sporozoite (activated)"}\NormalTok{, }\StringTok{"ring"}\NormalTok{, }\StringTok{"trophozoite"}\NormalTok{, }\StringTok{"schizont"}\NormalTok{,}
  \StringTok{"gametocyte (developing)"}\NormalTok{, }\StringTok{"gametocyte (male)"}\NormalTok{, }\StringTok{"gametocyte (female)"}\NormalTok{, }\StringTok{"ookinete"}
\NormalTok{)}
\NormalTok{stage\_name }\OtherTok{\textless{}{-}}\NormalTok{ stage\_order}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stat\_res }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(sc\_data\_)) \{}
\NormalTok{  gene\_stat\_res }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}
  \ControlFlowTok{for}\NormalTok{ (stage }\ControlFlowTok{in}\NormalTok{ stage\_order) \{}
\NormalTok{    tmp }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(sc\_data\_[i, }\FunctionTok{rownames}\NormalTok{(sc\_metadata[sc\_metadata}\SpecialCharTok{$}\NormalTok{STAGE\_HR }\SpecialCharTok{==}\NormalTok{ stage, ])])}
\NormalTok{    gene\_stat\_res }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(gene\_stat\_res, }\FunctionTok{paste0}\NormalTok{(}
      \StringTok{"Prop. cells: "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{sum}\NormalTok{(tmp }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{length}\NormalTok{(tmp), }\DecValTok{2}\NormalTok{),}
      \StringTok{"; Median: "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{median}\NormalTok{(tmp), }\DecValTok{2}\NormalTok{),}
      \StringTok{"; Mean: "}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(tmp), }\DecValTok{2}\NormalTok{)}
\NormalTok{    ))}
\NormalTok{  \}}
\NormalTok{  stat\_res }\OtherTok{\textless{}{-}} \FunctionTok{list.append}\NormalTok{(stat\_res, gene\_stat\_res)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{prox\_w\_tree\_filtering }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/proximity\_values\_tree\_filtering.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{rownames}\NormalTok{(prox\_w\_tree\_filtering) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(prox\_w\_tree\_filtering)}
\NormalTok{dist\_w\_tree\_filtering }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ prox\_w\_tree\_filtering}
\NormalTok{dist\_w\_tree\_filtering }\OtherTok{\textless{}{-}}\NormalTok{ dist\_w\_tree\_filtering[, }\FunctionTok{names}\NormalTok{(labeled\_pos)]}
\FunctionTok{colnames}\NormalTok{(dist\_w\_tree\_filtering) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(labeled\_pos)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Prepare final table}
\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(stat\_res))}
\FunctionTok{rownames}\NormalTok{(ds) }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(}\FunctionTok{rownames}\NormalTok{(sc\_data\_), }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{paste0}\NormalTok{(x, }\StringTok{"{-}p1"}\NormalTok{))}
\FunctionTok{colnames}\NormalTok{(ds) }\OtherTok{\textless{}{-}}\NormalTok{ stage\_name}
\NormalTok{known\_antigens }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(labeled\_pos, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{paste0}\NormalTok{(x, }\StringTok{"{-}p1"}\NormalTok{))}

\CommentTok{\# Add prediction scores}
\NormalTok{prediction }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_4\_purf\_oob\_predictions.csv"}\NormalTok{, }\AttributeTok{row.names =} \DecValTok{1}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}
  \AttributeTok{x =}\NormalTok{ ds, }\AttributeTok{y =}\NormalTok{ prediction[, }\FunctionTok{c}\NormalTok{(}\StringTok{"oob\_score\_with\_tree\_filtering"}\NormalTok{), }\AttributeTok{drop =} \ConstantTok{FALSE}\NormalTok{],}
  \AttributeTok{by =} \StringTok{"row.names"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}
\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(ds) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Protein ID"}\NormalTok{, stage\_name, }\StringTok{"Score"}\NormalTok{)}

\CommentTok{\# Add clustering groups}
\FunctionTok{load}\NormalTok{(}\AttributeTok{file =} \StringTok{"./rdata/clustering\_groups.RData"}\NormalTok{)}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_1] }\OtherTok{\textless{}{-}} \StringTok{"Group 1"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_2] }\OtherTok{\textless{}{-}} \StringTok{"Group 2"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ protein\_id\_3] }\OtherTok{\textless{}{-}} \StringTok{"Group 3"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ known\_antigens] }\OtherTok{\textless{}{-}} \StringTok{"Known antigen"}
\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Group[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}
  \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{,}
  \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}
\NormalTok{)] }\OtherTok{\textless{}{-}} \StringTok{"Reference antigen"}

\CommentTok{\# Add gene products}
\NormalTok{gene\_products }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./other\_data/pf3d7\_gene\_products\_v59.csv"}\NormalTok{)}
\FunctionTok{colnames}\NormalTok{(gene\_products) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Protein ID"}\NormalTok{, }\StringTok{"Gene product"}\NormalTok{)}
\NormalTok{ds }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ds, }\AttributeTok{y =}\NormalTok{ gene\_products, }\AttributeTok{by =} \StringTok{"Protein ID"}\NormalTok{, }\AttributeTok{all.x =} \ConstantTok{TRUE}\NormalTok{)}

\CommentTok{\# Add closest reference antigen and the distance}
\NormalTok{ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Closest known antigen}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Closest distance}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{1}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(ds)) \{}
\NormalTok{  prot }\OtherTok{\textless{}{-}}\NormalTok{ ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}}\NormalTok{[i]}
\NormalTok{  tmp }\OtherTok{\textless{}{-}}\NormalTok{ dist\_w\_tree\_filtering[prot, ]}
\NormalTok{  ds[i, }\StringTok{"Closest known antigen"}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(tmp)[}\FunctionTok{which.min}\NormalTok{(tmp)]}
\NormalTok{  ds[i, }\StringTok{"Closest known antigen"}\NormalTok{] }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}
\NormalTok{    ds[i, }\StringTok{"Closest known antigen"}\NormalTok{], }\StringTok{" ("}\NormalTok{,}
\NormalTok{    gene\_products[}
\NormalTok{      gene\_products}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{==}\NormalTok{ ds[}
\NormalTok{        i,}
        \StringTok{"Closest known antigen"}
\NormalTok{      ],}
      \StringTok{"Gene product"}
\NormalTok{    ], }\StringTok{")"}
\NormalTok{  )}
\NormalTok{  ds[i, }\StringTok{"Closest distance"}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ tmp[}\FunctionTok{which.min}\NormalTok{(tmp)]}
\NormalTok{\}}

\CommentTok{\# Add essential gene information}
\NormalTok{ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Essential}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \StringTok{"FALSE"}
\NormalTok{ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Essential}\StringTok{\textasciigrave{}}\NormalTok{[ds}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\NormalTok{ down\_selected] }\OtherTok{\textless{}{-}} \StringTok{"TRUE"}

\CommentTok{\# Sort based on scores}
\NormalTok{ds }\OtherTok{\textless{}{-}}\NormalTok{ ds[}\FunctionTok{order}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{ds}\SpecialCharTok{$}\NormalTok{Score), ]}
\FunctionTok{write.csv}\NormalTok{(ds, }\AttributeTok{file =} \StringTok{"./data/supplementary\_data\_7\_antigen\_characterization.csv"}\NormalTok{, }\AttributeTok{row.names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{plotting-9}{%
\subsection{Plotting}\label{plotting-9}}

\textbf{In R: }

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{library}\NormalTok{(ggforce)}
\FunctionTok{library}\NormalTok{(reshape)}
\FunctionTok{library}\NormalTok{(stringr)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"./data/supplementary\_data\_7\_antigen\_characterization.csv"}\NormalTok{, }\AttributeTok{check.names =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{ds\_0 }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{Group }\SpecialCharTok{==} \StringTok{"Reference antigen"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{13}\NormalTok{]}
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{Essential }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{, ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds\_ }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(ds\_0, }\AttributeTok{id.vars =} \StringTok{"Protein ID"}\NormalTok{)}
\NormalTok{ds\_}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}} \OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(ds\_}\SpecialCharTok{$}\StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}
  \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{,}
  \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}
\NormalTok{))}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{prop }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{1}\NormalTok{]))}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{median }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{2}\NormalTok{]))}
\NormalTok{p0 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{color =}\NormalTok{ median)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ prop)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_discrete}\NormalTok{(}
    \AttributeTok{limits =}\NormalTok{ rev, }\AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}
      \StringTok{"PF3D7\_0304600.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0424100.1{-}p1"}\NormalTok{,}
      \StringTok{"PF3D7\_0206900.1{-}p1"}\NormalTok{, }\StringTok{"PF3D7\_0209000.1{-}p1"}
\NormalTok{    ),}
    \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"CSP"}\NormalTok{, }\StringTok{"RH5"}\NormalTok{, }\StringTok{"MSP5"}\NormalTok{, }\StringTok{"P230"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{22}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_size\_continuous}\NormalTok{(}\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.25}\NormalTok{), }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{69}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Reference antigens"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds\_1 }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{Group }\SpecialCharTok{==} \StringTok{"Group 1"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{13}\NormalTok{]}
\NormalTok{ds\_ }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(ds\_1, }\AttributeTok{id.vars =} \StringTok{"Protein ID"}\NormalTok{)}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{prop }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{1}\NormalTok{]))}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{median }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{2}\NormalTok{]))}
\NormalTok{p1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{color =}\NormalTok{ median)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ prop)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_discrete}\NormalTok{(}\AttributeTok{limits =}\NormalTok{ rev) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{22}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_size\_continuous}\NormalTok{(}\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.25}\NormalTok{), }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.ticks.x =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 1 (2 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds\_2 }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{Group }\SpecialCharTok{==} \StringTok{"Group 2"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{13}\NormalTok{]}
\NormalTok{ds\_ }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(ds\_2, }\AttributeTok{id.vars =} \StringTok{"Protein ID"}\NormalTok{)}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{prop }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{1}\NormalTok{]))}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{median }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{2}\NormalTok{]))}
\NormalTok{p2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{color =}\NormalTok{ median)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ prop)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_discrete}\NormalTok{(}\AttributeTok{limits =}\NormalTok{ rev) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{22}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_size\_continuous}\NormalTok{(}\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.25}\NormalTok{), }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{30}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
    \AttributeTok{legend.position =} \StringTok{"right"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}
    \AttributeTok{colour =} \FunctionTok{guide\_colourbar}\NormalTok{(}
      \AttributeTok{title =} \StringTok{"Median count"}\NormalTok{,}
      \AttributeTok{title.position =} \StringTok{"top"}
\NormalTok{    ),}
    \AttributeTok{size =} \FunctionTok{guide\_legend}\NormalTok{(}
      \AttributeTok{title =} \StringTok{"Proportion of cells"}\NormalTok{,}
      \AttributeTok{title.position =} \StringTok{"top"}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 2 (26 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ds\_3 }\OtherTok{\textless{}{-}}\NormalTok{ data[data}\SpecialCharTok{$}\NormalTok{Group }\SpecialCharTok{==} \StringTok{"Group 3"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{13}\NormalTok{]}
\NormalTok{ds\_ }\OtherTok{\textless{}{-}} \FunctionTok{melt}\NormalTok{(ds\_3, }\AttributeTok{id.vars =} \StringTok{"Protein ID"}\NormalTok{)}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{prop }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{1}\NormalTok{]))}
\NormalTok{ds\_}\SpecialCharTok{$}\NormalTok{median }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(ds\_}\SpecialCharTok{$}\NormalTok{value, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{str\_extract\_all}\NormalTok{(x, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+|}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{d+"}\NormalTok{)[[}\DecValTok{1}\NormalTok{]][}\DecValTok{2}\NormalTok{]))}
\NormalTok{p3 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(ds\_, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =} \StringTok{\textasciigrave{}}\AttributeTok{Protein ID}\StringTok{\textasciigrave{}}\NormalTok{, }\AttributeTok{color =}\NormalTok{ median)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{size =}\NormalTok{ prop)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_discrete}\NormalTok{(}\AttributeTok{limits =}\NormalTok{ rev) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient}\NormalTok{(}\AttributeTok{low =} \StringTok{"blue"}\NormalTok{, }\AttributeTok{high =} \StringTok{"red"}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{22}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_size\_continuous}\NormalTok{(}\AttributeTok{range =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{0.25}\NormalTok{), }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{panel.grid.major =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{panel.grid.minor =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{plot.margin =}\NormalTok{ ggplot2}\SpecialCharTok{::}\FunctionTok{margin}\NormalTok{(}\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\StringTok{"pt"}\NormalTok{),}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{, }\AttributeTok{angle =} \DecValTok{30}\NormalTok{, }\AttributeTok{vjust =} \DecValTok{1}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{),}
    \AttributeTok{axis.text.y =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{rect =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"transparent"}\NormalTok{),}
    \AttributeTok{legend.background =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.key =} \FunctionTok{element\_blank}\NormalTok{(),}
    \AttributeTok{legend.position =} \StringTok{"none"}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Group 3 (14 candidates)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Final plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p\_combined }\OtherTok{\textless{}{-}} \FunctionTok{plot\_grid}\NormalTok{(}\FunctionTok{plot\_grid}\NormalTok{(p0, p1, p3, }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_heights =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.2}\NormalTok{, }\FloatTok{0.15}\NormalTok{, }\FloatTok{0.65}\NormalTok{)),}
\NormalTok{  p2,}
  \AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{rel\_widths =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.3}\NormalTok{, }\FloatTok{0.4}\NormalTok{)}
\NormalTok{)}
\NormalTok{p\_combined}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{./figures/Supplementary Fig 11} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.3 (2023-03-15)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] stringr_1.4.1       PupillometryR_0.0.4 rlang_1.1.0        
##  [4] dplyr_1.0.9         rlist_0.4.6.2       ggridges_0.5.3     
##  [7] reshape2_1.4.4      DBI_1.1.3           RMariaDB_1.2.2     
## [10] cowplot_1.1.1       reshape_0.8.9       ggforce_0.3.4      
## [13] shadowtext_0.1.2    gridExtra_2.3       ggplot2_3.4.2      
## 
## loaded via a namespace (and not attached):
##  [1] styler_1.8.0      tidyselect_1.1.2  xfun_0.32         purrr_0.3.4      
##  [5] colorspace_2.0-3  vctrs_0.6.2       generics_0.1.3    htmltools_0.5.3  
##  [9] yaml_2.3.5        utf8_1.2.2        R.oo_1.25.0       pillar_1.8.1     
## [13] glue_1.6.2        withr_2.5.0       R.utils_2.12.0    tweenr_2.0.1     
## [17] bit64_4.0.5       R.cache_0.16.0    lifecycle_1.0.3   plyr_1.8.7       
## [21] munsell_0.5.0     gtable_0.3.0      R.methodsS3_1.8.2 codetools_0.2-19 
## [25] evaluate_0.16     knitr_1.40        fastmap_1.1.0     fansi_1.0.3      
## [29] Rcpp_1.0.9        scales_1.2.1      bit_4.0.4         farver_2.1.1     
## [33] hms_1.1.2         digest_0.6.29     stringi_1.7.8     bookdown_0.28    
## [37] polyclip_1.10-0   cli_3.6.1         tools_4.2.3       magrittr_2.0.3   
## [41] tibble_3.1.8      pkgconfig_2.0.3   ellipsis_0.3.2    MASS_7.3-58.2    
## [45] data.table_1.14.2 assertthat_0.2.1  rmarkdown_2.16    rstudioapi_0.14  
## [49] R6_2.5.1          compiler_4.2.3
\end{verbatim}

\hypertarget{06_summary_of_candidates}{%
\chapter{Summary of candidates}\label{06_summary_of_candidates}}

The table provides a summary of 52 known antigens (including 4 reference antigens) and the top 200 antigen candidates. It includes columns for protein IDs, probability scores, antigen/candidate groups, gene products, closest known antigens, distance to the closest antigens, gene essentiality, and single-cell gene expression at various life stages.

You can easily visualize the corresponding values with colored bars for probability scores and gene expressions. Grey bars indicate probability scores. Red, blue, and light green bars represent the proportion of cells expressing the gene, median expression level, and mean expression level of the cell population, respectively.

To view columns on the right, scroll right for more information. To filter columns according to specific criteria, click on the white boxes under the headers to set thresholds. You can also sort values in ascending or descending order by clicking on the arrows next to the header.

\includegraphics{06_summary_of_candidates_files/figure-latex/unnamed-chunk-5-1.pdf}

\hypertarget{references}{%
\chapter*{References}\label{references}}
\addcontentsline{toc}{chapter}{References}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-de1999positive}{}}%
De Comité, Francesco, François Denis, Rémi Gilleron, and Fabien Letouzey. 1999. {``Positive and Unlabeled Examples Help Learning.''} In \emph{International Conference on Algorithmic Learning Theory}, 219--30. Springer.

\leavevmode\vadjust pre{\hypertarget{ref-denis2005learning}{}}%
Denis, François, Rémi Gilleron, and Fabien Letouzey. 2005. {``Learning from Positive and Unlabeled Examples.''} \emph{Theor Comput Sci} 348 (1): 70--83.

\leavevmode\vadjust pre{\hypertarget{ref-Howick:2019uo}{}}%
Howick, Virginia M, Andrew J C Russell, Tallulah Andrews, Haynes Heaton, Adam J Reid, Kedar Natarajan, Hellen Butungi, et al. 2019. {``The Malaria Cell Atlas: Single Parasite Transcriptomes Across the Complete Plasmodium Life Cycle.''} \emph{Science} 365 (6455). \url{https://doi.org/10.1126/science.aaw2619}.

\leavevmode\vadjust pre{\hypertarget{ref-Klopfenstein:2018vj}{}}%
Klopfenstein, D V, Liangsheng Zhang, Brent S Pedersen, Fidel Ramı́rez, Alex Warwick Vesztrocy, Aurélien Naldi, Christopher J Mungall, et al. 2018. {``GOATOOLS: A Python Library for Gene Ontology Analyses.''} \emph{Sci Rep} 8 (1): 10872. \url{https://doi.org/10.1038/s41598-018-28948-z}.

\leavevmode\vadjust pre{\hypertarget{ref-li2014towards}{}}%
Li, Chen, and Xue-Liang Hua. 2014. {``Towards Positive Unlabeled Learning for Parallel Data Mining: A Random Forest Framework.''} In \emph{International Conference on Advanced Data Mining and Applications}, 573--87. Springer.

\leavevmode\vadjust pre{\hypertarget{ref-Zhang:2018ug}{}}%
Zhang, Min, Chengqi Wang, Thomas D Otto, Jenna Oberstaller, Xiangyun Liao, Swamy R Adapa, Kenneth Udenze, et al. 2018. {``Uncovering the Essential Genes of the Human Malaria Parasite Plasmodium Falciparum by Saturation Mutagenesis.''} \emph{Science} 360 (6388). \url{https://doi.org/10.1126/science.aap7847}.

\end{CSLReferences}

\end{document}
